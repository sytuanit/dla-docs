# 定期支出

## 1. 目的

**定期支出**模組可協助您管理固定週期的定期支出，例如：
- 電費、水費、瓦斯費
- 網路、有線電視
- 保險
- 學費
- 租金
- 其他定期支出

此模組會根據您設定的週期自動建立**發生記錄**，並在付款到期時提醒您。

## 2. 使用時機

當您有以下情況時使用此模組：
- 固定時間表的支出（每週、雙週或每月）
- 需要追蹤和確認付款是否已支付
- 希望自動計算到每月預算中

## 3. 相關畫面

- 定期支出清單
- 新增定期支出
- 編輯定期支出
- 發生記錄歷史

## 4. 主要使用方式

### 4.1 新增定期支出

1. 前往**功能** → 選擇**定期支出**
2. 點擊右下角的 **+** (FAB) 按鈕
3. 填寫資訊：
   - **類別**：選擇或建立新類別
   - **金額**：輸入支出金額（可留空，確認時再輸入）
   - **週期**：選擇每週 / 雙週 / 每月
   - **日期**：選擇週期中的日期（例如：每月15日）
   - **開始日期**：（僅雙週週期）選擇開始日期
   - **備註**：其他資訊（選填）
4. 點擊**儲存**

### 4.2 確認已支付

1. 前往定期支出清單
2. 找到帶有**「待確認」**標籤（黃色）的項目
3. 點擊項目開啟確認對話框
4. 填寫：
   - **實際金額**：（如與預期不同）
   - **備註**：（選填）
5. 點擊**確認**

### 4.3 編輯定期支出

1. 前往定期支出清單
2. 點擊要編輯的項目
3. 從選單中選擇**編輯**
4. 更新資訊
5. 點擊**儲存**

### 4.4 查看歷史

1. 前往定期支出清單
2. 點擊項目
3. 選擇**歷史**查看所有過去的發生記錄

### 4.5 停用/啟用支出

1. 前往定期支出清單
2. 找到要停用/啟用的項目
3. 切換項目右側的**啟用**開關

## 5. 範例與介面說明

### 5.1 範例 1：建立每月定期支出（電費）

**情境**：您想追蹤每月電費，讓應用程式在付款到期時自動提醒您。

**步驟**：
1. 前往功能畫面，選擇「定期支出」
2. 點擊右下角的「➕ 新增」按鈕
3. 選擇類別「水電費」（如無則建立新類別）
4. 輸入金額：600 TWD
5. 選擇週期「每月」
6. 選擇「選擇月份日期」，輸入 15
7. 備註自動填入「每月電費」（可編輯）
8. 點擊「儲存」

**結果**：應用程式顯示成功訊息並返回清單。新項目顯示完整資訊，應用程式將在每月15日自動提醒您。

**新增定期支出畫面**：

```text
┌─────────────────────────────────────────┐
│  ← 返回    新增定期支出                  │
├─────────────────────────────────────────┤
│  類別 *                                   │
│  [水電費 ▼] [+ 新增]                     │
│                                         │
│  金額 (TWD) *                            │
│  [600]                                  │
│                                         │
│  週期 *                                 │
│  ┌──────┐ ┌────────┐ ┌────────┐        │
│  │每週  │ │雙週    │ │每月   │        │
│  └──────┘ └────────┘ └────────┘        │
│                                         │
│  週期中的付款日期                        │
│  ⚪ 月底                                 │
│  ⚫ 選擇月份日期                         │
│  ┌───────────────────────────────────┐ │
│  │ 月份日期：[15]                     │ │
│  └───────────────────────────────────┘ │
│                                         │
│  備註                                    │
│  ┌───────────────────────────────────┐ │
│  │ 每月電費                            │
│  └───────────────────────────────────┘ │
│                                         │
│  [取消]                      [儲存]     │
└─────────────────────────────────────────┘
```

---

### 5.2 範例 2：確認到期支出並更新實際金額

**情境**：水費付款日（10日）到了，但實際支付金額是 210 TWD（減少）而非設定的 240 TWD。

**步驟**：
1. 開啟應用程式或前往「定期支出」畫面
2. 應用程式自動偵測到期的發生記錄並顯示確認對話框
3. 對話框顯示預設金額：240 TWD
4. 將實際金額更新為 210 TWD
5. 輸入備註：「本月節約用水」（選填）
6. 點擊「確認已支付」

**結果**：應用程式以實際金額 210 TWD 更新已確認的發生記錄，自動建立下一個發生記錄，並更新當前財務餘額（扣除 210 TWD）。

**確認支出對話框**：

```text
┌─────────────────────────────────────────┐
│  確認已支付                              │
├─────────────────────────────────────────┤
│  水費                                    │
│  每月（10日）                            │
│  到期日期：今天                          │
│                                         │
│  實際金額 *                              │
│  [210]                                  │
│                                         │
│  備註                                    │
│  [本月節約用水]                          │
│                                         │
│  [取消此次]    [確認已支付]             │
└─────────────────────────────────────────┘
```

---

### 5.3 範例 3：不再適用時停用定期支出

**情境**：您暫時不租房子2個月，因此想停用「租金」支出而非完全刪除。

**步驟**：
1. 前往「定期支出」畫面
2. 在清單中找到「租金」項目
3. 點擊項目右側的「啟用」開關
4. 應用程式顯示確認對話框：「您確定要停用此支出嗎？」
5. 點擊「停用」按鈕確認

**結果**：「租金」卡片變更為「停用」狀態（灰色），開關變更為「停用」。應用程式不再為此支出建立新的發生記錄。您可以點擊開關「停用」→「啟用」重新啟用。

**帶開關的清單畫面**：

```text
┌─────────────────────────────────────────┐
│  ← 返回    定期支出                      │
├─────────────────────────────────────────┤
│  ┌───────────────────────────────────┐ │
│  │ 租金              [⚪ 停用]        │ │
│  │ 36,000 TWD                         │
│  │ 每月 - 1日                         │
│  │ （已停用）                          │
│  │                                    │
│  │ [編輯] [歷史] [刪除]               │
│  └───────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## 6. 邏輯與規則

### 6.1 週期和日期

- **每週**：選擇星期幾（1=星期一，7=星期日）
- **雙週**：選擇星期幾 + 特定開始日期
- **每月**：選擇月份日期（1-31）

### 6.2 自動建立發生記錄

- 應用程式在以下情況自動建立**發生記錄**：
  - 新增支出時
  - 到達週期中的日期時
  - 新月份開始時

### 6.3 發生記錄狀態

- **待處理**：待確認（顯示黃色標籤）
- **已完成**：已確認（顯示綠色標籤）
- **已取消**：已取消（顯示紅色標籤）

### 6.4 預算整合

- 確認支出時，應用程式自動更新當月預算（如存在）
- 支出會計算到預算中的「定期支出」

### 6.5 通知

- 付款到期時，應用程式發送提醒通知
- 每個項目的通知時間可設定（`notificationTime1`、`notificationTime2`，預設 16:00 和 19:00）

## 7. 重要注意事項

- **金額可留空**：如果您不知道確切金額，可以留空，確認時再輸入
- **存在發生記錄時無法刪除**：如有發生記錄，只能停用（isActive = false），無法刪除
- **延遲確認**：您可以確認過去的發生記錄，應用程式會自動重新計算預算
- **變更週期**：編輯週期時，未來的發生記錄將重新計算

