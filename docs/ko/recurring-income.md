# 정기 수입

## 1. 목적

**정기 수입** 모듈은 다음과 같은 정기적인 수입원을 관리하는 데 도움이 됩니다:
- 월급
- 임대료 수입
- 연금
- 투자 배당금
- 기타 정기 수입

이 모듈은 설정한 주기에 따라 자동으로 **발생**을 생성하고, 수입 수령 시기를 알려줍니다.

## 2. 사용 시기

다음과 같은 경우 이 모듈을 사용합니다:
- 일정에 따른 고정 수입 (주간, 격주, 월간)
- 수입 수령 확인 및 추적 필요
- 월별 예산에 자동 계산 원함

## 3. 관련 화면

- 정기 수입 목록
- 새 정기 수입 추가
- 정기 수입 편집
- 발생 이력

## 4. 주요 사용 방법

### 4.1 새 정기 수입 추가

1. **기능** → **정기 수입** 선택
2. 오른쪽 하단의 **+** (FAB) 버튼 탭
3. 정보 입력:
   - **카테고리**: 카테고리 선택 또는 새로 만들기
   - **금액**: 수입액 입력 (비워두고 확인 시 입력 가능)
   - **주기**: 주간 / 격주 / 월간 선택
   - **날짜**: 주기 내 날짜 선택 (예: 매월 15일)
   - **시작일**: (격주 주기만) 시작일 선택
   - **메모**: 추가 정보 (선택 사항)
4. **저장** 탭

### 4.2 수입 수령 확인

1. 정기 수입 목록으로 이동
2. **"확인 대기"** 배지(노란색)가 있는 항목 찾기
3. 항목 탭하여 확인 대화상자 열기
4. 입력:
   - **실제 금액**: (예상과 다른 경우)
   - **메모**: (선택 사항)
5. **확인** 탭

### 4.3 정기 수입 편집

1. 정기 수입 목록으로 이동
2. 편집할 항목 탭
3. 메뉴에서 **편집** 선택
4. 정보 업데이트
5. **저장** 탭

### 4.4 이력 보기

1. 정기 수입 목록으로 이동
2. 항목 탭
3. **이력** 선택하여 과거의 모든 발생 보기

### 4.5 수입 비활성화/활성화

1. 정기 수입 목록으로 이동
2. 비활성화/활성화할 항목 찾기
3. 항목 오른쪽의 **활성** 스위치 토글

## 5. 예시 및 UI 설명

### 5.1 예시 1: 월간 정기 수입(급여) 생성

**시나리오**: 월급을 추적하여 수입 수령 시기에 앱이 자동으로 알려주도록 합니다.

**단계**:
1. 기능 화면으로 이동, "정기 수입" 선택
2. 오른쪽 하단의 "➕ 새로 추가" 버튼 탭
3. 카테고리 "급여" 선택 (없으면 새로 만들기)
4. 금액 입력: ₩5,200,000
5. 주기 "월간" 선택
6. "월의 일 선택" 선택, 5 입력
7. 메모 자동 입력 "월급" (편집 가능)
8. "저장" 탭

**결과**: 앱이 성공 메시지를 표시하고 목록으로 돌아갑니다. 새 항목이 전체 정보와 함께 표시되며, 앱은 매월 5일에 자동으로 알려줍니다.

**정기 수입 추가 화면**:

```text
┌─────────────────────────────────────────┐
│  ← 뒤로     정기 수입 추가              │
├─────────────────────────────────────────┤
│  카테고리 *                              │
│  [급여 ▼] [+ 새로 만들기]                │
│                                         │
│  금액 (KRW) *                            │
│  [₩5,200,000]                           │
│                                         │
│  주기 *                                  │
│  ┌──────┐ ┌────────┐ ┌────────┐        │
│  │주간  │ │격주    │ │월간    │        │
│  └──────┘ └────────┘ └────────┘        │
│                                         │
│  주기 내 지급일                          │
│  ⚪ 월말                                 │
│  ⚫ 월의 일 선택                          │
│  ┌───────────────────────────────────┐ │
│  │ 월의 일: [5]                        │ │
│  └───────────────────────────────────┘ │
│                                         │
│  메모                                    │
│  ┌───────────────────────────────────┐ │
│  │ 월급                                │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [취소]                  [저장]       │
└─────────────────────────────────────────┘
```

---

### 5.2 예시 2: 만기 수입 확인 및 실제 금액 업데이트

**시나리오**: 급여일(5일)이지만, 설정한 ₩5,200,000 대신 실제로 받은 금액은 ₩5,460,000(급여 인상)입니다.

**단계**:
1. 앱 열기 또는 "정기 수입" 화면으로 이동
2. 앱이 만기 발생을 자동 감지하여 확인 대화상자 표시
3. 대화상자에 기본 금액 표시: ₩5,200,000
4. 실제 금액을 ₩5,460,000으로 업데이트
5. 메모 입력: "이번 달은 보너스 있음" (선택 사항)
6. "수령 확인" 탭

**결과**: 앱이 실제 금액 ₩5,460,000으로 확인된 발생을 업데이트하고, 다음 발생을 자동으로 생성하며, 현재 재무 잔액을 업데이트합니다.

**수입 확인 대화상자**:

```text
┌─────────────────────────────────────────┐
│  수령 확인                               │
├─────────────────────────────────────────┤
│  급여                                    │
│  월간(5일)                               │
│  만기일: 오늘                            │
│                                         │
│  실제 금액 *                             │
│  [₩5,460,000]                           │
│                                         │
│  메모                                    │
│  [이번 달은 보너스 있음]                 │
│                                         │
│  [취소]    [수령 확인]                  │
└─────────────────────────────────────────┘
```

---

### 5.3 예시 3: 수입이 수령되지 않은 경우 수입 발생 취소

**시나리오**: 임대료 지급일(1일)이지만, 임차인이 송금하지 않아 수입이 수령되지 않았습니다.

**단계**:
1. 앱 열기 또는 "정기 수입" 화면으로 이동
2. 앱이 만기 발생 확인 대화상자 표시
3. "취소" 버튼 탭
4. 사유 입력: "임차인이 송금하지 않음" (필수)
5. "취소 확인" 탭

**결과**: 취소된 발생이 "취소됨" 상태로 변경되고, 취소 사유가 표시되며, 앱이 다음 발생을 자동으로 생성합니다. 수입이 수령되지 않았으므로 재무 잔액은 변경되지 않습니다.

**수입 발생 취소 대화상자**:

```text
┌─────────────────────────────────────────┐
│  취소                                    │
├─────────────────────────────────────────┤
│  임대료 수입                              │
│  월간(1일)                               │
│  만기일: 오늘                            │
│                                         │
│  취소 사유 *                              │
│  ┌───────────────────────────────────┐ │
│  │ 임차인이 송금하지 않음              │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [뒤로]        [취소 확인]              │
└─────────────────────────────────────────┘
```

---

## 6. 로직 및 규칙

### 6.1 주기 및 날짜

- **주간**: 요일 선택 (1=월요일, 7=일요일)
- **격주**: 요일 + 특정 시작일 선택
- **월간**: 월의 일 선택 (1-31)

### 6.2 발생 자동 생성

- 앱은 다음 경우에 자동으로 **발생**을 생성합니다:
  - 새 수입 추가 시
  - 주기 내 날짜 도달 시
  - 새 달 시작 시

### 6.3 발생 상태

- **PENDING**: 확인 대기 (노란색 배지 표시)
- **COMPLETED**: 확인됨 (녹색 배지 표시)
- **CANCELLED**: 취소됨 (빨간색 배지 표시)

### 6.4 예산 통합

- 수입을 확인하면 앱이 현재 월의 예산(있는 경우)을 자동으로 업데이트합니다
- 수입은 예산의 "정기 수입"에 계산됩니다

### 6.5 알림

- 지급 만기일이 되면 앱이 알림을 보냅니다
- 각 항목의 알림 시간을 설정할 수 있습니다 (`notificationTime1`, `notificationTime2`, 기본값 16:00 및 19:00)

## 7. 중요 참고 사항

- **금액은 비워둘 수 있습니다**: 정확한 금액을 모르는 경우 비워두고 확인 시 입력할 수 있습니다
- **발생이 있으면 삭제할 수 없습니다**: 발생이 있는 경우 비활성화(isActive = false)만 가능하며 삭제는 불가능합니다
- **지연 확인**: 과거 발생을 확인할 수 있으며, 앱이 예산을 자동으로 재계산합니다
- **주기 변경**: 주기를 편집하면 향후 발생이 재계산됩니다

