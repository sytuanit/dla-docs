# งบประมาณ

## 1. วัตถุประสงค์

โมดูล **งบประมาณ** ช่วยให้คุณวางแผนและติดตามการใช้จ่ายรายเดือน เพื่อให้แน่ใจว่าคุณไม่เกินงบประมาณที่ตั้งไว้ โมดูลนี้คำนวณอัตโนมัติตาม:
- รายได้ประจำของคุณ
- ค่าใช้จ่ายประจำของคุณ
- ค่าใช้จ่ายรายวันจริง

## 2. เมื่อใดควรใช้

ใช้โมดูลนี้เมื่อคุณต้องการ:
- วางแผนการใช้จ่ายรายเดือน
- ควบคุมไม่ให้เกินงบประมาณ
- ติดตามอัตราการออม
- ดูการวิเคราะห์การใช้จ่ายตามหมวดหมู่
- เปรียบเทียบงบประมาณระหว่างเดือน

## 3. หน้าจอที่เกี่ยวข้อง

- สร้างงบประมาณ (ครั้งแรกหรือคัดลอกจากเดือนก่อนหน้า)
- ดูภาพรวมงบประมาณ
- ประวัติงบประมาณตามเดือน
- คำแนะนำคัดลอกจากเดือนก่อนหน้า

## 4. การใช้งานหลัก

### 4.1 สร้างงบประมาณครั้งแรก (Case A)

1. ไปที่ **ฟังก์ชัน** → เลือก **งบประมาณ**
2. ถ้าไม่มีงบประมาณ แอปจะเปิดหน้าจอ **สร้างงบประมาณ** อัตโนมัติ
3. แอปคำนวณและแสดงอัตโนมัติ:
   - **รายได้ประจำ**: รวมจากรายได้ประจำที่ใช้งานทั้งหมด (อ่านอย่างเดียว แสดงรายละเอียด)
   - **ค่าใช้จ่ายประจำ**: รวมจากค่าใช้จ่ายประจำที่ใช้งานทั้งหมด (อ่านอย่างเดียว แสดงรายละเอียด)
   - **งบประมาณรวม (ก่อนออม)**: คำนวณอัตโนมัติ = รายได้ประจำ - ค่าใช้จ่ายประจำ
4. ใส่ **อัตราการออม**: % การออม (0-100%, จำเป็น)
5. ดู **จำนวนเงินออม** และ **งบประมาณการใช้จ่าย** คำนวณอัตโนมัติ
6. แตะ **บันทึกงบประมาณ**

### 4.2 คัดลอกจากเดือนก่อนหน้า (Case C)

1. ไปที่ **ฟังก์ชัน** → เลือก **งบประมาณ**
2. ถ้าเดือนปัจจุบันไม่มีงบประมาณ แต่เดือนก่อนหน้ามี แอปจะแสดงหน้าจอ **คำแนะนำคัดลองบประมาณ**
3. เลือกหนึ่งในตัวเลือก:
   - **คัดลองบประมาณเดือนก่อนหน้าทั้งหมด**: แอปคัดลอกอัตราการออมอัตโนมัติ คำนวณรายได้/ค่าใช้จ่ายประจำใหม่จากข้อมูลปัจจุบัน และสร้างงบประมาณทันที
   - **คัดลอกและปรับ**: แอปนำทางไปยังหน้าจอสร้างงบประมาณพร้อมอัตราการออมที่กรอกไว้ล่วงหน้าจากเดือนก่อนหน้า คุณสามารถปรับก่อนบันทึก
   - **สร้างงบประมาณใหม่**: รันขั้นตอนการสร้างงบประมาณใหม่ทั้งหมด (Case A)
4. ถ้าเลือก "คัดลอกและปรับ" ปรับอัตราการออมถ้าจำเป็น
5. แตะ **บันทึกงบประมาณ**

**หมายเหตุ**: เมื่อคัดลอก รายได้ประจำและค่าใช้จ่ายประจำจะถูกคำนวณใหม่จากข้อมูลประจำปัจจุบัน (ไม่คัดลอกจากเดือนก่อนหน้า) เฉพาะอัตราการออมเท่านั้นที่ถูกคัดลอก

### 4.3 ดูภาพรวมงบประมาณ (Case B)

1. ไปที่ **ฟังก์ชัน** → เลือก **งบประมาณ**
2. ถ้าเดือนปัจจุบันมีงบประมาณ แอปจะเปิดหน้าจอ **ภาพรวม**
3. ดูข้อมูล:
   - **งบประมาณการใช้จ่าย**: จำกัดการใช้จ่ายที่ตั้งไว้
   - **ใช้ไปแล้ว**: จำนวนที่ใช้จ่าย (รวมค่าใช้จ่ายรายวันและความแตกต่างของรายได้/ค่าใช้จ่าย)
   - **คงเหลือ**: จำนวนคงเหลือในงบประมาณ
   - **อัตราการใช้**: % งบประมาณที่ใช้ (พร้อมสีเตือน)
   - **ความแตกต่างของรายได้และค่าใช้จ่ายจากแผน**: ความแตกต่างจากแผนเดิม
   - **ค่าใช้จ่ายรายวันตามหมวดหมู่**: การวิเคราะห์การใช้จ่ายรายละเอียดตามหมวดหมู่

### 4.4 แก้ไขงบประมาณเดือนปัจจุบัน

1. บนหน้าจอ **ภาพรวมงบประมาณ** แตะปุ่ม **"แก้ไขงบประมาณ"**
2. แอปแสดงหน้าจอแก้ไขพร้อม:
   - **รายได้ประจำ** และ **ค่าใช้จ่ายประจำ**: เก็บค่าเดิม (อ่านอย่างเดียว)
   - **อัตราการออม**: กรอกไว้ล่วงหน้าจากงบประมาณปัจจุบัน (สามารถแก้ไขได้)
3. เปลี่ยนอัตราการออมถ้าจำเป็น
4. ดูจำนวนเงินออมและงบประมาณการใช้จ่ายอัปเดตอัตโนมัติ
5. แตะ **"บันทึกงบประมาณ"**

**หมายเหตุ**: เมื่อแก้ไข รายได้ประจำและค่าใช้จ่ายประจำจะไม่ถูกคำนวณใหม่ (เก็บ snapshot เดิม) เฉพาะอัตราการออมและงบประมาณการใช้จ่ายเท่านั้นที่ถูกอัปเดต

### 4.5 ดูประวัติงบประมาณ

1. ไปที่ **ฟังก์ชัน** → เลือก **งบประมาณ**
2. เลือก **ประวัติ** จากเมนู
3. ดูรายการงบประมาณสำหรับเดือนที่ผ่านมา
4. แตะที่เดือนเพื่อดูรายละเอียด

### 4.6 ดูรายละเอียดค่าใช้จ่ายตามหมวดหมู่

1. ไปที่หน้าจอ **ภาพรวมงบประมาณ**
2. เลื่อนลงไปที่ส่วน **การวิเคราะห์ตามหมวดหมู่**
3. แตะที่หมวดหมู่
4. ดูรายการค่าใช้จ่ายในหมวดหมู่นั้น

## 5. ตัวอย่างและภาพประกอบ UI

### 5.1 BUDGET-01: สร้างงบประมาณครั้งแรกสำหรับเดือนปัจจุบัน

**เป้าหมาย**: สร้างงบประมาณครั้งแรกเพื่อให้แอปคำนวณและติดตามการใช้จ่ายรายเดือนอัตโนมัติตามรายได้และค่าใช้จ่ายประจำ

**ขั้นตอน**:
1. ไปที่หน้าจอฟังก์ชัน เลือก "การจัดการงบประมาณ"
2. แอปตรวจจับว่าไม่มีงบประมาณอัตโนมัติและแสดงหน้าจอ "สร้างงบประมาณ"
3. ดูข้อมูลที่คำนวณอัตโนมัติ: รายได้ประจำ, ค่าใช้จ่ายประจำ, งบประมาณรวม (ก่อนออม)
4. ใส่อัตราการออม: 20
5. ดูจำนวนเงินออมและงบประมาณการใช้จ่ายคำนวณอัตโนมัติ
6. แตะปุ่ม "บันทึกงบประมาณ"

**ผลลัพธ์**: งบประมาณถูกบันทึกสำหรับเดือนปัจจุบัน นำทางไปยังหน้าจอ "ภาพรวมงบประมาณ" อัตโนมัติ

**ภาพประกอบ UI**:

```text
[ การ์ด: สร้างงบประมาณ พฤศจิกายน 2025 ]
+------------------------------------------------+
||                                                |
|| รายได้ประจำ                ฿42,000            |
||  • เงินเดือนของฉัน (รายเดือน) ฿42,000        |
||                                                |
|| ค่าใช้จ่ายประจำ              ฿32,060          |
||  • ค่าไฟฟ้า (รายเดือน)        ฿1,190        |
||  • ค่าน้ำ (รายเดือน)          ฿595          |
||  • ค่าเล่าเรียน BN (รายเดือน)  ฿9,520        |
||  • อาหารเช้าและกาแฟ (รายสัปดาห์ x 4) ฿1,260 |
||  • การชำระเงินกู้บ้าน (รายเดือน) ฿14,700    |
||                                                |
|| (ข้อมูลนี้ถูกดึงมาอัตโนมัติ)                  |
+------------------------------------------------+

[ การ์ด: งบประมาณรวม (ก่อนออม) ]
 ------------------------------------------------
||   ฿42,000 (รายได้ประจำ)                     |
|| - ฿32,060 (ค่าใช้จ่ายประจำ)                  |
||-----------------------------------------------|
|| = ฿9,940 THB                                  |
 ------------------------------------------------

[ การ์ด: อัตราการออม ]
 ------------------------------------------------
|| คุณต้องการออมเท่าไหร่?                      |
||                                                |
|| อัตราการออม (%)                                |
|| [  ใส่ (จำเป็น): 20  ]                        |
||                                                |
|| → เทียบเท่า: ฿1,995                           |
 ------------------------------------------------

[ การ์ด: งบประมาณการใช้จ่าย ]
 ------------------------------------------------
||    ฿9,940 (งบประมาณรวม (ก่อนออม))            |
|| -  ฿1,995 (จำนวนเงินออม)                     |
||-----------------------------------------------|
|| = ฿7,945 THB                                  |
||                                                |
|| (รวมอาหาร, การขนส่ง, กาแฟ, ช้อปปิ้งเล็กน้อย...)
 ------------------------------------------------

[ ปุ่ม ]
 -------------------------------
||      บันทึกงบประมาณ              |
 -------------------------------
```

---

### 5.2 BUDGET-02: ดูภาพรวมงบประมาณเดือนปัจจุบัน

**เป้าหมาย**: ดูสถานการณ์การใช้จ่ายเทียบกับงบประมาณที่ตั้งไว้ รวมถึงจำนวนที่ใช้ คงเหลือ และการวิเคราะห์ตามหมวดหมู่

**ขั้นตอน**:
1. ไปที่หน้าจอฟังก์ชัน เลือก "การจัดการงบประมาณ"
2. แอปตรวจจับว่ามีงบประมาณอัตโนมัติและแสดงหน้าจอ "ภาพรวมงบประมาณ"
3. ดูการ์ด 1 - งบประมาณรายเดือน: งบประมาณการใช้จ่าย, ใช้ไปแล้ว, คงเหลือ, อัตราการใช้
4. ดูการ์ด 2 - ความแตกต่างของรายได้และค่าใช้จ่ายจากแผน
5. ดูการ์ด 3 - ค่าใช้จ่ายรายวันตามหมวดหมู่
6. (ไม่บังคับ) คลิกที่ "งบประมาณการใช้จ่าย ›" เพื่อดูกล่องโต้ตอบรายละเอียดที่อธิบายการคำนวณงบประมาณ

**ผลลัพธ์**: แสดงข้อมูลงบประมาณเดือนปัจจุบันทั้งหมดพร้อมแถบความคืบหน้าและสีที่เหมาะสม

**ภาพประกอบ UI**:

```text
[ การ์ด 1 – งบประมาณ พฤศจิกายน 2025 ]
┌──────────────────────────────────────────────┐
│ งบประมาณ พฤศจิกายน 2025                      │
│                                             │
│ งบประมาณการใช้จ่าย ›      ฿7,945            │
│ ใช้ไปแล้ว                ฿1,225            │
│  • ค่าใช้จ่ายรายวัน              ฿1,680    │   
│  • ความแตกต่างรายได้      -฿5,600          │
│  • ความแตกต่างค่าใช้จ่าย       +฿280        │
│ คงเหลือ                ฿3,640              │
│                                             │
│                    15.4%                    │
│   (คุณใช้ไปแล้ว 15.4% ของงบประมาณการใช้จ่ายเดือนนี้)
│   (คุณกำลังจะใช้หมดงบประมาณการใช้จ่ายเดือนนี้)
│                                             │
│                               [ดูประวัติ]   │
└──────────────────────────────────────────────┘

[ การ์ด 2 – ความแตกต่างของรายได้และค่าใช้จ่ายจากแผน ]
┌──────────────────────────────────────────────┐
│ ความแตกต่างของรายได้และค่าใช้จ่ายจากแผน      │
│                                              │
│ รายได้ประจำ                                  │
│  • เงินเดือนของฉัน                 +฿2,800   │
│    (฿16,800 > ฿14,000)                      │
│                                              │
│ ค่าใช้จ่ายประจำ                              │
│  • ค่าเล่าเรียน BN              -฿140      │
│    (฿9,940 > ฿9,800)                        │
│                                              │
│ ความแตกต่างรายได้รวม:        +฿8,400         │
│ ความแตกต่างค่าใช้จ่ายรวม:        -฿280      │
└──────────────────────────────────────────────┘

[ การ์ด 3 – ค่าใช้จ่ายรายวันตามหมวดหมู่ ]
┌──────────────────────────────────────────────┐
│ ค่าใช้จ่ายรายวันตามหมวดหมู่                   │
│ (อาหาร, การขนส่ง, กาแฟ, ช้อปปิ้งเล็กน้อย...)
│                                             │
│ ค่าใช้จ่ายรายวันรวม: ฿1,680                 │
│                                             │
│ อาหาร              ฿840    50% [█████---------]│
│ การขนส่ง           ฿420    25% [███-----------]│
│ กาแฟ               ฿280    17% [██------------]│
│ ช้อปปิ้งเล็กน้อย     ฿140    8%  [█-------------]│
└──────────────────────────────────────────────┘
```

---

### 5.3 BUDGET-03: แก้ไขงบประมาณเดือนปัจจุบัน

**เป้าหมาย**: ปรับอัตราการออมเพื่อเปลี่ยนงบประมาณการใช้จ่ายสำหรับเดือนปัจจุบัน

**ขั้นตอน**:
1. บนหน้าจอ "ภาพรวมงบประมาณ" แตะปุ่ม "แก้ไขงบประมาณ"
2. แอปแสดงหน้าจอแก้ไข (คล้ายกับหน้าจอสร้างงบประมาณ)
3. ดูข้อมูลปัจจุบัน: รายได้ประจำ, ค่าใช้จ่ายประจำ (เก็บค่าเดิม)
4. เปลี่ยนอัตราการออมเป็น 25
5. ดูจำนวนเงินออมและงบประมาณการใช้จ่ายอัปเดตอัตโนมัติ
6. แตะปุ่ม "บันทึกงบประมาณ"

**ผลลัพธ์**: งบประมาณถูกอัปเดต กลับไปยังหน้าจอ "ภาพรวมงบประมาณ" พร้อมค่าใหม่

**ภาพประกอบ UI**: คล้ายกับ BUDGET-01 (หน้าจอสร้างงบประมาณ) แต่ค่าของรายได้ประจำและค่าใช้จ่ายประจำเป็นแบบอ่านอย่างเดียวและเก็บจากงบประมาณเดิม

---

### 5.4 BUDGET-04: คัดลองบประมาณจากเดือนก่อนหน้าเมื่อเริ่มเดือนใหม่

**เป้าหมาย**: ใช้งบประมาณเดือนก่อนหน้าเพื่อประหยัดเวลาในการสร้างงบประมาณใหม่ พร้อมตัวเลือกปรับถ้าจำเป็น

**ขั้นตอน**:
1. ไปที่หน้าจอฟังก์ชัน เลือก "การจัดการงบประมาณ"
2. แอปตรวจจับว่าเดือนปัจจุบันไม่มีงบประมาณ แต่เดือนก่อนหน้ามี แสดงหน้าจอ "คำแนะนำคัดลองบประมาณ"
3. เลือก "คัดลอกและปรับ"
4. แอปนำทางไปยังหน้าจอสร้างงบประมาณพร้อมอัตราการออมที่กรอกไว้ล่วงหน้าจากเดือนก่อนหน้า
5. (ไม่บังคับ) ปรับอัตราการออมถ้าจำเป็น
6. แตะปุ่ม "บันทึกงบประมาณ"

**ผลลัพธ์**: งบประมาณใหม่ถูกสร้างสำหรับเดือนปัจจุบัน นำทางไปยังหน้าจอ "ภาพรวมงบประมาณ" อัตโนมัติ

**ภาพประกอบ UI**:

```text
[ หน้าจอ ]  งบประมาณ ธันวาคม 2025
┌──────────────────────────────────────────────┐
│ ธันวาคม 2025 ไม่มีงบประมาณ                   │
│                                              │
│ คุณต้องการสร้างงบประมาณเดือนใหม่อย่างไร?    │
├──────────────────────────────────────────────┤
│                                              │
│ 📝 คัดลอกและปรับ ›                          │
│    คำแนะนำ: คัดลองบประมาณพฤศจิกายน 2025 และปรับ│
│                                              │
├──────────────────────────────────────────────┤
│                                              │
│ ➕ สร้างงบประมาณใหม่ ›                      │
│   คำแนะนำ: รันขั้นตอนการสร้างงบประมาณอีกครั้ง│
│                                              │
└──────────────────────────────────────────────┘
```

หลังจากเลือก "คัดลอกและปรับ" หน้าจอสร้างงบประมาณจะแสดงคล้ายกับ BUDGET-01 แต่อัตราการออมจะถูกกรอกไว้ล่วงหน้าจากเดือนก่อนหน้า

## 6. ตรรกะและกฎ

### 6.1 กรณีต่างๆ

- **Case A**: สร้างงบประมาณครั้งแรก (ไม่มีงบประมาณสำหรับเดือนใดๆ)
- **Case B**: เดือนปัจจุบันมีงบประมาณ → ดูภาพรวม
- **Case C**: เดือนปัจจุบันไม่มี แต่เดือนก่อนหน้ามี → คำแนะนำคัดลอก

### 6.2 การคำนวณอัตโนมัติ

- **รายได้ประจำ**: รวมจาก `recurring_income` ที่ใช้งานทั้งหมด
- **ค่าใช้จ่ายประจำ**: รวมจาก `recurring_expense` ที่ใช้งานทั้งหมด
- **ค่าใช้จ่ายรายวัน**: รวมจาก `daily_expense` ในเดือน
- **งบประมาณรวม**: รายได้ประจำ + รายได้พิเศษ
- **การออม**: งบประมาณรวม × อัตราการออม

### 6.3 การรวมกับโมดูลอื่น

- เมื่อยืนยันรายได้ประจำ → อัปเดตงบประมาณอัตโนมัติ
- เมื่อยืนยันค่าใช้จ่ายประจำ → อัปเดตงบประมาณอัตโนมัติ
- ค่าใช้จ่ายรายวันจะถูกคำนวณเข้างบประมาณอัตโนมัติ

### 6.4 คำเตือนเกินงบประมาณ

- แอปจะแสดงคำเตือนเมื่อการใช้จ่ายเกินงบประมาณ
- คำเตือนแสดงบนหน้าจอหลักและในการแจ้งเตือน

### 6.5 Snapshot

- เมื่อสร้างงบประมาณ แอปจะสร้าง snapshot ของรายการรายได้/ค่าใช้จ่ายเพื่อบันทึกสถานะ ณ เวลานั้น
- Snapshot ใช้สำหรับการเปรียบเทียบและการวิเคราะห์

## 7. หมายเหตุสำคัญ

- **งบประมาณหนึ่งรายการต่อเดือน**: คุณต้องสร้างงบประมาณสำหรับแต่ละเดือน
- **แก้ไขงบประมาณ**: คุณสามารถแก้ไขงบประมาณเดือนปัจจุบันได้โดยการเปลี่ยนอัตราการออม รายได้ประจำและค่าใช้จ่ายประจำจะไม่เปลี่ยนแปลง (snapshot) เพื่อให้แน่ใจว่ามีความถูกต้อง
- **อัปเดตอัตโนมัติ**: งบประมาณจะอัปเดตอัตโนมัติเมื่อคุณยืนยันรายได้/ค่าใช้จ่าย
- **คัดลอกจากเดือนก่อนหน้า**: ฟีเจอร์คัดลอกช่วยให้คุณประหยัดเวลาในการสร้างงบประมาณ

