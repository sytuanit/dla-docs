# รายได้ประจำ

## 1. วัตถุประสงค์

โมดูล **รายได้ประจำ** ช่วยให้คุณจัดการแหล่งรายได้ประจำ เช่น:
- เงินเดือนรายเดือน
- ค่าเช่า
- เงินบำนาญ
- เงินปันผลจากการลงทุน
- รายได้ประจำอื่นๆ

โมดูลนี้จะสร้าง **การเกิดขึ้น** อัตโนมัติตามรอบที่คุณกำหนด และเตือนคุณเมื่อถึงเวลารับเงิน

## 2. เมื่อใดควรใช้

ใช้โมดูลนี้เมื่อคุณมี:
- รายได้คงที่ตามกำหนดเวลา (รายสัปดาห์, รายสองสัปดาห์, หรือรายเดือน)
- ต้องการติดตามและยืนยันเมื่อได้รับเงิน
- ต้องการให้คำนวณเข้างบประมาณรายเดือนอัตโนมัติ

## 3. หน้าจอที่เกี่ยวข้อง

- รายการรายได้ประจำ
- เพิ่มรายได้ประจำใหม่
- แก้ไขรายได้ประจำ
- ประวัติการเกิดขึ้น

## 4. การใช้งานหลัก

### 4.1 เพิ่มรายได้ประจำใหม่

1. ไปที่ **ฟังก์ชัน** → เลือก **รายได้ประจำ**
2. แตะปุ่ม **+** (FAB) ที่มุมล่างขวา
3. กรอกข้อมูล:
   - **หมวดหมู่**: เลือกหรือสร้างหมวดหมู่ใหม่
   - **จำนวนเงิน**: ใส่จำนวนรายได้ (สามารถเว้นว่างไว้ ใส่ตอนยืนยันได้)
   - **รอบ**: เลือก รายสัปดาห์ / รายสองสัปดาห์ / รายเดือน
   - **วันที่**: เลือกวันที่ในรอบ (เช่น วันที่ 5 ของทุกเดือน)
   - **วันที่เริ่มต้น**: (เฉพาะรอบรายสองสัปดาห์) เลือกวันที่เริ่มต้น
   - **หมายเหตุ**: ข้อมูลเพิ่มเติม (ไม่บังคับ)
4. แตะ **บันทึก**

### 4.2 ยืนยันการรับเงิน

1. ไปที่รายการรายได้ประจำ
2. หารายการที่มีป้าย **"รอยืนยัน"** (สีเหลือง)
3. แตะที่รายการเพื่อเปิดกล่องโต้ตอบยืนยัน
4. กรอกข้อมูล:
   - **จำนวนเงินจริง**: (ถ้าแตกต่างจากที่คาดไว้)
   - **หมายเหตุ**: (ไม่บังคับ)
5. แตะ **ยืนยัน**

### 4.3 แก้ไขรายได้ประจำ

1. ไปที่รายการรายได้ประจำ
2. แตะที่รายการเพื่อแก้ไข
3. เลือก **แก้ไข** จากเมนู
4. อัปเดตข้อมูล
5. แตะ **บันทึก**

### 4.4 ดูประวัติ

1. ไปที่รายการรายได้ประจำ
2. แตะที่รายการ
3. เลือก **ประวัติ** เพื่อดูการเกิดขึ้นทั้งหมดในอดีต

### 4.5 ปิดการใช้งาน/เปิดการใช้งานรายได้

1. ไปที่รายการรายได้ประจำ
2. หารายการที่ต้องการปิด/เปิดการใช้งาน
3. เปิด/ปิดสวิตช์ **ใช้งาน** ที่ด้านขวาของรายการ

## 5. ตัวอย่างและภาพประกอบ UI

### 5.1 ตัวอย่างที่ 1: สร้างรายได้ประจำรายเดือน (เงินเดือน)

**สถานการณ์**: คุณต้องการติดตามเงินเดือนรายเดือนเพื่อให้แอปเตือนคุณอัตโนมัติเมื่อถึงเวลารับเงิน

**ขั้นตอน**:
1. ไปที่หน้าจอฟังก์ชัน เลือก "รายได้ประจำ"
2. แตะปุ่ม "➕ เพิ่มใหม่" ที่มุมล่างขวา
3. เลือกหมวดหมู่ "เงินเดือน" (หรือสร้างใหม่ถ้ายังไม่มี)
4. ใส่จำนวน: ฿140,000
5. เลือกรอบ "รายเดือน"
6. เลือก "เลือกวันที่ของเดือน" ใส่ 5
7. หมายเหตุกรอกอัตโนมัติ "เงินเดือนรายเดือน" (สามารถแก้ไขได้)
8. แตะ "บันทึก"

**ผลลัพธ์**: แอปแสดงข้อความสำเร็จและกลับไปที่รายการ รายการใหม่ปรากฏพร้อมข้อมูลครบถ้วน และแอปจะเตือนคุณอัตโนมัติในวันที่ 5 ของทุกเดือน

**หน้าจอเพิ่มรายได้ประจำ**:

```text
┌─────────────────────────────────────────┐
│  ← กลับ    เพิ่มรายได้ประจำ              │
├─────────────────────────────────────────┤
│  หมวดหมู่ *                              │
│  [เงินเดือน ▼] [+ เพิ่มใหม่]            │
│                                         │
│  จำนวนเงิน (THB) *                       │
│  [฿140,000]                            │
│                                         │
│  รอบ *                                   │
│  ┌──────┐ ┌────────┐ ┌────────┐        │
│  │สัปดาห์│ │สองสัปดาห์│ │เดือน  │        │
│  └──────┘ └────────┘ └────────┘        │
│                                         │
│  วันที่ชำระในรอบ                        │
│  ⚪ สิ้นเดือน                            │
│  ⚫ เลือกวันที่ของเดือน                 │
│  ┌───────────────────────────────────┐ │
│  │ วันที่ของเดือน: [5]              │ │
│  └───────────────────────────────────┘ │
│                                         │
│  หมายเหตุ                                │
│  ┌───────────────────────────────────┐ │
│  │ เงินเดือนรายเดือน                  │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [ยกเลิก]                  [บันทึก]   │
└─────────────────────────────────────────┘
```

---

### 5.2 ตัวอย่างที่ 2: ยืนยันรายได้ที่ครบกำหนดและอัปเดตจำนวนเงินจริง

**สถานการณ์**: ถึงวันเงินเดือน (วันที่ 5) แต่จำนวนเงินจริงที่ได้รับคือ ฿147,000 (เงินเดือนเพิ่มขึ้น) แทนที่จะเป็น ฿140,000 ตามที่ตั้งไว้

**ขั้นตอน**:
1. เปิดแอปหรือไปที่หน้าจอ "รายได้ประจำ"
2. แอปตรวจจับการเกิดขึ้นที่ครบกำหนดอัตโนมัติและแสดงกล่องโต้ตอบยืนยัน
3. กล่องโต้ตอบแสดงจำนวนเงินเริ่มต้น: ฿140,000
4. อัปเดตจำนวนเงินจริงเป็น ฿147,000
5. ใส่หมายเหตุ: "เดือนนี้มีโบนัส" (ไม่บังคับ)
6. แตะ "ยืนยันรับเงิน"

**ผลลัพธ์**: แอปอัปเดตการเกิดขึ้นที่ยืนยันแล้วด้วยจำนวนเงินจริง ฿147,000 สร้างการเกิดขึ้นครั้งถัดไปอัตโนมัติ และอัปเดตยอดเงินปัจจุบัน

**กล่องโต้ตอบยืนยันรายได้**:

```text
┌─────────────────────────────────────────┐
│  ยืนยันรับเงิน                           │
├─────────────────────────────────────────┤
│  เงินเดือน                               │
│  รายเดือน (วันที่ 5)                     │
│  วันที่ครบกำหนด: วันนี้                 │
│                                         │
│  จำนวนเงินจริง *                         │
│  [฿147,000]                            │
│                                         │
│  หมายเหตุ                                │
│  [เดือนนี้มีโบนัส]                      │
│                                         │
│  [ยกเลิกนี้]    [ยืนยันรับเงิน]         │
└─────────────────────────────────────────┘
```

---

### 5.3 ตัวอย่างที่ 3: ยกเลิกการเกิดขึ้นของรายได้เมื่อไม่ได้รับเงิน

**สถานการณ์**: ถึงวันรับค่าเช่า (วันที่ 1) แต่ผู้เช่ายังไม่โอนเงิน จึงไม่ได้รับเงิน

**ขั้นตอน**:
1. เปิดแอปหรือไปที่หน้าจอ "รายได้ประจำ"
2. แอปแสดงกล่องโต้ตอบยืนยันสำหรับการเกิดขึ้นที่ครบกำหนด
3. แตะปุ่ม "ยกเลิกนี้"
4. ใส่เหตุผล: "ผู้เช่ายังไม่โอนเงิน" (จำเป็น)
5. แตะ "ยืนยันยกเลิก"

**ผลลัพธ์**: การเกิดขึ้นที่ยกเลิกเปลี่ยนสถานะเป็น "ยกเลิก" แสดงเหตุผลการยกเลิก และแอปสร้างการเกิดขึ้นครั้งถัดไปอัตโนมัติ ยอดเงินไม่เปลี่ยนแปลงเพราะไม่ได้รับเงิน

**กล่องโต้ตอบยกเลิกการเกิดขึ้นของรายได้**:

```text
┌─────────────────────────────────────────┐
│  ยกเลิกนี้                               │
├─────────────────────────────────────────┤
│  ค่าเช่า                                 │
│  รายเดือน (วันที่ 1)                     │
│  วันที่ครบกำหนด: วันนี้                 │
│                                         │
│  เหตุผลการยกเลิก *                       │
│  ┌───────────────────────────────────┐ │
│  │ ผู้เช่ายังไม่โอนเงิน                │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [กลับ]        [ยืนยันยกเลิก]           │
└─────────────────────────────────────────┘
```

---

## 6. ตรรกะและกฎ

### 6.1 รอบและวันที่

- **รายสัปดาห์**: เลือกวันของสัปดาห์ (1=จันทร์, 7=อาทิตย์)
- **รายสองสัปดาห์**: เลือกวันของสัปดาห์ + วันที่เริ่มต้นเฉพาะ
- **รายเดือน**: เลือกวันที่ของเดือน (1-31)

### 6.2 สร้างการเกิดขึ้นอัตโนมัติ

- แอปสร้าง **การเกิดขึ้น** อัตโนมัติเมื่อ:
  - เพิ่มรายได้ใหม่
  - ถึงวันที่ในรอบ
  - เริ่มเดือนใหม่

### 6.3 สถานะการเกิดขึ้น

- **PENDING**: รอยืนยัน (แสดงป้ายสีเหลือง)
- **COMPLETED**: ยืนยันแล้ว (แสดงป้ายสีเขียว)
- **CANCELLED**: ยกเลิกแล้ว (แสดงป้ายสีแดง)

### 6.4 การรวมเข้างบประมาณ

- เมื่อยืนยันรายได้ แอปจะอัปเดตงบประมาณเดือนปัจจุบันอัตโนมัติ (ถ้ามี)
- รายได้จะถูกคำนวณเข้า "รายได้ประจำ" ในงบประมาณ

### 6.5 การแจ้งเตือน

- แอปส่งการแจ้งเตือนเตือนเมื่อถึงเวลาชำระ
- เวลาแจ้งเตือนสามารถกำหนดได้สำหรับแต่ละรายการ (`notificationTime1`, `notificationTime2`, ค่าเริ่มต้น 16:00 และ 19:00)

## 7. หมายเหตุสำคัญ

- **จำนวนเงินสามารถเว้นว่างได้**: ถ้าคุณไม่ทราบจำนวนเงินที่แน่นอน สามารถเว้นว่างไว้และใส่ตอนยืนยันได้
- **ไม่สามารถลบเมื่อมีการเกิดขึ้น**: ถ้ามีการเกิดขึ้น คุณสามารถปิดการใช้งานเท่านั้น (isActive = false) ไม่สามารถลบได้
- **ยืนยันล่าช้า**: คุณสามารถยืนยันการเกิดขึ้นในอดีตได้ แอปจะคำนวณงบประมาณใหม่อัตโนมัติ
- **เปลี่ยนรอบ**: เมื่อแก้ไขรอบ การเกิดขึ้นในอนาคตจะถูกคำนวณใหม่

