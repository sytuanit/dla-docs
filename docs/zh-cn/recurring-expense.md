# 经常性支出

## 1. 目的

**经常性支出**模块可帮助您管理具有固定周期的定期支出，例如：
- 水电燃气费
- 网络、有线电视费
- 保险费
- 学费
- 房租
- 其他经常性支出

此模块会根据您设定的周期自动创建**发生事件**，并在付款到期时提醒您。

## 2. 何时使用

当您有以下情况时，请使用此模块：
- 按计划的固定支出（每周、每两周或每月）
- 需要追踪并确认何时付款
- 希望自动计算到每月预算中

## 3. 相关画面

- 经常性支出列表
- 新增经常性支出
- 编辑经常性支出
- 发生事件历史记录

## 4. 主要用途

### 4.1 新增经常性支出

1. 前往**功能** → 选择**经常性支出**
2. 点击右下角的 **+** (FAB) 按钮
3. 填写信息：
   - **类别**：选择或创建新类别
   - **金额**：输入支出金额（可留空，在确认时输入）
   - **周期**：选择每周 / 每两周 / 每月
   - **日期**：选择周期内的日期（例如：每月15日）
   - **开始日期**：（仅适用于每两周周期）选择开始日期
   - **备注**：附加信息（可选）
4. 点击**保存**

### 4.2 确认已付款

1. 前往经常性支出列表
2. 找到带有**"待确认"**标签（黄色）的项目
3. 点击该项目以打开确认对话框
4. 填写：
   - **实际金额**：（如果与预期不同）
   - **备注**：（可选）
5. 点击**确认**

### 4.3 编辑经常性支出

1. 前往经常性支出列表
2. 点击该项目以编辑
3. 从菜单中选择**编辑**
4. 更新信息
5. 点击**保存**

### 4.4 查看历史记录

1. 前往经常性支出列表
2. 点击一个项目
3. 选择**历史记录**以查看所有过去的发生事件

### 4.5 停用/启用支出

1. 前往经常性支出列表
2. 找到要停用/启用的项目
3. 切换项目右侧的**启用**开关

## 5. 示例与用户界面图示

### 5.1 示例 1：创建每月经常性支出（电费）

**情境**：您希望追踪每月电费，以便应用程序在付款到期时自动提醒您。

**步骤**：
1. 前往功能画面，选择"经常性支出"
2. 点击右下角的"➕ 新增"按钮
3. 选择类别"水电燃气费"（如果没有，则创建新类别）
4. 输入金额：140 CNY
5. 选择周期"每月"
6. 选择"选择月份中的日期"，输入 15
7. 备注自动填写"每月电费"（可编辑）
8. 点击"保存"

**结果**：应用程序显示成功消息并返回列表。新项目显示完整信息，应用程序将在每月15日自动提醒您。

**新增经常性支出画面**：

```text
┌─────────────────────────────────────────┐
│  ← 返回    新增经常性支出                  │
├─────────────────────────────────────────┤
│  类别 *                                  │
│  [水电燃气费 ▼] [+ 新增]                  │
│                                         │
│  金额 (CNY) *                            │
│  [140]                                  │
│                                         │
│  周期 *                                  │
│  ┌──────┐ ┌────────┐ ┌────────┐        │
│  │周次  │ │每两周  │ │每月    │        │
│  └──────┘ └────────┘ └────────┘        │
│                                         │
│  周期内付款日期                           │
│  ⚪ 月底                                 │
│  ⚫ 选择月份中的日期                       │
│  ┌───────────────────────────────────┐ │
│  │ 月份中的日期: [15]                │ │
│  └───────────────────────────────────┘ │
│                                         │
│  备注                                    │
│  ┌───────────────────────────────────┐ │
│  │ 每月电费                             │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [取消]                  [保存]         │
└─────────────────────────────────────────┘
```

---

### 5.2 示例 2：确认到期支出并更新实际金额

**情境**：今天是水费支付日（10日），但实际支付金额是 49 CNY（减少），而不是设定的 56 CNY。

**步骤**：
1. 打开应用程序或前往"经常性支出"画面
2. 应用程序自动检测到期发生事件并显示确认对话框
3. 对话框显示默认金额：56 CNY
4. 将实际金额更新为 49 CNY
5. 输入备注："本月节约用水"（可选）
6. 点击"确认已付款"

**结果**：应用程序将确认的发生事件更新为实际金额 49 CNY，自动创建下一个发生事件，并更新当前财务余额（减去 49 CNY）。

**确认支出对话框**：

```text
┌─────────────────────────────────────────┐
│  确认已付款                              │
├─────────────────────────────────────────┤
│  水费                                    │
│  每月 (10日)                             │
│  到期日：今天                             │
│                                         │
│  实际金额 *                              │
│  [49]                                   │
│                                         │
│  备注                                    │
│  [本月节约用水]                         │
│                                         │
│  [取消此项]    [确认已付款]             │
└─────────────────────────────────────────┘
```

---

### 5.3 示例 3：停用不再适用的经常性支出

**情境**：您暂时两个月没有租房，因此您希望停用"房租"支出，而不是完全删除它。

**步骤**：
1. 前往"经常性支出"画面
2. 在列表中找到"房租"项目
3. 点击项目右侧的"启用"开关
4. 应用程序显示确认对话框："您确定要停用此支出吗？"
5. 点击"停用"按钮以确认

**结果**："房租"卡片变更为"已停用"状态（灰色），开关变更为"已停用"。应用程序不再为此支出创建新的发生事件。您可以通过点击"已停用"→"启用"开关来重新启用。

**带开关的列表画面**：

```text
┌─────────────────────────────────────────┐
│  ← 返回    经常性支出                    │
├─────────────────────────────────────────┤
│  ┌───────────────────────────────────┐ │
│  │ 房租              [⚪ 已停用]      │ │
│  │ 8,400                             │ │
│  │ 每月 - 1日                         │ │
│  │ (已停用)                           │ │
│  │                                    │ │
│  │ [编辑] [历史记录] [删除]           │ │
│  └───────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## 6. 逻辑与规则

### 6.1 周期与日期

- **每周**：选择星期几（1=星期一，7=星期日）
- **每两周**：选择星期几 + 特定开始日期
- **每月**：选择月份中的日期（1-31）

### 6.2 自动创建发生事件

- 应用程序在以下情况自动创建**发生事件**：
  - 新增支出时
  - 达到周期中的日期时
  - 新月份开始时

### 6.3 发生事件状态

- **待处理**：待确认（显示黄色标签）
- **已完成**：已确认（显示绿色标签）
- **已取消**：已取消（显示红色标签）

### 6.4 预算整合

- 确认支出时，应用程序自动更新当前月份的预算（如果存在）
- 支出计算到预算中的"经常性支出"

### 6.5 通知

- 应用程序在付款到期时发送提醒通知
- 通知时间可为每个项目配置（`notificationTime1`、`notificationTime2`，默认为 16:00 和 19:00）

## 7. 重要注意事项

- **金额可留空**：如果您不知道确切金额，可以留空并在确认时输入
- **存在发生事件时无法删除**：如果存在发生事件，您只能停用（isActive = false），无法删除
- **延迟确认**：您可以确认过去的发生事件，应用程序将自动重新计算预算
- **更改周期**：编辑周期时，未来的发生事件将重新计算

