# バックアップと復元

## 1. 目的

**バックアップと復元**モジュールは、以下を支援します：
- すべてのアプリデータをファイルにバックアップ
- バックアップファイルからデータを復元
- デバイスエラーやアプリ再インストールによるデータ損失から保護

## 2. 使用するタイミング

以下の場合にこのモジュールを使用します：
- アプリ再インストール前にデータをバックアップ
- 新しいデバイスにデータを転送
- データ損失後にデータを復元
- 定期的なバックアップを作成

## 3. 関連画面

- バックアップ画面
- 復元画面

## 4. 主な使用方法

### 4.1 データをバックアップ

1. **設定** → **バックアップとデータ** → **バックアップ**に移動
2. 情報を確認：
   - バックアップされるレコード数
   - 予想ファイルサイズ
3. **バックアップ**をタップ
4. 保存場所を選択（ファイルシステム）
5. バックアップファイルが作成されます（名前: `dla-backup-YYYY-MM-DD-HHmmss.json`）
6. このファイルを安全な場所（クラウド、コンピューターなど）に保存

### 4.2 データを復元

1. **設定** → **バックアップとデータ** → **復元**に移動
2. ファイルシステムからバックアップファイルを選択
3. ファイル情報を確認：
   - バックアップ作成日
   - レコード数
   - ファイルサイズ
4. **警告**: 復元はすべての現在のデータを上書きします
5. **復元**をタップ
6. 復元を確認
7. 復元プロセスが完了するまで待機
8. アプリが自動的に再読み込みされます

## 5. UI図解（ワイヤーフレーム）

### 5.1 バックアップ画面

```text
┌─────────────────────────────────────────┐
│  ← 戻る    データをバックアップ          │
├─────────────────────────────────────────┤
│  バックアップ情報                        │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │ レコード数                           │ │
│  │ 1,234件                             │ │
│  │                                    │ │
│  │ 予想サイズ                           │ │
│  │ ~2.5 MB                             │ │
│  │                                    │ │
│  │ バックアップされるデータ:            │ │
│  │ • 定期収入                           │ │
│  │ • 定期支出                           │ │
│  │ • 日々の支出                         │ │
│  │ • 予算                               │ │
│  │ • 貯蓄                               │ │
│  │ • ローン                             │ │
│  │ • 特別な日                           │ │
│  │ • カテゴリ                           │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [バックアップ]                         │
└─────────────────────────────────────────┘
```

### 5.2 復元画面

```text
┌─────────────────────────────────────────┐
│  ← 戻る    データを復元                  │
├─────────────────────────────────────────┤
│  バックアップファイルを選択               │
│                                         │
│  [ファイルを選択...]                     │
│                                         │
│  ファイル情報                            │
│  ┌───────────────────────────────────┐ │
│  │ ファイル: dla-backup-2024-11-15.json│ │
│  │                                    │ │
│  │ 作成日: 2024/11/15 10:30          │ │
│  │                                    │ │
│  │ レコード数: 1,234                  │ │
│  │                                    │ │
│  │ サイズ: 2.5 MB                     │ │
│  └───────────────────────────────────┘ │
│                                         │
│  ⚠️ 警告                                 │
│  復元はすべての現在のデータを上書きします。│
│  よろしいですか？                        │
│                                         │
│  [復元] [キャンセル]                    │
└─────────────────────────────────────────┘
```

## 6. ロジックとルール

### 6.1 バックアップファイル形式

- バックアップファイルはJSON形式
- ファイル名: `dla-backup-YYYY-MM-DD-HHmmss.json`
- すべてのデータを含む: ユーザー、カテゴリ、取引、予算など

### 6.2 バックアップされるデータ

- データベース内のすべてのテーブル
- システムデータとユーザーデータの両方を含む
- 含まれないもの: アプリ設定、環境設定（言語、通貨）

### 6.3 復元

- 復元はすべての現在のデータを削除します
- その後、バックアップファイルからデータをインポートします
- 復元完了後、アプリが自動的に再読み込みされます

### 6.4 検証

- アプリは復元前にファイル形式をチェックします
- バージョン互換性をチェック（ある場合）
- ファイルが無効な場合はエラーを表示します

## 7. 重要な注意事項

- **定期的にバックアップ**: 定期的に（週次または月次）バックアップする必要があります
- **複数の場所に保存**: バックアップファイルを複数の場所（クラウド、コンピューター、USB）に保存
- **復元は現在のデータを失います**: 復元前に現在のデータをバックアップしたことを確認してください
- **元に戻せません**: 復元後、元に戻すことはできません

