# 儲蓄

## 1. 目的

**儲蓄**模組可協助您管理銀行儲蓄帳戶、追蹤餘額、利率和期限。此模組支援：
- 管理多個儲蓄帳戶
- 追蹤利率和期限
- 到期時自動計算利息
- 提前提款（如需要）
- 帳戶展期

## 2. 使用時機

當您有：
- 銀行儲蓄帳戶時
- 需要追蹤餘額和利率時
- 希望到期時收到提醒時
- 需要管理多個儲蓄帳戶時

## 3. 相關畫面

- 儲蓄帳戶清單
- 新增帳戶
- 編輯帳戶
- 帳戶詳細資訊
- 提前提款

## 4. 主要使用方式

### 4.1 建立新儲蓄帳戶

1. 前往**功能** → 選擇**銀行儲蓄**
2. 點擊右下角的 **+** (FAB) 按鈕
3. 查看「目前餘額」（可點擊查看詳細資訊）
4. 選擇銀行：
   - 如果存在：從下拉選單中選擇
   - 如果不存在：點擊「+」按鈕建立新銀行
5. 輸入存款金額（必須 ≤ 目前餘額）
6. 輸入期限：1-36 個月
7. 輸入利率：%/年（1-100%）
8. 選擇開始日期（預設為今天，可選擇從上個月到現在）
9. 查看自動計算的到期日（從開始日期 + 期限）
10. 選擇到期計劃：
    - 提領本金和利息（預設）
    - 展期本金（利息到帳戶）
    - 展期本金 + 利息
11. （選填）輸入備註
12. （選填）選擇通知時間（預設：10:00 和 19:00）
13. 點擊**建立帳戶**

### 4.2 查看清單和帳戶詳細資訊

1. 前往**功能** → 選擇**銀行儲蓄**
2. 查看「儲蓄帳戶清單」畫面，預設篩選為「啟用中」
3. 查看概覽卡片：
   - 篩選「啟用中」：目前餘額、儲蓄中的金額、預期利息、本月利息
   - 篩選「已完成」：總提領金額、收到的利息
4. （選填）使用搜尋列依銀行名稱或代碼尋找帳戶
5. 在「啟用中」和「已完成」之間切換篩選
6. 點擊儲蓄帳戶查看詳細資訊：
   - 帳戶資訊：銀行、期限、利率、存款金額、估計利息
   - 開始日期和到期日
   - 狀態：啟用中
   - 到期計劃
   - （如存在）展期歷史
   - 「提領」按鈕（如啟用中）

### 4.3 提領儲蓄帳戶

1. 前往儲蓄清單，找到已達到或超過到期日的帳戶
2. 點擊卡片上的**提領**按鈕（或前往詳細資訊然後點擊「提領」）
3. 查看「提領儲蓄帳戶」對話框：
   - 帳戶資訊：銀行、存款金額、期限、利率
   - 提領日期（預設 = 到期日，可選擇不同日期）
   - 收到的利息（預設 = 估計利息，可編輯）
   - 總收到金額（自動計算 = 本金 + 利息）
4. （選填）編輯提領日期或收到的利息
5. 點擊**確認**

### 4.4 展期儲蓄帳戶

1. 前往儲蓄清單，找到已達到到期日且計劃為「展期本金」或「展期本金 + 利息」的帳戶
2. 點擊**展期**按鈕或「按計劃展期」
3. 查看「展期儲蓄帳戶」對話框：
   - 帳戶資訊：銀行、本金金額、期限、利率
   - 收到的利息（如果展期本金，利息到帳戶）
4. （選填）編輯新利率或新期限（預設 = 舊期限）
5. 點擊**確認展期**

### 4.5 編輯儲蓄帳戶

1. 前往啟用中儲蓄帳戶詳細資訊
2. 點擊右上角的**編輯**按鈕
3. 編輯資訊：
   - 銀行（如需要）
   - 存款金額（如增加，必須 ≤ 目前餘額）
   - 期限、利率
   - 開始日期（如需要）
   - 到期計劃
   - 備註、通知時間
4. 查看自動重新計算的到期日（如期限/開始日期變更）
5. 點擊**儲存變更**

### 4.6 建立新銀行

1. 在「新增儲蓄帳戶」或「編輯儲蓄帳戶」畫面上
2. 點擊「銀行」欄位
3. 點擊下拉選單旁的「+」按鈕建立新銀行
4. 查看「新增新銀行」對話框
5. 輸入銀行名稱
6. 輸入銀行代碼（最多 3-4 個字元，自動大寫）
7. 選擇圖示顏色（從顏色選擇器或調色板）
8. 查看圖示預覽
9. 點擊**建立**

## 5. 範例與介面說明

### SAVINGS-01：建立新儲蓄帳戶

**目標**：建立新儲蓄帳戶以追蹤銀行存款、利率和到期日。

**主要步驟**：
1. 前往功能 → 銀行儲蓄
2. 點擊「+」(FAB) 按鈕
3. 選擇銀行（或建立新銀行）
4. 輸入存款金額、期限、利率
5. 選擇開始日期（預設今天）
6. 選擇到期計劃
7. （選填）輸入備註和通知時間
8. 點擊「建立帳戶」

**線框圖 - 新增儲蓄帳戶畫面**：

```text
┌──────────────────────────────────────────────┐
│ <  新增儲蓄帳戶                               │
└──────────────────────────────────────────────┘

┌──────────────────────────────────────────────┐
│ [ 卡片 ]                                      │
│                                               │
│ 目前餘額                              [ > ]    │
│ 62,400 TWD                                    │
│                                               │
│ 銀行 *                                        │
│ [ 美國銀行 ▼ ]                         [ + ] │
│                                               │
│ 存款金額 (TWD) *                             │
│ [ 120,000 TWD ]                               │
│                                               │
│ 期限 *                                        │
│ [ 6 ] 個月                                    │
│                                               │
│ 利率 *                                        │
│ [ 4.8 ] %/年                                  │
│                                               │
│ 開始日期 *                                    │
│ [ 12/20/2025 ]                    [📅]        │
│                                               │
│ 到期日（唯讀）                                │
│ [ 06/20/2026 ]                                │
│                                               │
│ 到期計劃                                      │
│ (●) 提領本金和利息                            │
│ ( ) 展期本金                                  │
│ ( ) 展期本金 + 利息                           │
│                                               │
│ 備註（選填）                                  │
│ [                                      ]      │
│                                               │
│ 通知時間 1                                    │
│ [ 10:00 ]                          [🕐]       │
│                                               │
│ 通知時間 2                                    │
│ [ 19:00 ]                          [🕐]       │
└──────────────────────────────────────────────┘

        [  取消  ]       [  建立帳戶  ]
```

---

### SAVINGS-02：提領儲蓄帳戶

**目標**：當儲蓄帳戶達到到期日時提領以收到本金和利息。

**主要步驟**：
1. 前往儲蓄清單，找到已達到或超過到期日的帳戶
2. 點擊「提領」按鈕
3. 查看帶有帳戶資訊、提領日期、收到利息的對話框
4. （選填）編輯提領日期或收到的利息
5. 點擊「確認」

**線框圖 - 提領對話框**：

```text
┌─────────────────────────────────────────┐
│  提領儲蓄帳戶                            │
├─────────────────────────────────────────┤
│  [圖示銀行]  美國銀行                    │
│                                         │
│  期限和利率：6 個月 · 4.8%/年           │
│  存款金額：120,000 TWD                  │
│                                         │
│  提領日期：                              │
│  [ 12 / 20 / 2025 ]  [📅]               │
│                                         │
│  收到的利息：                            │
│  [ 2,880 TWD ]                          │
│                                         │
│  總收到金額：122,880 TWD                │
│                                         │
│  [  確認  ]                              │
└─────────────────────────────────────────┘
```

---

### SAVINGS-03：查看清單和帳戶詳細資訊

**目標**：查看啟用中和已完成的儲蓄帳戶概覽，以及每個帳戶的詳細資訊。

**主要步驟**：
1. 前往功能 → 銀行儲蓄
2. 依篩選查看概覽卡片
3. 使用搜尋列（選填）
4. 在「啟用中」和「已完成」之間切換篩選
5. 點擊帳戶查看詳細資訊

**線框圖 - 清單畫面**：

```text
┌──────────────────────────────────────────────┐
│ <  銀行儲蓄管理                                │
│                  [ + [FAB] 新增帳戶 ]         │
└──────────────────────────────────────────────┘

[晶片] 篩選
[ 啟用中 ]   [ 已完成 ]

┌──────────────────────────────────────────────┐
│  概覽卡片                                    │
│  ┌──────────────┐  ┌──────────────┐         │
│  │ 目前         │  │ 預期         │         │
│  │ 餘額         │  │ 利息         │         │
│  │ 62,400 TWD   │  │ 6,570 TWD    │         │
│  └──────────────┘  └──────────────┘         │
│  ┌──────────────┐  ┌──────────────┐         │
│  │ 儲蓄中的     │  │ 本月的       │         │
│  │ 金額         │  │ 利息         │         │
│  │ 420,000 TWD  │  │ 2,280 TWD    │         │
│  └──────────────┘  └──────────────┘         │
└──────────────────────────────────────────────┘

┌──────────────────────────────────────────────┐
│  🔍 搜尋列                                    │
│  [ 🔍 搜尋... ]                              │
└──────────────────────────────────────────────┘

┌──────────────────────────────────────────────┐
│ [圖示銀行] 美國銀行      [圖示刪除]           │
│                                              │
│ 120,000 TWD      |  6 個月 @ 4.8%           │
│                                              │
│ 估計利息：2,880 TWD                          │
│ 到期：12/20/2025   （剩餘 5 天）            │
│                    🔔 即將到期               │
│                                              │
│                    [ 提領 ]                 │
└──────────────────────────────────────────────┘
```

**線框圖 - 詳細資訊畫面**：

```text
┌──────────────────────────────────────────────┐
│ [圖示銀行]  美國銀行                  [ 編輯 ]│
│                                              │
│ 期限和利率：6 個月 · 4.8%/年                │
│ 存款金額：120,000 TWD                        │
│ 估計利息：2,880 TWD                          │
│                                              │
│ 開始日期：06/20/2025                          │
│ 到期日：（剩餘 5 天）12/20/2025              │
│                                              │
│ 狀態：啟用中                                 │
│                                              │
│ 到期計劃：                                   │
│ (●) 提領本金和利息                          │
│                                              │
│                    [  提領  ]               │
└──────────────────────────────────────────────┘
```

---

### SAVINGS-04：展期儲蓄帳戶

**目標**：當儲蓄帳戶達到到期日時按計劃展期。

**主要步驟**：
1. 找到已達到到期日且計劃為「展期本金」或「展期本金 + 利息」的帳戶
2. 點擊「展期」按鈕
3. 查看帶有帳戶資訊和收到利息的對話框
4. （選填）編輯新利率或新期限
5. 點擊「確認展期」

**結果**：舊帳戶已更新，新帳戶已建立，rootSavingId 連結到舊帳戶。如果展期本金，利息會加到目前餘額。如果展期本金 + 利息，本金和利息都會展期。

---

### SAVINGS-05：建立新銀行

**目標**：建立新銀行以在建立儲蓄帳戶時使用。

**主要步驟**：
1. 在「新增儲蓄帳戶」或「編輯儲蓄帳戶」畫面上
2. 點擊「銀行」下拉選單旁的「+」按鈕
3. 輸入銀行名稱、銀行代碼
4. 選擇圖示顏色
5. 查看圖示預覽
6. 點擊「建立」

**線框圖 - 建立銀行對話框**：

```text
┌─────────────────────────────────────────┐
│  新增新銀行                              │
├─────────────────────────────────────────┤
│  銀行名稱                                │
│  [ ABC 銀行 ]                            │
│                                         │
│  銀行代碼                                │
│  [ ABC ]                                 │
│                                         │
│  圖示顏色                                │
│  [ 🎨 ]  #FF5722                         │
│                                         │
│  預覽圖示                                │
│  ┌─────────┐                             │
│  │   ABC   │  （背景：#FF5722）          │
│  └─────────┘                             │
│                                         │
│  [  取消  ]    [  建立  ]               │
└─────────────────────────────────────────┘
```

---

### SAVINGS-06：編輯儲蓄帳戶

**目標**：編輯啟用中儲蓄帳戶的資訊（銀行、金額、期限、利率、到期計劃）。

**主要步驟**：
1. 前往啟用中儲蓄帳戶詳細資訊
2. 點擊「編輯」按鈕
3. 編輯必要資訊
4. 查看自動重新計算的到期日（如期限/開始日期變更）
5. 點擊「儲存變更」

**結果**：帳戶資訊已更新，估計利息根據新利率重新計算。如果金額變更，目前餘額會相應調整。

## 6. 邏輯與規則

### 6.1 利息計算

- 利息按公式計算：`金額 × 利率 × (期限 / 12)`
- 利息在到期時或提前提款時計算

### 6.2 狀態

- **啟用中 (ACTIVE)**：儲蓄帳戶啟用中，尚未達到到期日或尚未處理
- **已完成 (COMPLETED)**：帳戶已提領
- **已展期 (ROLLED_OVER)**：帳戶已展期，新帳戶已建立

### 6.3 提領和展期

- **提領**：提領時，本金 + 利息會加到目前餘額，自動建立類別為「儲蓄利息」的「額外收入」
- **提前提領**：可在到期日前提領，收到的利息可能低於估計利息
- **展期本金**：利息加到目前餘額，本金以新期限展期
- **展期本金 + 利息**：本金和利息都展期，目前餘額不變
- **展期歷史**：展期會儲存並顯示在帳戶詳細資訊中，透過 `rootSavingId` 連結

### 6.4 通知

- 到期日到達時，應用程式發送提醒通知
- 每個帳戶的通知時間可設定（`notificationTime1`、`notificationTime2`，預設 10:00 和 19:00）

## 7. 重要注意事項

- **需要高級模組**：此功能僅供高級使用者使用
- **利率**：輸入每年利率（%/年），從 1 到 100%
- **期限**：以月計算，從 1 到 36 個月
- **到期日**：從開始日期 + 期限自動計算
- **存款金額**：必須 ≤ 目前餘額，建立帳戶時會自動從目前餘額扣除
- **開始日期**：只能選擇從上個月初到現在
- **通知**：通知在到期日的 2 個時間發送（預設 10:00 和 19:00），可為每個帳戶自訂
- **標籤「即將到期」**：當距離到期日 ≤ 7 天時顯示
- **標籤「已到期」**：當到期日已到達時顯示
- **刪除帳戶**：刪除啟用中帳戶時，本金金額會加回目前餘額。刪除根帳戶將刪除整個展期鏈
- **概覽卡片**：依篩選變更，顯示啟用中或已完成帳戶的彙總資訊

