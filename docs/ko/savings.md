# 저축

## 1. 목적

**저축** 모듈은 은행 저축 계좌를 관리하고 잔액, 금리, 기간을 추적하는 데 도움이 됩니다. 이 모듈은 다음을 지원합니다:
- 여러 저축 계좌 관리
- 금리와 기간 추적
- 만기 시 이자 자동 계산
- 조기 인출 (필요한 경우)
- 계좌 연장

## 2. 사용 시기

다음과 같은 경우 이 모듈을 사용합니다:
- 은행 저축 계좌가 있음
- 잔액과 금리를 추적해야 함
- 만기 시 알림을 원함
- 여러 저축 계좌를 관리해야 함

## 3. 관련 화면

- 저축 계좌 목록
- 새 계좌 추가
- 계좌 편집
- 계좌 상세
- 조기 인출

## 4. 주요 사용 방법

### 4.1 새 저축 계좌 생성

1. **기능** → **은행 저축** 선택
2. 오른쪽 하단의 **+** (FAB) 버튼 탭
3. "현재 잔액" 확인 (클릭하여 상세 표시 가능)
4. 은행 선택:
   - 존재하는 경우: 드롭다운에서 선택
   - 존재하지 않는 경우: "+" 버튼을 탭하여 새 은행 생성
5. 예금액 입력 (현재 잔액 이하여야 함)
6. 기간 입력: 1-36개월
7. 금리 입력: %/년 (1-100%)
8. 시작일 선택 (기본값은 오늘, 전월 초부터 현재까지 선택 가능)
9. 만기일이 자동 계산되는 것을 확인 (시작일 + 기간)
10. 만기 시 계획 선택:
    - 원금과 이자를 인출 (기본값)
    - 원금 연장 (이자는 계좌에)
    - 원금 + 이자 연장
11. (선택 사항) 메모 입력
12. (선택 사항) 알림 시간 선택 (기본값: 10:00 및 19:00)
13. **계좌 생성** 탭

### 4.2 목록 및 계좌 상세 표시

1. **기능** → **은행 저축** 선택
2. 기본 필터 "활성"으로 "저축 계좌 목록" 화면 표시
3. 개요 카드 확인:
   - 필터 "활성": 현재 잔액, 저축액, 예상 이자, 이번 달 이자
   - 필터 "완료": 총 인출액, 수령 이자
4. (선택 사항) 검색 바를 사용하여 은행명 또는 코드로 계좌 검색
5. 필터를 "활성"과 "완료" 사이에서 전환
6. 저축 계좌를 탭하여 상세 표시:
   - 계좌 정보: 은행, 기간, 금리, 예금액, 예상 이자
   - 시작일과 만기일
   - 상태: 활성
   - 만기 시 계획
   - (존재하는 경우) 연장 이력
   - "인출" 버튼 (활성인 경우)

### 4.3 저축 계좌 인출

1. 저축 목록으로 이동하여 만기일에 도달했거나 지난 계좌 찾기
2. 카드의 **인출** 버튼 탭 (또는 상세로 이동하여 "인출" 탭)
3. "저축 계좌 인출" 대화상자 확인:
   - 계좌 정보: 은행, 예금액, 기간, 금리
   - 인출일 (기본값 = 만기일, 다른 날짜 선택 가능)
   - 수령 이자 (기본값 = 예상 이자, 편집 가능)
   - 총 수령액 (자동 계산 = 원금 + 이자)
4. (선택 사항) 인출일 또는 수령 이자 편집
5. **확인** 탭

### 4.4 저축 계좌 연장

1. 저축 목록으로 이동하여 계획 "원금 연장" 또는 "원금 + 이자 연장"으로 만기일에 도달한 계좌 찾기
2. **연장** 버튼 또는 "계획대로 연장" 탭
3. "저축 계좌 연장" 대화상자 확인:
   - 계좌 정보: 은행, 원금액, 기간, 금리
   - 수령 이자 (원금 연장하는 경우, 이자는 계좌에 들어감)
4. (선택 사항) 새 금리 또는 새 기간 편집 (기본값 = 이전 기간)
5. **연장 확인** 탭

### 4.5 저축 계좌 편집

1. 활성 저축 계좌 상세로 이동
2. 오른쪽 상단의 **편집** 버튼 탭
3. 정보 편집:
   - 은행 (필요한 경우)
   - 예금액 (증가하는 경우, 현재 잔액 이하여야 함)
   - 기간, 금리
   - 시작일 (필요한 경우)
   - 만기 시 계획
   - 메모, 알림 시간
4. 만기일이 자동 재계산되는 것을 확인 (기간/시작일이 변경된 경우)
5. **변경 저장** 탭

### 4.6 새 은행 생성

1. "저축 계좌 추가" 또는 "저축 계좌 편집" 화면에서
2. "은행" 필드 탭
3. 드롭다운 옆의 "+" 버튼을 탭하여 새 은행 생성
4. "새 은행 추가" 대화상자 확인
5. 은행명 입력
6. 은행 코드 입력 (최대 3-4자, 자동 대문자)
7. 아이콘 색상 선택 (색상 선택기 또는 팔레트에서)
8. 아이콘 미리보기 확인
9. **생성** 탭

## 5. 예시 및 UI 설명

### SAVINGS-01: 새 저축 계좌 생성

**목표**: 은행 예금, 금리, 만기일을 추적하기 위해 새 저축 계좌를 생성합니다.

**주요 단계**:
1. 기능 → 은행 저축으로 이동
2. "+" (FAB) 버튼 탭
3. 은행 선택 (또는 새로 만들기)
4. 예금액, 기간, 금리 입력
5. 시작일 선택 (기본값은 오늘)
6. 만기 시 계획 선택
7. (선택 사항) 메모와 알림 시간 입력
8. "계좌 생성" 탭

**와이어프레임 - 저축 계좌 추가 화면**:

```text
┌──────────────────────────────────────────────┐
│ <  저축 계좌 추가                             │
└──────────────────────────────────────────────┘

┌──────────────────────────────────────────────┐
│ [ 카드 ]                                      │
│                                               │
│ 현재 잔액                      [ > ]        │
│ ₩2,704,000                                    │
│                                               │
│ 은행 *                                         │
│ [ 신한은행 ▼ ]                        [ + ] │
│                                               │
│ 예금액 (KRW) *                                 │
│ [ ₩5,200,000 ]                                │
│                                               │
│ 기간 *                                         │
│ [ 6 ] 개월                                     │
│                                               │
│ 금리 *                                         │
│ [ 4.8 ] %/년                                   │
│                                               │
│ 시작일 *                                       │
│ [ 2025/12/20 ]                    [📅]        │
│                                               │
│ 만기일 (읽기 전용)                            │
│ [ 2026/06/20 ]                                 │
│                                               │
│ 만기 시 계획                                   │
│ (●) 원금과 이자를 인출                        │
│ ( ) 원금 연장                                 │
│ ( ) 원금 + 이자 연장                          │
│                                               │
│ 메모 (선택 사항)                               │
│ [                                      ]      │
│                                               │
│ 알림 시간1                                     │
│ [ 10:00 ]                          [🕐]       │
│                                               │
│ 알림 시간2                                     │
│ [ 19:00 ]                          [🕐]       │
└──────────────────────────────────────────────┘

        [  취소  ]       [  계좌 생성  ]
```

---

### SAVINGS-02: 저축 계좌 인출

**목표**: 만기일에 도달했을 때 저축 계좌를 인출하여 원금과 이자를 수령합니다.

**주요 단계**:
1. 저축 목록으로 이동하여 만기일에 도달했거나 지난 계좌 찾기
2. "인출" 버튼 탭
3. 계좌 정보, 인출일, 수령 이자를 포함한 대화상자 확인
4. (선택 사항) 인출일 또는 수령 이자 편집
5. "확인" 탭

**와이어프레임 - 인출 대화상자**:

```text
┌─────────────────────────────────────────┐
│  저축 계좌 인출                          │
├─────────────────────────────────────────┤
│  [아이콘 은행]  신한은행                 │
│                                         │
│  기간과 금리: 6개월 · 4.8%/년            │
│  예금액: ₩5,200,000                     │
│                                         │
│  인출일:                                │
│  [ 2025 / 12 / 20 ]  [📅]               │
│                                         │
│  수령 이자:                              │
│  [ ₩124,800 ]                           │
│                                         │
│  총 수령액: ₩5,324,800                  │
│                                         │
│  [  확인  ]                              │
└─────────────────────────────────────────┘
```

---

### SAVINGS-03: 목록 및 계좌 상세 표시

**목표**: 활성 및 완료된 저축 계좌의 개요, 그리고 각 계좌의 상세를 표시합니다.

**주요 단계**:
1. 기능 → 은행 저축으로 이동
2. 필터별 개요 카드 확인
3. 검색 바 사용 (선택 사항)
4. 필터를 "활성"과 "완료" 사이에서 전환
5. 계좌를 탭하여 상세 표시

**와이어프레임 - 목록 화면**:

```text
┌──────────────────────────────────────────────┐
│ <  은행 저축 관리                             │
│                  [ + [FAB] 계좌 추가 ]        │
└──────────────────────────────────────────────┘

[칩] 필터
[ 활성 ]   [ 완료 ]

┌──────────────────────────────────────────────┐
│  개요 카드                                    │
│  ┌──────────────┐  ┌──────────────┐         │
│  │ 현재         │  │ 예상          │         │
│  │ 잔액         │  │ 이자          │         │
│  │ ₩2,704,000   │  │ ₩284,700      │         │
│  └──────────────┘  └──────────────┘         │
│  ┌──────────────┐  ┌──────────────┐         │
│  │ 저축액       │  │ 이번 달       │         │
│  │              │  │ 이자          │         │
│  │ ₩18,200,000  │  │ ₩98,800       │         │
│  └──────────────┘  └──────────────┘         │
└──────────────────────────────────────────────┘

┌──────────────────────────────────────────────┐
│  🔍 검색 바                                   │
│  [ 🔍 검색... ]                               │
└──────────────────────────────────────────────┘

┌──────────────────────────────────────────────┐
│ [아이콘 은행] 신한은행      [아이콘 삭제]     │
│                                              │
│ ₩5,200,000         |  6개월 @ 4.8%          │
│                                              │
│ 예상 이자: ₩124,800                          │
│ 만기: 2025/12/20   (남음 5일)                │
│                    🔔 곧 만기                │
│                                              │
│                    [ 인출 ]                 │
└──────────────────────────────────────────────┘
```

**와이어프레임 - 상세 화면**:

```text
┌──────────────────────────────────────────────┐
│ [아이콘 은행]  신한은행          [ 편집 ]    │
│                                              │
│ 기간과 금리: 6개월 · 4.8%/년                  │
│ 예금액: ₩5,200,000                           │
│ 예상 이자: ₩124,800                          │
│                                              │
│ 시작일: 2025/06/20                           │
│ 만기일: (남음 5일) 2025/12/20                │
│                                              │
│ 상태: 활성                                    │
│                                              │
│ 만기 시 계획:                                 │
│ (●) 원금과 이자를 인출                       │
│                                              │
│                    [  인출  ]               │
└──────────────────────────────────────────────┘
```

---

### SAVINGS-04: 저축 계좌 연장

**목표**: 만기일에 도달했을 때 계획대로 저축 계좌를 연장합니다.

**주요 단계**:
1. 계획 "원금 연장" 또는 "원금 + 이자 연장"으로 만기일에 도달한 계좌 찾기
2. "연장" 버튼 탭
3. 계좌 정보와 수령 이자를 포함한 대화상자 확인
4. (선택 사항) 새 금리 또는 새 기간 편집
5. "연장 확인" 탭

**결과**: 이전 계좌가 업데이트되고, 이전 계좌에 연결된 rootSavingId로 새 계좌가 생성됩니다. 원금을 연장하는 경우, 이자가 현재 잔액에 추가됩니다. 원금 + 이자를 연장하는 경우, 원금과 이자 모두 연장되며 현재 잔액은 변경되지 않습니다.

---

### SAVINGS-05: 새 은행 생성

**목표**: 저축 계좌를 생성할 때 사용할 새 은행을 생성합니다.

**주요 단계**:
1. "저축 계좌 추가" 또는 "저축 계좌 편집" 화면에서
2. "은행" 드롭다운 옆의 "+" 버튼 탭
3. 은행명, 은행 코드 입력
4. 아이콘 색상 선택
5. 아이콘 미리보기 확인
6. "생성" 탭

**와이어프레임 - 은행 생성 대화상자**:

```text
┌─────────────────────────────────────────┐
│  새 은행 추가                           │
├─────────────────────────────────────────┤
│  은행명                                  │
│  [ ABC은행 ]                             │
│                                         │
│  은행 코드                               │
│  [ ABC ]                                │
│                                         │
│  아이콘 색상                             │
│  [ 🎨 ]  #FF5722                        │
│                                         │
│  아이콘 미리보기                         │
│  ┌─────────┐                            │
│  │   ABC   │  (배경: #FF5722)           │
│  └─────────┘                            │
│                                         │
│  [  취소  ]    [  생성  ]               │
└─────────────────────────────────────────┘
```

---

### SAVINGS-06: 저축 계좌 편집

**목표**: 활성 저축 계좌의 정보 (은행, 금액, 기간, 금리, 만기 계획)를 편집합니다.

**주요 단계**:
1. 활성 저축 계좌 상세로 이동
2. "편집" 버튼 탭
3. 필요한 정보 편집
4. 만기일이 자동 재계산되는 것을 확인 (기간/시작일이 변경된 경우)
5. "변경 저장" 탭

**결과**: 계좌 정보가 업데이트되고, 새 금리에 따라 예상 이자가 재계산됩니다. 금액이 변경된 경우, 현재 잔액이 그에 따라 조정됩니다.

## 6. 로직 및 규칙

### 6.1 이자 계산

- 이자는 다음 공식으로 계산됩니다: `금액 × 금리 × (기간 / 12)`
- 이자는 만기 시 또는 조기 인출 시 계산됩니다

### 6.2 상태

- **활성 (ACTIVE)**: 저축 계좌가 활성이며, 만기일에 도달하지 않았거나 처리되지 않음
- **완료 (COMPLETED)**: 계좌가 인출됨
- **연장됨 (ROLLED_OVER)**: 계좌가 연장되고 새 계좌가 생성됨

### 6.3 인출 및 연장

- **인출**: 인출 시, 원금 + 이자가 현재 잔액에 추가되고, "저축 이자" 카테고리로 "임시 수입"이 자동으로 생성됩니다
- **조기 인출**: 만기일 전에 인출할 수 있으며, 수령 이자는 예상 이자보다 낮을 수 있습니다
- **원금 연장**: 이자가 현재 잔액에 추가되고, 원금이 새 기간으로 연장됩니다
- **원금 + 이자 연장**: 원금과 이자 모두 연장되며, 현재 잔액은 변경되지 않습니다
- **연장 이력**: 연장은 저장되며, 계좌 상세에 표시되고 `rootSavingId`를 통해 연결됩니다

### 6.4 알림

- 만기일이 되면 앱이 알림을 전송합니다
- 각 계좌의 알림 시간을 설정할 수 있습니다 (`notificationTime1`, `notificationTime2`, 기본값 10:00 및 19:00)

## 7. 중요 참고 사항

- **프리미엄 모듈 필수**: 이 기능은 프리미엄 사용자만 사용 가능
- **금리**: 연간 금리를 입력 (%/년), 1%부터 100%
- **기간**: 월 단위로 계산, 1개월부터 36개월
- **만기일**: 시작일 + 기간에서 자동 계산
- **예금액**: 현재 잔액 이하여야 하며, 계좌 생성 시 현재 잔액에서 자동으로 차감됩니다
- **시작일**: 전월 초부터 현재까지만 선택 가능
- **알림**: 알림은 만기일에 2회 (기본값 10:00 및 19:00) 전송되며, 각 계좌에서 사용자 정의 가능
- **배지 "곧 만기"**: 만기일까지 ≤7일일 때 표시
- **배지 "만기"**: 만기일이 도래했을 때 표시
- **계좌 삭제**: 활성 계좌를 삭제할 때, 원금액이 현재 잔액에 추가됩니다. 루트 계좌를 삭제하면 연장 체인 전체가 삭제됩니다
- **개요 카드**: 필터에 따라 변경되며, 활성 또는 완료된 계좌의 집계 정보를 표시합니다

