# 银行贷款

## 1. 目的

**银行贷款**模块可帮助您管理银行贷款，包括：
- 追踪贷款金额、利率、期限
- 管理付款时间表
- 按期间计算利息（如适用）
- 管理逾期付款罚款
- 提前结清（如需要）

## 2. 使用时机

当您有：
- 银行贷款时
- 需要追踪付款时间表时
- 想计算利息和罚款时
- 需要付款到期提醒时

## 3. 相关画面

- 贷款清单
- 新增贷款（4 个步骤）
- 编辑贷款
- 贷款详细信息和付款时间表
- 提前结清

## 4. 主要使用方式

### 4.1 新增贷款（4 个步骤）

#### 步骤 1：基本信息

1. 前往**功能** → 选择**银行贷款**
2. 点击 **+** (FAB) 按钮
3. 填写信息：
   - **银行**：选择或创建新银行
   - **贷款名称**：（例如："房屋贷款"）
   - **贷款金额**：本金金额
   - **拨款日期**：收到钱的日期
   - **期限**：年数
   - **利率类型**：促销/浮动利率或固定利率
4. 点击**下一步**

#### 步骤 2：配置利率

**如果选择"促销/浮动利率"：**
- 启用**有促销利率**（如适用）
- 输入**促销月数**和**促销利率**
- 添加浮动利率期间：
  - 选择年份和月份范围
  - 输入利率（%/年）
  - 选择**浮动**或**固定**

**如果选择"固定利率"：**
- 输入**固定利率**（%/年）

点击**下一步**

#### 步骤 3：配置罚款

1. 启用**有逾期付款罚款**（如适用）
2. 添加罚款期间：
   - 选择年份和月份范围
   - 输入**罚款率**（%/年）
3. 点击**下一步**

#### 步骤 4：确认并保存

1. 查看信息：
   - 总付款金额
   - 预期付款时间表
2. 点击**保存**

### 4.2 查看贷款详细信息

1. 前往贷款清单
2. 点击贷款
3. 查看信息：
   - 基本信息
   - 付款时间表
   - 已付金额 / 剩余
   - 利率和罚款

### 4.3 将付款期间标记为已付

1. 前往贷款详细信息
2. 找到到期的付款期间（标签"未付"）
3. 点击**标记为已付**
4. 填写信息：
   - **实际付款日期**：付款日期（默认 = 今天）
   - **实际支付的利息**：实际支付的利息（默认 = 计划利息）
   - **备注**：（可选）
5. 查看自动计算的**总实际付款**（本金 + 实际利息）
6. 点击**确认**

### 4.4 更新当前利率

1. 前往贷款详细信息（仅在当前处于浮动利率期间时显示）
2. 点击**更新当前利率**
3. 填写信息：
   - **新利率**：新利率（%/年）
   - **生效日期**：开始应用新利率的日期（默认 = 当前期间开始）
   - **备注**：（可选）
4. 点击**保存**
5. 从当前期间开始的未付期间将以新利率更新

### 4.5 提前结清

1. 前往贷款详细信息
2. 点击**计算结清金额**
3. **步骤 1 - 输入提前付款信息：**
   - 选择方法：**部分付款**或**完全结清**
   - 选择提前付款日期（默认 = 今天）
   - 输入提前付款金额（如部分付款）
   - 查看自动计算的**提前付款罚款**
4. 点击**下一步**
5. **步骤 2 - 比较选项：**
   - 查看"无提前付款"和"提前付款"之间的比较
   - 查看结果：利息节省、时间减少
6. 点击**确认提前付款**

### 4.6 编辑贷款

1. 前往贷款详细信息
2. 点击**编辑**（仅编辑名称、备注、银行）
3. 编辑可编辑信息：
   - **贷款名称**：可编辑
   - **银行**：可更改
   - **备注**：可编辑
   - **贷款金额、拨款日期、期限、利率**：仅在尚未付款时可编辑
4. 点击**保存**

## 5. 示例与用户界面图示

### LOAN-01：创建新贷款（带促销利率的房屋贷款）

**目标**：创建新贷款以追踪房屋贷款、促销利率和每月付款时间表。

**步骤**：
1. 前往**功能** → 选择**银行贷款**
2. 点击 **+** (FAB) 按钮添加新贷款
3. **步骤 1 - 基本信息：**
   - 选择银行：美国银行
   - 输入名称："房屋贷款 - 市中心公寓"
   - 输入贷款金额：1,400,000 CNY
   - 选择拨款日期：04/01/2023
   - 输入期限：10 年（自动计算 = 120 期）
   - 选择通知时间：10:00 和 19:00
   - 选择利率类型："递减余额"
   - 点击**下一步**
4. **步骤 2 - 配置利率：**
   - 启用"有促销利率期间"
   - 输入：前 6 个月 @ 6.0%/年
   - 添加后续期间：
     - 第 1 年（第 7-12 个月）：9.0%/年，浮动
     - 第 2 年（第 13-24 个月）：9.5%/年，浮动
     - 第 3 年起：10.0%/年，浮动
   - 点击**下一步**
5. **步骤 3 - 配置提前付款罚款：**
   - 启用"应用提前付款罚款"
   - 输入罚款：第 1-3 年：2.0%，第 4-5 年：1.5%，第 6 年起：1.0%
   - 点击**下一步**
6. **步骤 4 - 确认：**
   - 查看摘要信息
   - 点击**创建贷款**

**结果**：贷款创建成功，自动创建 120 期付款时间表，已安排通知。

**线框图 - 步骤 1：基本信息**

```text
┌─────────────────────────────────────────┐
│ <  新增贷款                              │
├─────────────────────────────────────────┤
│ 贷款名称 *                               │
│ [房屋贷款 - 市中心公寓]                  │
│                                          │
│ 银行 *                                    │
│ [美国银行 ▼] [+ 创建新银行]              │
│                                          │
│ 贷款金额 *                                │
│ [1,400,000 CNY]                          │
│                                          │
│ 拨款日期 *                                │
│ [04/01/2023] [📅]                        │
│                                          │
│ 贷款期限（年）*                          │
│ [10] 年                                  │
│ 提示：应用程序自动计算 = 120 期          │
│                                          │
│ 通知时间 1 *                              │
│ [10:00] [🕐]                             │
│                                          │
│ 通知时间 2 *                              │
│ [19:00] [🕐]                             │
│                                          │
│ 利率类型 *                                │
│ ● 递减余额                                │
│ ○ 整个期限固定利率                        │
│                                          │
│ [下一步] [取消]                           │
└─────────────────────────────────────────┘
```

---

### LOAN-02：查看贷款清单和详细信息

**目标**：查看贷款概览，按状态筛选，搜索，并查看每个贷款的详细信息。

**步骤**：
1. 前往**功能** → 选择**银行贷款**
2. 查看带有筛选"启用中"（默认）和"已完成"的清单画面
3. 在筛选之间切换以查看不同的概览
4. 使用搜索栏：输入"市中心"
5. 点击贷款查看详细信息
6. 查看带有已付期间、当前期间和未来期间的付款时间表
7. 在付款时间表中使用搜索栏：输入"9/2024"

**结果**：清单按筛选正确显示，贷款详细信息显示完整信息和付款时间表。

**线框图 - 贷款清单**

```text
┌─────────────────────────────────────────┐
│ <  银行贷款管理                          │
├─────────────────────────────────────────┤
│ [启用中] [已完成]                        │
│                                          │
│ ┌─────────────────────────────────────┐  │
│ │ 当前余额：1,151,500 CNY              │  │
│ │ 原始贷款总额：1,400,000 CNY          │  │
│ │ 已付利息：12,040 CNY                 │  │
│ │ 启用中：1 笔贷款                     │  │
│ └─────────────────────────────────────┘  │
│                                          │
│ [🔍 搜索（贷款名称、银行）]              │
│                                          │
│ ┌─────────────────────────────────────┐  │
│ │ [图标] 美国银行  [启用中]            │  │
│ │ 房屋贷款 - 市中心公寓               │  │
│ │ 余额：1,151,500 CNY                 │  │
│ │ 原始：1,400,000 CNY                 │  │
│ │ 进度：8 / 120 期                    │  │
│ │ 结束日期：04/01/2033                │  │
│ └─────────────────────────────────────┘  │
│                                          │
│                                    [+]   │
└─────────────────────────────────────────┘
```

**线框图 - 贷款详细信息**

```text
┌─────────────────────────────────────────┐
│ <  贷款详细信息                          │
├─────────────────────────────────────────┤
│ [图标] 美国银行                  [编辑]  │
│ 房屋贷款 - 市中心公寓                   │
│ [启用中]                                 │
│                                          │
│ 原始贷款：1,400,000 CNY                  │
│ 当前余额：1,151,500 CNY                  │
│ 已付期间：8 / 120                        │
│ 已付利息：12,040 CNY                     │
│ 当前利率：9.0%/年                        │
│                                          │
│ [更新利率] [计算结清金额]                │
│                                          │
│ 付款时间表                               │
│ [🔍 搜索期间（例如："5/2025"）]        │
│                                          │
│ 期间 1 – 05/2023 [已付]                  │
│ 总计：15.05k CNY • 本金：7k CNY • 利息：8.05k CNY│
│                                          │
│ 期间 9 – 01/2024 [未付]                  │
│ 本金：7,000 CNY                          │
│ 利息：8,050 CNY                          │
│ 总计：15,050 CNY                         │
│ 到期日期：01/15/2024                     │
│ [标记为已付]                             │
│                                          │
│ 期间 10 – 02/2024 [未到期]               │
│ 总计：15.05k CNY • 本金：7k CNY • 利息：8.05k CNY│
└─────────────────────────────────────────┘
```

---

### LOAN-03：将付款期间标记为已付（记录付款）

**目标**：向银行付款后将付款期间标记为"已付"。

**步骤**：
1. 前往贷款详细信息
2. 找到当前期间（期间 9），标签"未付"
3. 点击**标记为已付**
4. 填写信息：
   - 实际付款日期：01/15/2024（默认 = 今天）
   - 实际支付的利息：8,050 CNY（默认 = 计划利息）
   - 备注：（可选）
5. 查看自动计算的总实际付款
6. 点击**确认**

**结果**：期间 9 更新为"已付"，余额减少，已付期间增加，当前余额减少。

**线框图 - 标记为已付对话框**

```text
┌─────────────────────────────────────────┐
│ 标记为已付                               │
├─────────────────────────────────────────┤
│ 期间 9 – 01/2024          [未付]          │
│                                          │
│ 到期日期（计划）：01/15/2024            │
│ 本金（固定）：7,000 CNY                  │
│                                          │
│ 实际付款日期 *                            │
│ [01/15/2024] [📅]                        │
│                                          │
│ 实际支付的利息 *                          │
│ [8,050 CNY]                              │
│ 提示：计划利息：8,050 CNY                │
│                                          │
│ 总实际付款 =                             │
│   7,000 CNY（本金）                      │
│ + 8,050 CNY（实际利息）                 │
│ ────────────────────────────────        │
│ = 15,050 CNY                             │
│                                          │
│ 备注（可选）                              │
│ [少付 350 CNY，获得利息减免...]          │
│                                          │
│ [取消] [确认]                            │
└─────────────────────────────────────────┘
```

---

### LOAN-04：更新当前利率（当银行调整浮动利率时）

**目标**：当银行宣布浮动利率调整时更新新利率。

**步骤**：
1. 前往贷款详细信息
2. 查看"当前利率：9.0%/年"
3. 点击**更新当前利率**（仅在当前处于浮动利率期间时显示）
4. 填写信息：
   - 新利率：10.5%/年
   - 生效日期：01/15/2024（默认 = 当前期间开始）
   - 备注："银行根据新决定调整利率"
5. 点击**保存**

**结果**：当前利率已更新，从当前期间开始的未付期间将以新利率更新。

**线框图 - 更新利率对话框**

```text
┌─────────────────────────────────────────┐
│ 更新当前利率                             │
├─────────────────────────────────────────┤
│ [图标] 美国银行                          │
│ 贷款名称：房屋贷款 - 市中心公寓         │
│ 当前期间：期间 9 – 01/2024               │
│ 状态：[启用中]                           │
│ 期间：浮动（促销后）                     │
│                                          │
│ 当前利率（应用中）：                    │
│ [9.0] %/年（只读）                       │
│                                          │
│ 新利率（%/年）*                          │
│ [10.5] %/年                              │
│                                          │
│ 生效日期 *                               │
│ [01/15/2024] [📅]                        │
│                                          │
│ 备注（可选）                              │
│ [银行调整利率...]                        │
│                                          │
│ • 新利率将应用于从当前期间开始的期间。   │
│ • 先前已付期间不变。                     │
│                                          │
│ [取消] [保存]                            │
└─────────────────────────────────────────┘
```

---

### LOAN-05：提前结清（部分付款以减少利息）

**目标**：提前结清部分贷款以减少总应付利息并缩短贷款期限。

**步骤**：
1. 前往贷款详细信息
2. 点击**计算结清金额**
3. **步骤 1 - 输入提前付款信息：**
   - 选择方法："部分付款"
   - 选择提前付款日期：01/15/2024
   - 输入提前付款金额：560,000 CNY
   - 查看自动计算的罚款：11,200 CNY（2.0%）
   - 点击**下一步**
4. **步骤 2 - 比较选项：**
   - 查看"无提前付款"和"提前付款 560,000 CNY"之间的比较
   - 查看结果：节省 210,000 CNY 利息，减少 40 期
   - 点击**确认提前付款**

**结果**：余额减少，付款时间表重新计算，期间数减少，结束日期提前。

**线框图 - 步骤 1：输入提前付款信息**

```text
┌─────────────────────────────────────────┐
│ <  提前结清                              │
├─────────────────────────────────────────┤
│ [图标] 美国银行                          │
│ 贷款名称：房屋贷款 - 市中心公寓         │
│ 当前余额：1,400,000 CNY                  │
│ 当前期间：期间 9 – 01/2024               │
│                                          │
│ 您想如何结清？                           │
│ ● 部分付款                               │
│ ○ 完全结清                               │
│                                          │
│ 提前付款日期 *                           │
│ [01/15/2024] [📅]                        │
│                                          │
│ 提前付款金额 *                           │
│ [560,000 CNY]                            │
│                                          │
│ 应用的罚款率：2.0%                       │
│ 罚款：11,200 CNY                         │
│                                          │
│ [下一步]                                 │
└─────────────────────────────────────────┘
```

**线框图 - 步骤 2：比较选项**

```text
┌─────────────────────────────────────────┐
│ <  比较选项                               │
├─────────────────────────────────────────┤
│ 选项 A：无提前付款                        │
│ ────────────────────────────────────────│
│ 截至日期的总已付利息：                    │
│   364,000 CNY                           │
│ 剩余总利息：364,000 CNY                 │
│ 剩余期间：112 期                         │
│ 结束日期：04/01/2033                    │
│                                          │
│ 选项 B：提前付款 560,000 CNY             │
│ ────────────────────────────────────────│
│ 提前付款罚款：11,200 CNY                │
│ 截至日期的总已付利息：                    │
│   375,200 CNY                           │
│ 剩余总利息：154,000 CNY                 │
│ 剩余期间：72 期                          │
│ 结束日期：04/01/2029                    │
│                                          │
│ 比较结果：                               │
│ • 利息节省：210,000 CNY                  │
│ • 时间减少：40 期（约 3.5 年）           │
│                                          │
│ [确认提前付款]                           │
└─────────────────────────────────────────┘
```

---

### LOAN-06：编辑贷款（编辑基本信息）

**目标**：开始付款后编辑贷款的基本信息（名称、银行、备注）。

**步骤**：
1. 前往贷款详细信息
2. 点击**编辑**（仅编辑名称、备注、银行）
3. 编辑：
   - 贷款名称："房屋贷款 - 市中心公寓 - 单位 A1-1201"
   - （可选）更改银行：大通银行
   - 备注："转移到新银行"
4. 查看已禁用字段：贷款金额、拨款日期、期限、利率
5. 点击**保存**

**结果**：基本信息已更新，其他信息不变。

**注意**：如果贷款尚未付款，可以编辑所有信息（金额、期限、利率配置）。

## 6. 逻辑与规则

### 6.1 促销/浮动利率

- 可以有促销期间（较低利率）
- 促销期间后，利率按期间浮动
- 每个期间可以是**浮动**（基于市场）或**固定**

### 6.2 逾期付款罚款

- 罚款按 %/年计算
- 可以为每个期间配置不同的罚款
- 罚款仅在付款逾期时适用

### 6.3 付款时间表

- 应用程序根据以下项目自动创建付款时间表：
  - 贷款金额
  - 利率
  - 期限
- 每个付款期间包括：本金 + 利息

### 6.4 提前结清

- 计算剩余金额（本金 + 利息 + 罚款（如有））
- 结清后，贷款将变更为"已完成"状态

### 6.5 通知

- 付款到期时，应用程序发送提醒通知
- 每个贷款的通知时间可配置（`notificationTime1`、`notificationTime2`，默认 10:00 和 19:00）

## 7. 重要注意事项

- **复杂利率**：此模块支持按期间变更的利率，需要仔细配置
- **存在付款时间表时无法删除**：如果付款时间表存在，只能结清，无法删除
- **提前结清**：可能需要额外的罚款费用，取决于银行政策
- **付款时间表**：付款时间表是自动计算的，您无法直接编辑

