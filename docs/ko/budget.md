# 예산

## 1. 목적

**예산** 모듈은 월별 지출을 계획하고 추적하여 설정한 예산을 초과하지 않도록 도와줍니다. 이 모듈은 다음을 기반으로 자동 계산합니다:
- 정기 수입
- 정기 지출
- 실제 일일 지출

## 2. 사용 시기

다음과 같은 경우 이 모듈을 사용합니다:
- 월별 지출 계획
- 예산 초과 방지 관리
- 저축률 추적
- 카테고리별 지출 분석 표시
- 월간 예산 비교

## 3. 관련 화면

- 예산 생성 (최초 또는 전월에서 복사)
- 예산 개요 표시
- 월별 예산 이력
- 전월에서 복사 제안

## 4. 주요 사용 방법

### 4.1 최초 예산 생성 (케이스 A)

1. **기능** → **예산** 선택
2. 예산이 존재하지 않는 경우, 앱이 자동으로 **예산 생성** 화면을 엽니다
3. 앱이 자동 계산하여 표시:
   - **정기 수입**: 모든 활성 정기 수입의 합계 (읽기 전용, 상세 내역 표시)
   - **정기 지출**: 모든 활성 정기 지출의 합계 (읽기 전용, 상세 내역 표시)
   - **총 예산 (저축 전)**: 자동 계산 = 정기 수입 - 정기 지출
4. **저축률** 입력: 저축률% (0-100%, 필수)
5. **저축액**과 **지출 예산**이 자동 계산되는 것을 확인
6. **예산 저장** 탭

### 4.2 전월에서 예산 복사 (케이스 C)

1. **기능** → **예산** 선택
2. 이번 달에 예산이 없고 전월에 예산이 있는 경우, 앱이 **예산 복사 제안** 화면을 표시
3. 다음 중 하나를 선택:
   - **전월 예산 전체 복사**: 앱이 자동으로 저축률을 복사하고, 현재 데이터에서 정기 수입/지출을 재계산하여 즉시 예산 생성
   - **복사 후 조정**: 앱이 전월에서 미리 입력된 저축률로 예산 생성 화면으로 이동, 저장 전 조정 가능
   - **새 예산 생성**: 처음부터 예산 생성 흐름 실행 (케이스 A)
4. "복사 후 조정"을 선택한 경우, 필요에 따라 저축률 조정
5. **예산 저장** 탭

**참고**: 복사 시, 정기 수입과 정기 지출은 현재 정기 데이터에서 재계산됩니다 (전월에서 복사되지 않음). 저축률만 복사됩니다.

### 4.3 예산 개요 표시 (케이스 B)

1. **기능** → **예산** 선택
2. 이번 달에 예산이 있는 경우, 앱이 **개요** 화면을 엽니다
3. 정보 확인:
   - **지출 예산**: 설정된 지출 제한
   - **사용됨**: 지출액 (일일 지출 및 수입/지출 차이 포함)
   - **남음**: 예산의 잔액
   - **사용률**: 사용된 예산의% (경고 색상 포함)
   - **계획에서의 수입·지출 차이**: 원래 계획에서의 차이
   - **카테고리별 일일 지출**: 카테고리별 상세 지출 분석

### 4.4 이번 달 예산 편집

1. **예산 개요** 화면에서 **"예산 편집"** 버튼 탭
2. 앱이 편집 화면을 표시:
   - **정기 수입**과 **정기 지출**: 이전 값 유지 (읽기 전용)
   - **저축률**: 현재 예산에서 미리 입력 (편집 가능)
3. 필요에 따라 저축률 변경
4. 저축액과 지출 예산이 자동 업데이트되는 것을 확인
5. **"예산 저장"** 탭

**참고**: 편집 시, 정기 수입과 정기 지출은 재계산되지 않습니다 (이전 스냅샷 유지). 저축률과 지출 예산만 업데이트됩니다.

### 4.5 예산 이력 표시

1. **기능** → **예산** 선택
2. 메뉴에서 **이력** 선택
3. 과거 월의 예산 목록 표시
4. 월을 탭하여 상세 표시

### 4.6 카테고리별 지출 상세 표시

1. **예산 개요** 화면으로 이동
2. **카테고리별 분석** 섹션까지 스크롤
3. 카테고리 탭
4. 해당 카테고리의 지출 목록 표시

## 5. 예시 및 UI 설명

### 5.1 BUDGET-01: 이번 달 최초 예산 생성

**목표**: 수입과 정기 지출을 기반으로 앱이 자동으로 월별 지출을 계산·추적하도록 최초 예산을 생성합니다.

**단계**:
1. 기능 화면으로 이동, "예산 관리" 선택
2. 앱이 예산이 없음을 자동 감지하고 "예산 생성" 화면 표시
3. 자동 계산된 정보 확인: 정기 수입, 정기 지출, 총 예산 (저축 전)
4. 저축률 입력: 20
5. 저축액과 지출 예산이 자동 계산되는 것을 확인
6. "예산 저장" 버튼 탭

**결과**: 이번 달 예산이 저장되고, 자동으로 "예산 개요" 화면으로 이동합니다.

**UI 설명**:

```text
[ 카드: 2025년 11월 예산 생성 ]
+------------------------------------------------+
||                                                ||
|| 정기 수입                ₩1,560,000           ||
||  • 내 급여 (월간)        ₩1,560,000           ||
||                                                ||
|| 정기 지출                ₩1,190,800           ||
||  • 전기 (월간)            ₩44,200            ||
||  • 수도 (월간)            ₩22,100            ||
||  • BN 학비 (월간)        ₩353,600           ||
||  • 아침식사 & 커피 (주간 x 4) ₩46,800        ||
||  • 주택 대출 상환 (월간)    ₩546,000         ||
||                                                ||
|| (이 데이터는 자동으로 가져옵니다)              ||
+------------------------------------------------+

[ 카드: 총 예산 (저축 전) ]
 ------------------------------------------------
||   ₩1,560,000 (정기 수입)                     ||
|| - ₩1,190,800 (정기 지출)                      ||
||-----------------------------------------------||
|| = ₩369,200 KRW                                 ||
 ------------------------------------------------

[ 카드: 저축률 ]
 ------------------------------------------------
|| 얼마나 저축하고 싶으신가요?                  ||
||                                                ||
|| 저축률 (%)                                     ||
|| [  입력 (필수): 20  ]                          ||
||                                                ||
|| → 상당액: ₩74,100                              ||
 ------------------------------------------------

[ 카드: 지출 예산 ]
 ------------------------------------------------
||    ₩369,200 (총 예산 (저축 전))              ||
|| -  ₩74,100 (저축액)                           ||
||-----------------------------------------------||
|| = ₩295,100 KRW                                 ||
||                                                ||
|| (식사, 교통비, 커피, 작은 쇼핑 등이 포함됩니다) ||
 ------------------------------------------------

[ 버튼 ]
 -------------------------------
||      예산 저장              ||
 -------------------------------
```

---

### 5.2 BUDGET-02: 이번 달 예산 개요 표시

**목표**: 설정한 예산과 비교하여 지출 상황을 표시하며, 사용액, 잔액, 카테고리별 분석을 포함합니다.

**단계**:
1. 기능 화면으로 이동, "예산 관리" 선택
2. 앱이 예산이 존재함을 자동 감지하고 "예산 개요" 화면 표시
3. 카드 1 - 월별 예산 확인: 지출 예산, 사용됨, 남음, 사용률
4. 카드 2 - 계획에서의 수입·지출 차이 확인
5. 카드 3 - 카테고리별 일일 지출 확인
6. (선택 사항) "지출 예산 ›" 클릭하여 예산 계산을 설명하는 상세 대화상자 표시

**결과**: 진행 링/바와 적절한 색상으로 이번 달 예산 정보를 완전히 표시합니다.

**UI 설명**:

```text
[ 카드 1 – 2025년 11월 예산 ]
┌──────────────────────────────────────────────┐
│ 2025년 11월 예산                              │
│                                             │
│ 지출 예산 ›      ₩295,100                   │
│ 사용됨        ₩45,500                      │
│  • 일일 지출              ₩62,400            │   
│  • 수입 차이      -₩208,000                │
│  • 지출 차이       +₩10,400                │
│ 남음            ₩135,200                     │
│                                             │
│                    15.4%                    │
│   (이번 달 지출 예산의 15.4%를 사용했습니다)
│   (이번 달 지출 예산을 거의 다 사용하려고 합니다)
│                                             │
│                               [이력 표시]│
└──────────────────────────────────────────────┘

[ 카드 2 – 계획에서의 수입·지출 차이 ]
┌──────────────────────────────────────────────┐
│ 계획에서의 수입·지출 차이                    │
│                                              │
│ 정기 수입                                       │
│  • 내 급여                 +₩104,000          │
│    (₩624,000 > ₩520,000)                      │
│                                              │
│ 정기 지출                                       │
│  • BN 학비              -₩5,200            │
│    (₩369,200 > ₩364,000)                      │
│                                              │
│ 총 수입 차이:        +₩312,000              │
│ 총 지출 차이:        -₩10,400              │
└──────────────────────────────────────────────┘

[ 카드 3 – 카테고리별 일일 지출 ]
┌──────────────────────────────────────────────┐
│ 카테고리별 일일 지출                        │
│ (식사, 교통비, 커피, 작은 쇼핑 등)           │
│                                             │
│ 일일 지출 합계: ₩62,400                     │
│                                             │
│ 식사              ₩31,200    50% [█████---------]│
│ 교통비             ₩15,600    25% [███-----------]│
│ 커피             ₩10,400     17% [██------------]│
│ 작은 쇼핑         ₩5,200     8%  [█-------------]│
└──────────────────────────────────────────────┘
```

---

### 5.3 BUDGET-03: 이번 달 예산 편집

**목표**: 저축률을 조정하여 이번 달 지출 예산을 변경합니다.

**단계**:
1. "예산 개요" 화면에서 "예산 편집" 버튼 탭
2. 앱이 편집 화면 표시 (예산 생성 화면과 유사)
3. 현재 정보 확인: 정기 수입, 정기 지출 (이전 값 유지)
4. 저축률을 25로 변경
5. 저축액과 지출 예산이 자동 업데이트되는 것을 확인
6. "예산 저장" 버튼 탭

**결과**: 예산이 업데이트되고, 새로운 값으로 "예산 개요" 화면으로 돌아갑니다.

**UI 설명**: BUDGET-01 (예산 생성 화면)과 유사하지만, 정기 수입과 정기 지출 값은 읽기 전용이며 이전 예산에서 유지됩니다.

---

### 5.4 BUDGET-04: 새 달을 시작할 때 전월에서 예산 복사

**목표**: 전월 예산을 재사용하여 새 예산 생성 시간을 절약하고, 필요에 따라 조정하는 옵션을 제공합니다.

**단계**:
1. 기능 화면으로 이동, "예산 관리" 선택
2. 앱이 이번 달에 예산이 없고 전월에 예산이 있음을 자동 감지하고 "예산 복사 제안" 화면 표시
3. "복사 후 조정" 선택
4. 앱이 전월에서 미리 입력된 저축률로 예산 생성 화면으로 이동
5. (선택 사항) 필요에 따라 저축률 조정
6. "예산 저장" 버튼 탭

**결과**: 이번 달의 새 예산이 생성되고, 자동으로 "예산 개요" 화면으로 이동합니다.

**UI 설명**:

```text
[ 화면 ]  2025년 12월 예산
┌──────────────────────────────────────────────┐
│ 2025년 12월에는 예산이 없습니다              │
│                                              │
│ 새 달의 예산을 어떻게 생성하시겠습니까?      │
├──────────────────────────────────────────────┤
│                                              │
│ 📝 복사 후 조정 ›                            │
│    힌트: 2025년 11월 예산을 복사하여 조정     │
│                                              │
├──────────────────────────────────────────────┤
│                                              │
│ ➕ 새 예산 생성 ›                            │
│   힌트: 예산 생성 흐름을 다시 실행            │
│                                              │
└──────────────────────────────────────────────┘
```

"복사 후 조정"을 선택한 후, 예산 생성 화면은 BUDGET-01과 유사하게 표시되지만, 저축률은 전월에서 미리 입력됩니다.

## 6. 로직 및 규칙

### 6.1 케이스

- **케이스 A**: 최초 예산 생성 (어떤 달에도 예산이 없음)
- **케이스 B**: 이번 달에 예산이 있음 → 개요 표시
- **케이스 C**: 이번 달에는 없지만 전월에는 있음 → 복사 제안

### 6.2 자동 계산

- **정기 수입**: 모든 활성 `recurring_income`의 합계
- **정기 지출**: 모든 활성 `recurring_expense`의 합계
- **일일 지출**: 해당 월의 `daily_expense` 합계
- **총 예산**: 정기 수입 + 임시 수입
- **저축**: 총 예산 × 저축률

### 6.3 다른 모듈과의 통합

- 정기 수입을 확인하면 → 예산을 자동 업데이트
- 정기 지출을 확인하면 → 예산을 자동 업데이트
- 일일 지출은 예산에 자동 계산됩니다

### 6.4 예산 초과 경고

- 지출이 예산을 초과하면 앱이 경고를 표시합니다
- 홈 화면과 알림에 경고가 표시됩니다

### 6.5 스냅샷

- 예산을 생성할 때, 앱은 수입/지출 항목의 스냅샷을 생성하여 해당 시점의 상태를 저장합니다
- 스냅샷은 비교 및 분석에 사용됩니다

## 7. 중요 참고 사항

- **월당 하나의 예산**: 각 달의 예산을 생성해야 합니다
- **예산 편집**: 저축률을 변경하여 이번 달 예산을 편집할 수 있습니다. 정기 수입과 정기 지출은 변경되지 않습니다 (스냅샷)로 정확성을 보장합니다
- **자동 업데이트**: 수입/지출을 확인하면 예산이 자동으로 업데이트됩니다
- **전월에서 복사**: 복사 기능으로 예산 생성 시간을 절약할 수 있습니다

