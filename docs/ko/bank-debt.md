# 은행 대출

## 1. 목적

**은행 대출** 모듈은 은행 대출을 관리하는 데 도움이 됩니다:
- 대출액, 금리, 기간 추적
- 상환 일정 관리
- 기간별 이자 계산 (해당하는 경우)
- 연체 페널티 관리
- 조기 상환 (필요한 경우)

## 2. 사용 시기

다음과 같은 경우 이 모듈을 사용합니다:
- 은행 대출이 있음
- 상환 일정을 추적해야 함
- 이자와 페널티를 계산하고 싶음
- 상환 만기일에 알림이 필요함

## 3. 관련 화면

- 대출 목록
- 새 대출 추가 (4단계)
- 대출 편집
- 대출 상세 및 상환 일정
- 조기 상환

## 4. 주요 사용 방법

### 4.1 새 대출 추가 (4단계)

#### 단계 1: 기본 정보

1. **기능** → **은행 대출** 선택
2. **+** (FAB) 버튼 탭
3. 정보 입력:
   - **은행**: 은행 선택 또는 새로 만들기
   - **대출명**: (예: "주택 대출")
   - **대출액**: 원금액
   - **대출 실행일**: 돈을 받은 날짜
   - **기간**: 연수
   - **금리 유형**: 우대/변동 금리 또는 고정 금리
4. **다음** 탭

#### 단계 2: 금리 설정

**"우대/변동 금리"를 선택한 경우:**
- **우대 금리 있음** 활성화 (해당하는 경우)
- **우대 기간**과 **우대 금리** 입력
- 변동 금리 기간 추가:
  - 연과 월 범위 선택
  - 금리 (%/년) 입력
  - **변동** 또는 **고정** 선택

**"고정 금리"를 선택한 경우:**
- **고정 금리** (%/년) 입력

**다음** 탭

#### 단계 3: 페널티 설정

1. **연체 페널티 있음** 활성화 (해당하는 경우)
2. 페널티 기간 추가:
   - 연과 월 범위 선택
   - **페널티율** (%/년) 입력
3. **다음** 탭

#### 단계 4: 확인 및 저장

1. 정보 확인:
   - 총 상환액
   - 예상 상환 일정
2. **저장** 탭

### 4.2 대출 상세 표시

1. 대출 목록으로 이동
2. 대출 탭
3. 정보 확인:
   - 기본 정보
   - 상환 일정
   - 상환액 / 잔액
   - 금리와 페널티

### 4.3 상환 기간을 상환 완료로 표시

1. 대출 상세로 이동
2. 만기일의 상환 기간 (배지 "미납") 찾기
3. **상환 완료로 표시** 탭
4. 정보 입력:
   - **실제 상환일**: 상환한 날짜 (기본값 = 오늘)
   - **실제로 지불한 이자**: 실제로 지불한 이자 (기본값 = 예정 이자)
   - **메모**: (선택 사항)
5. **실제 총 상환액**이 자동 계산되는 것을 확인 (원금 + 실제 이자)
6. **확인** 탭

### 4.4 현재 금리 업데이트

1. 대출 상세로 이동 (현재 변동 금리 기간인 경우에만 표시)
2. **현재 금리 업데이트** 탭
3. 정보 입력:
   - **새 금리**: 새 금리 (%/년)
   - **적용 시작일**: 새 금리를 적용 시작하는 날짜 (기본값 = 현재 기간의 시작)
   - **메모**: (선택 사항)
4. **저장** 탭
5. 현재 기간 이후의 미납 기간이 새 금리로 업데이트됩니다

### 4.5 조기 상환

1. 대출 상세로 이동
2. **상환액 계산** 탭
3. **단계 1 - 선불 정보 입력:**
   - 방법 선택: **일부 상환** 또는 **전액 상환**
   - 선불일 선택 (기본값 = 오늘)
   - 선불액 입력 (일부 상환인 경우)
   - **조기 상환 페널티**가 자동 계산되는 것을 확인
4. **다음** 탭
5. **단계 2 - 옵션 비교:**
   - "선불 없음"과 "선불" 비교 확인
   - 결과 확인: 이자 절약, 기간 단축
6. **선불 확인** 탭

### 4.6 대출 편집

1. 대출 상세로 이동
2. **편집** 탭 (이름, 메모, 은행만 편집 가능)
3. 편집 가능한 정보 편집:
   - **대출명**: 편집 가능
   - **은행**: 변경 가능
   - **메모**: 편집 가능
   - **대출액, 대출 실행일, 기간, 금리**: 상환이 아직 이루어지지 않은 경우에만 편집 가능
4. **저장** 탭

## 5. 예시 및 UI 설명

### LOAN-01: 새 대출 생성 (우대 금리 포함 주택 대출)

**목표**: 주택 대출, 우대 금리, 월별 상환 일정을 추적하기 위해 새 대출을 생성합니다.

**단계**:
1. **기능** → **은행 대출** 선택
2. **+** (FAB) 버튼을 탭하여 새 대출 추가
3. **단계 1 - 기본 정보:**
   - 은행 선택: 신한은행
   - 이름 입력: "주택 대출 - 도심 아파트"
   - 대출액 입력: ₩260,000,000
   - 대출 실행일 선택: 2023/04/01
   - 기간 입력: 10년 (자동 계산 = 120기간)
   - 알림 시간 선택: 10:00 및 19:00
   - 금리 유형 선택: "원리금 균등 상환"
   - **다음** 탭
4. **단계 2 - 금리 설정:**
   - "우대 금리 기간 있음" 활성화
   - 입력: 처음 6개월 @ 6.0%/년
   - 이후 기간 추가:
     - 1년차 (7-12개월): 9.0%/년, 변동
     - 2년차 (13-24개월): 9.5%/년, 변동
     - 3년차 이후: 10.0%/년, 변동
   - **다음** 탭
5. **단계 3 - 조기 상환 페널티 설정:**
   - "조기 상환 페널티 적용" 활성화
   - 페널티 입력: 1-3년차: 2.0%, 4-5년차: 1.5%, 6년차 이후: 1.0%
   - **다음** 탭
6. **단계 4 - 확인:**
   - 요약 정보 확인
   - **대출 생성** 탭

**결과**: 대출이 성공적으로 생성되고, 120기간의 상환 일정이 자동으로 생성되며, 알림이 스케줄됩니다.

**와이어프레임 - 단계 1: 기본 정보**

```text
┌─────────────────────────────────────────┐
│ <  대출 추가                             │
├─────────────────────────────────────────┤
│ 대출명 *                                 │
│ [주택 대출 - 도심 아파트]                │
│                                          │
│ 은행 *                                   │
│ [신한은행 ▼] [+ 새로 만들기]            │
│                                          │
│ 대출액 *                                 │
│ [₩260,000,000]                           │
│                                          │
│ 대출 실행일 *                            │
│ [2023/04/01] [📅]                        │
│                                          │
│ 대출 기간 (년) *                         │
│ [10] 년                                  │
│ 힌트: 앱이 자동 계산 = 120기간           │
│                                          │
│ 알림 시간1 *                             │
│ [10:00] [🕐]                             │
│                                          │
│ 알림 시간2 *                             │
│ [19:00] [🕐]                             │
│                                          │
│ 금리 유형 *                              │
│ ● 원리금 균등 상환                        │
│ ○ 전 기간 고정 금리                      │
│                                          │
│ [다음] [취소]                            │
└─────────────────────────────────────────┘
```

---

### LOAN-02: 대출 목록 및 상세 표시

**목표**: 대출의 개요를 표시하고, 상태로 필터링하고, 검색하며, 각 대출의 상세를 표시합니다.

**단계**:
1. **기능** → **은행 대출** 선택
2. 필터 "활성" (기본값)과 "완료"로 목록 화면 표시
3. 필터를 전환하여 다른 개요 확인
4. 검색 바 사용: "도심" 입력
5. 대출을 탭하여 상세 표시
6. 상환 완료 기간, 현재 기간, 향후 기간을 포함한 상환 일정 확인
7. 상환 일정의 검색 바 사용: "2024/9" 입력

**결과**: 목록이 필터별로 올바르게 표시되고, 대출 상세가 완전한 정보와 상환 일정을 표시합니다.

**와이어프레임 - 대출 목록**

```text
┌─────────────────────────────────────────┐
│ <  은행 대출 관리                        │
├─────────────────────────────────────────┤
│ [활성] [완료]                            │
│                                          │
│ ┌─────────────────────────────────────┐  │
│ │ 현재 잔액: ₩213,850,000            │  │
│ │ 총 원금 대출: ₩260,000,000          │  │
│ │ 지불한 이자: ₩2,236,000              │  │
│ │ 활성: 1대출                          │  │
│ └─────────────────────────────────────┘  │
│                                          │
│ [🔍 검색 (대출명, 은행)]                │
│                                          │
│ ┌─────────────────────────────────────┐  │
│ │ [아이콘] 신한은행  [활성]            │  │
│ │ 주택 대출 - 도심 아파트              │  │
│ │ 잔액: ₩213,850,000                  │  │
│ │ 원금: ₩260,000,000                  │  │
│ │ 진행: 8 / 120기간                   │  │
│ │ 종료일: 2033/04/01                   │  │
│ └─────────────────────────────────────┘  │
│                                          │
│                                    [+]   │
└─────────────────────────────────────────┘
```

**와이어프레임 - 대출 상세**

```text
┌─────────────────────────────────────────┐
│ <  대출 상세                             │
├─────────────────────────────────────────┤
│ [아이콘] 신한은행          [편집]        │
│ 주택 대출 - 도심 아파트                   │
│ [활성]                                    │
│                                          │
│ 원금 대출: ₩260,000,000                  │
│ 현재 잔액: ₩213,850,000                  │
│ 상환 완료 기간: 8 / 120                  │
│ 지불한 이자: ₩2,236,000                  │
│ 현재 금리: 9.0%/년                       │
│                                          │
│ [금리 업데이트] [상환액 계산]            │
│                                          │
│ 상환 일정                                 │
│ [🔍 기간 검색 (예: "2025/5")]           │
│                                          │
│ 기간1 – 2023/05 [상환 완료]              │
│ 합계: ₩2,795,000 • 원금: ₩1,300,000 • 이자: ₩1,495,000│
│                                          │
│ 기간9 – 2024/01 [미납]                   │
│ 원금: ₩1,300,000                         │
│ 이자: ₩1,495,000                         │
│ 합계: ₩2,795,000                         │
│ 만기일: 2024/01/15                       │
│ [상환 완료로 표시]                       │
│                                          │
│ 기간10 – 2024/02 [만기 전]                │
│ 합계: ₩2,795,000 • 원금: ₩1,300,000 • 이자: ₩1,495,000│
└─────────────────────────────────────────┘
```

---

### LOAN-03: 상환 기간을 상환 완료로 표시 (상환 기록)

**목표**: 은행에 상환을 한 후, 상환 기간을 "상환 완료"로 표시합니다.

**단계**:
1. 대출 상세로 이동
2. 배지 "미납"이 붙은 현재 기간 (기간9) 찾기
3. **상환 완료로 표시** 탭
4. 정보 입력:
   - 실제 상환일: 2024/01/15 (기본값 = 오늘)
   - 실제로 지불한 이자: ₩1,495,000 (기본값 = 예정 이자)
   - 메모: (선택 사항)
5. 실제 총 상환액이 자동 계산되는 것을 확인
6. **확인** 탭

**결과**: 기간9가 "상환 완료"로 업데이트되고, 잔액이 감소하며, 상환 완료 기간이 증가하고, 현재 잔액이 감소합니다.

**와이어프레임 - 상환 완료로 표시 대화상자**

```text
┌─────────────────────────────────────────┐
│ 상환 완료로 표시                         │
├─────────────────────────────────────────┤
│ 기간9 – 2024/01          [미납]         │
│                                          │
│ 만기일 (예정): 2024/01/15               │
│ 원금 (고정): ₩1,300,000                 │
│                                          │
│ 실제 상환일 *                            │
│ [2024/01/15] [📅]                        │
│                                          │
│ 실제로 지불한 이자 *                     │
│ [₩1,495,000]                            │
│ 힌트: 예정 이자: ₩1,495,000             │
│                                          │
│ 실제 총 상환액 =                         │
│   ₩1,300,000 (원금)                     │
│ + ₩1,495,000 (실제 이자)                │
│ ────────────────────────────────        │
│ = ₩2,795,000                             │
│                                          │
│ 메모 (선택 사항)                         │
│ [₩50 적게 지불, 이자 감면을 받았습니다...]│
│                                          │
│ [취소] [확인]                            │
└─────────────────────────────────────────┘
```

---

### LOAN-04: 현재 금리 업데이트 (은행이 변동 금리를 조정한 경우)

**목표**: 은행이 변동 금리 조정을 발표했을 때 새 금리를 업데이트합니다.

**단계**:
1. 대출 상세로 이동
2. "현재 금리: 9.0%/년" 확인
3. **현재 금리 업데이트** 탭 (현재 변동 금리 기간인 경우에만 표시)
4. 정보 입력:
   - 새 금리: 10.5%/년
   - 적용 시작일: 2024/01/15 (기본값 = 현재 기간의 시작)
   - 메모: "은행이 새 결정에 따라 금리를 조정"
5. **저장** 탭

**결과**: 현재 금리가 업데이트되고, 현재 기간 이후의 미납 기간이 새 금리로 업데이트됩니다.

**와이어프레임 - 금리 업데이트 대화상자**

```text
┌─────────────────────────────────────────┐
│ 현재 금리 업데이트                       │
├─────────────────────────────────────────┤
│ [아이콘] 신한은행                        │
│ 대출명: 주택 대출 - 도심 아파트          │
│ 현재 기간: 기간9 – 2024/01              │
│ 상태: [활성]                             │
│ 기간: 변동 (우대 후)                     │
│                                          │
│ 현재 금리 (적용 중):                     │
│ [9.0] %/년 (읽기 전용)                  │
│                                          │
│ 새 금리 (%/년) *                         │
│ [10.5] %/년                              │
│                                          │
│ 적용 시작일 *                            │
│ [2024/01/15] [📅]                        │
│                                          │
│ 메모 (선택 사항)                         │
│ [은행이 금리를 조정...]                  │
│                                          │
│ • 새 금리는 현재 기간 이후의 기간에 적용됩니다.│
│ • 이전에 지불한 기간은 변경되지 않습니다.│
│                                          │
│ [취소] [저장]                            │
└─────────────────────────────────────────┘
```

---

### LOAN-05: 조기 상환 (일부 상환으로 이자 감소)

**목표**: 대출을 조기에 일부 상환하여 총 이자 지불을 감소시키고, 대출 기간을 단축합니다.

**단계**:
1. 대출 상세로 이동
2. **상환액 계산** 탭
3. **단계 1 - 선불 정보 입력:**
   - 방법 선택: "일부 상환"
   - 선불일 선택: 2024/01/15
   - 선불액 입력: ₩104,000,000
   - 페널티가 자동 계산되는 것을 확인: ₩2,080,000 (2.0%)
   - **다음** 탭
4. **단계 2 - 옵션 비교:**
   - "선불 없음"과 "선불 ₩104,000,000" 비교 확인
   - 결과 확인: 이자 ₩39,000,000 절약, 40기간 감소
   - **선불 확인** 탭

**결과**: 잔액이 감소하고, 상환 일정이 재계산되며, 기간 수가 감소하고, 종료일이 빨라집니다.

**와이어프레임 - 단계 1: 선불 정보 입력**

```text
┌─────────────────────────────────────────┐
│ <  조기 상환                             │
├─────────────────────────────────────────┤
│ [아이콘] 신한은행                        │
│ 대출명: 주택 대출 - 도심 아파트          │
│ 현재 잔액: ₩260,000,000                  │
│ 현재 기간: 기간9 – 2024/01              │
│                                          │
│ 어떻게 상환하시겠습니까?                 │
│ ● 일부 상환                              │
│ ○ 전액 상환                              │
│                                          │
│ 선불일 *                                 │
│ [2024/01/15] [📅]                        │
│                                          │
│ 선불액 *                                 │
│ [₩104,000,000]                           │
│                                          │
│ 적용되는 페널티율: 2.0%                  │
│ 페널티: ₩2,080,000                      │
│                                          │
│ [다음]                                   │
└─────────────────────────────────────────┘
```

**와이어프레임 - 단계 2: 옵션 비교**

```text
┌─────────────────────────────────────────┐
│ <  옵션 비교                             │
├─────────────────────────────────────────┤
│ 옵션 A: 선불 없음                        │
│ ────────────────────────────────────────│
│ 지금까지 지불한 총 이자:                 │
│   ₩67,600,000                            │
│ 남은 총 이자: ₩67,600,000                │
│ 남은 기간: 112기간                       │
│ 종료일: 2033/04/01                      │
│                                          │
│ 옵션 B: 선불 ₩104,000,000                │
│ ────────────────────────────────────────│
│ 조기 상환 페널티: ₩2,080,000            │
│ 지금까지 지불한 총 이자:                 │
│   ₩69,680,000                            │
│ 남은 총 이자: ₩28,600,000                │
│ 남은 기간: 72기간                        │
│ 종료일: 2029/04/01                      │
│                                          │
│ 비교 결과:                               │
│ • 이자 절약: ₩39,000,000                │
│ • 기간 단축: 40기간 (약 3.5년)           │
│                                          │
│ [선불 확인]                              │
└─────────────────────────────────────────┘
```

---

### LOAN-06: 대출 편집 (기본 정보 편집)

**목표**: 상환을 시작한 후, 대출의 기본 정보 (이름, 은행, 메모)를 편집합니다.

**단계**:
1. 대출 상세로 이동
2. **편집** 탭 (이름, 메모, 은행만 편집 가능)
3. 편집:
   - 대출명: "주택 대출 - 도심 아파트 - 유닛 A1-1201"
   - (선택 사항) 은행 변경: 하나은행
   - 메모: "새 은행으로 이전"
4. 비활성화된 필드 확인: 대출액, 대출 실행일, 기간, 금리
5. **저장** 탭

**결과**: 기본 정보가 업데이트되고, 다른 정보는 변경되지 않습니다.

**참고**: 대출에 상환이 아직 이루어지지 않은 경우, 모든 정보 (액수, 기간, 금리 설정)를 편집할 수 있습니다.

## 6. 로직 및 규칙

### 6.1 우대/변동 금리

- 우대 기간 (낮은 금리)을 가질 수 있습니다
- 우대 기간 후, 금리는 기간별로 변동합니다
- 각 기간은 **변동** (시장 기반) 또는 **고정**으로 할 수 있습니다

### 6.2 연체 페널티

- 페널티는 %/년으로 계산됩니다
- 각 기간별로 다른 설정이 가능합니다
- 페널티는 상환이 지연된 경우에만 적용됩니다

### 6.3 상환 일정

- 앱이 다음을 기반으로 상환 일정을 자동으로 생성합니다:
  - 대출액
  - 금리
  - 기간
- 각 상환 기간에는 다음이 포함됩니다: 원금 + 이자

### 6.4 조기 상환

- 잔액 계산 (원금 + 이자 + 페널티 (있는 경우))
- 상환 후, 대출은 "완료" 상태로 변경됩니다

### 6.5 알림

- 상환 만기일이 되면 앱이 알림을 전송합니다
- 각 대출의 알림 시간을 설정할 수 있습니다 (`notificationTime1`, `notificationTime2`, 기본값 10:00 및 19:00)

## 7. 중요 참고 사항

- **복잡한 금리**: 이 모듈은 기간별로 변동하는 금리를 지원하며, 신중한 설정이 필요합니다
- **상환 일정이 존재하는 경우 삭제할 수 없음**: 상환 일정이 존재하는 경우, 상환만 가능하며 삭제는 할 수 없습니다
- **조기 상환**: 추가 페널티 수수료가 필요할 수 있습니다. 은행 정책에 따릅니다
- **상환 일정**: 상환 일정은 자동으로 계산되며, 직접 편집할 수 없습니다

