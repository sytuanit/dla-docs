# ค่าใช้จ่ายประจำ

## 1. วัตถุประสงค์

โมดูล **ค่าใช้จ่ายประจำ** ช่วยให้คุณจัดการค่าใช้จ่ายเป็นระยะที่มีรอบคงที่ เช่น:
- ค่าไฟฟ้า, ค่าน้ำ, ค่าก๊าซ
- อินเทอร์เน็ต, เคเบิลทีวี
- ประกันภัย
- ค่าเล่าเรียน
- ค่าเช่า
- ค่าใช้จ่ายประจำอื่นๆ

โมดูลนี้จะสร้าง **การเกิดขึ้น** อัตโนมัติตามรอบที่คุณกำหนด และเตือนคุณเมื่อถึงเวลาชำระ

## 2. เมื่อใดควรใช้

ใช้โมดูลนี้เมื่อคุณมี:
- ค่าใช้จ่ายคงที่ตามกำหนดเวลา (รายสัปดาห์, รายสองสัปดาห์, หรือรายเดือน)
- ต้องการติดตามและยืนยันเมื่อชำระเงิน
- ต้องการให้คำนวณเข้างบประมาณรายเดือนอัตโนมัติ

## 3. หน้าจอที่เกี่ยวข้อง

- รายการค่าใช้จ่ายประจำ
- เพิ่มค่าใช้จ่ายประจำใหม่
- แก้ไขค่าใช้จ่ายประจำ
- ประวัติการเกิดขึ้น

## 4. การใช้งานหลัก

### 4.1 เพิ่มค่าใช้จ่ายประจำใหม่

1. ไปที่ **ฟังก์ชัน** → เลือก **ค่าใช้จ่ายประจำ**
2. แตะปุ่ม **+** (FAB) ที่มุมล่างขวา
3. กรอกข้อมูล:
   - **หมวดหมู่**: เลือกหรือสร้างหมวดหมู่ใหม่
   - **จำนวนเงิน**: ใส่จำนวนค่าใช้จ่าย (สามารถเว้นว่างไว้ ใส่ตอนยืนยันได้)
   - **รอบ**: เลือก รายสัปดาห์ / รายสองสัปดาห์ / รายเดือน
   - **วันที่**: เลือกวันที่ในรอบ (เช่น วันที่ 15 ของทุกเดือน)
   - **วันที่เริ่มต้น**: (เฉพาะรอบรายสองสัปดาห์) เลือกวันที่เริ่มต้น
   - **หมายเหตุ**: ข้อมูลเพิ่มเติม (ไม่บังคับ)
4. แตะ **บันทึก**

### 4.2 ยืนยันการชำระเงิน

1. ไปที่รายการค่าใช้จ่ายประจำ
2. หารายการที่มีป้าย **"รอยืนยัน"** (สีเหลือง)
3. แตะที่รายการเพื่อเปิดกล่องโต้ตอบยืนยัน
4. กรอกข้อมูล:
   - **จำนวนเงินจริง**: (ถ้าแตกต่างจากที่คาดไว้)
   - **หมายเหตุ**: (ไม่บังคับ)
5. แตะ **ยืนยัน**

### 4.3 แก้ไขค่าใช้จ่ายประจำ

1. ไปที่รายการค่าใช้จ่ายประจำ
2. แตะที่รายการเพื่อแก้ไข
3. เลือก **แก้ไข** จากเมนู
4. อัปเดตข้อมูล
5. แตะ **บันทึก**

### 4.4 ดูประวัติ

1. ไปที่รายการค่าใช้จ่ายประจำ
2. แตะที่รายการ
3. เลือก **ประวัติ** เพื่อดูการเกิดขึ้นทั้งหมดในอดีต

### 4.5 ปิดการใช้งาน/เปิดการใช้งานค่าใช้จ่าย

1. ไปที่รายการค่าใช้จ่ายประจำ
2. หารายการที่ต้องการปิด/เปิดการใช้งาน
3. เปิด/ปิดสวิตช์ **ใช้งาน** ที่ด้านขวาของรายการ

## 5. ตัวอย่างและภาพประกอบ UI

### 5.1 ตัวอย่างที่ 1: สร้างค่าใช้จ่ายประจำรายเดือน (ค่าไฟฟ้า)

**สถานการณ์**: คุณต้องการติดตามค่าไฟฟ้ารายเดือนเพื่อให้แอปเตือนคุณอัตโนมัติเมื่อถึงเวลาชำระ

**ขั้นตอน**:
1. ไปที่หน้าจอฟังก์ชัน เลือก "ค่าใช้จ่ายประจำ"
2. แตะปุ่ม "➕ เพิ่มใหม่" ที่มุมล่างขวา
3. เลือกหมวดหมู่ "สาธารณูปโภค" (หรือสร้างใหม่ถ้ายังไม่มี)
4. ใส่จำนวน: ฿700
5. เลือกรอบ "รายเดือน"
6. เลือก "เลือกวันที่ของเดือน" ใส่ 15
7. หมายเหตุกรอกอัตโนมัติ "ค่าไฟฟ้ารายเดือน" (สามารถแก้ไขได้)
8. แตะ "บันทึก"

**ผลลัพธ์**: แอปแสดงข้อความสำเร็จและกลับไปที่รายการ รายการใหม่ปรากฏพร้อมข้อมูลครบถ้วน และแอปจะเตือนคุณอัตโนมัติในวันที่ 15 ของทุกเดือน

**หน้าจอเพิ่มค่าใช้จ่ายประจำ**:

```text
┌─────────────────────────────────────────┐
│  ← กลับ    เพิ่มค่าใช้จ่ายประจำ          │
├─────────────────────────────────────────┤
│  หมวดหมู่ *                              │
│  [สาธารณูปโภค ▼] [+ เพิ่มใหม่]          │
│                                         │
│  จำนวนเงิน (THB) *                       │
│  [฿700]                                │
│                                         │
│  รอบ *                                   │
│  ┌──────┐ ┌────────┐ ┌────────┐        │
│  │สัปดาห์│ │สองสัปดาห์│ │เดือน  │        │
│  └──────┘ └────────┘ └────────┘        │
│                                         │
│  วันที่ชำระในรอบ                        │
│  ⚪ สิ้นเดือน                            │
│  ⚫ เลือกวันที่ของเดือน                 │
│  ┌───────────────────────────────────┐ │
│  │ วันที่ของเดือน: [15]              │ │
│  └───────────────────────────────────┘ │
│                                         │
│  หมายเหตุ                                │
│  ┌───────────────────────────────────┐ │
│  │ ค่าไฟฟ้ารายเดือน                    │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [ยกเลิก]                  [บันทึก]   │
└─────────────────────────────────────────┘
```

---

### 5.2 ตัวอย่างที่ 2: ยืนยันค่าใช้จ่ายที่ครบกำหนดและอัปเดตจำนวนเงินจริง

**สถานการณ์**: ถึงวันชำระค่าน้ำ (วันที่ 10) แต่จำนวนเงินจริงที่ต้องชำระคือ ฿245 (ลดลง) แทนที่จะเป็น ฿280 ตามที่ตั้งไว้

**ขั้นตอน**:
1. เปิดแอปหรือไปที่หน้าจอ "ค่าใช้จ่ายประจำ"
2. แอปตรวจจับการเกิดขึ้นที่ครบกำหนดอัตโนมัติและแสดงกล่องโต้ตอบยืนยัน
3. กล่องโต้ตอบแสดงจำนวนเงินเริ่มต้น: ฿280
4. อัปเดตจำนวนเงินจริงเป็น ฿245
5. ใส่หมายเหตุ: "เดือนนี้ประหยัดน้ำ" (ไม่บังคับ)
6. แตะ "ยืนยันชำระแล้ว"

**ผลลัพธ์**: แอปอัปเดตการเกิดขึ้นที่ยืนยันแล้วด้วยจำนวนเงินจริง ฿245 สร้างการเกิดขึ้นครั้งถัดไปอัตโนมัติ และอัปเดตยอดเงินปัจจุบัน (หัก ฿245)

**กล่องโต้ตอบยืนยันค่าใช้จ่าย**:

```text
┌─────────────────────────────────────────┐
│  ยืนยันชำระแล้ว                         │
├─────────────────────────────────────────┤
│  ค่าน้ำ                                   │
│  รายเดือน (วันที่ 10)                    │
│  วันที่ครบกำหนด: วันนี้                 │
│                                         │
│  จำนวนเงินจริง *                         │
│  [฿245]                                │
│                                         │
│  หมายเหตุ                                │
│  [เดือนนี้ประหยัดน้ำ]                   │
│                                         │
│  [ยกเลิกนี้]    [ยืนยันชำระแล้ว]       │
└─────────────────────────────────────────┘
```

---

### 5.3 ตัวอย่างที่ 3: ปิดการใช้งานค่าใช้จ่ายประจำเมื่อไม่ใช้แล้ว

**สถานการณ์**: คุณไม่เช่าที่พักชั่วคราวเป็นเวลา 2 เดือน จึงต้องการปิดการใช้งานค่าใช้จ่าย "ค่าเช่า" แทนการลบทั้งหมด

**ขั้นตอน**:
1. ไปที่หน้าจอ "ค่าใช้จ่ายประจำ"
2. หารายการ "ค่าเช่า" ในรายการ
3. แตะสวิตช์ "ใช้งาน" ที่ด้านขวาของรายการ
4. แอปแสดงกล่องโต้ตอบยืนยัน: "คุณแน่ใจหรือไม่ว่าต้องการปิดการใช้งานค่าใช้จ่ายนี้?"
5. แตะปุ่ม "ปิดการใช้งาน" เพื่อยืนยัน

**ผลลัพธ์**: การ์ด "ค่าเช่า" เปลี่ยนสถานะเป็น "ไม่ใช้งาน" (สีเทา) สวิตช์เปลี่ยนเป็น "ไม่ใช้งาน" แอปจะไม่สร้างการเกิดขึ้นใหม่สำหรับค่าใช้จ่ายนี้อีก คุณสามารถเปิดการใช้งานใหม่ได้โดยการแตะสวิตช์ "ไม่ใช้งาน" → "ใช้งาน"

**หน้าจอรายการพร้อมสวิตช์**:

```text
┌─────────────────────────────────────────┐
│  ← กลับ    ค่าใช้จ่ายประจำ               │
├─────────────────────────────────────────┤
│  ┌───────────────────────────────────┐ │
│  │ ค่าเช่า              [⚪ ไม่ใช้งาน] │ │
│  │ ฿42,000                            │
│  │ รายเดือน - วันที่ 1                │
│  │ (ปิดการใช้งานแล้ว)                 │
│  │                                    │
│  │ [แก้ไข] [ประวัติ] [ลบ]             │
│  └───────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## 6. ตรรกะและกฎ

### 6.1 รอบและวันที่

- **รายสัปดาห์**: เลือกวันของสัปดาห์ (1=จันทร์, 7=อาทิตย์)
- **รายสองสัปดาห์**: เลือกวันของสัปดาห์ + วันที่เริ่มต้นเฉพาะ
- **รายเดือน**: เลือกวันที่ของเดือน (1-31)

### 6.2 สร้างการเกิดขึ้นอัตโนมัติ

- แอปสร้าง **การเกิดขึ้น** อัตโนมัติเมื่อ:
  - เพิ่มค่าใช้จ่ายใหม่
  - ถึงวันที่ในรอบ
  - เริ่มเดือนใหม่

### 6.3 สถานะการเกิดขึ้น

- **PENDING**: รอยืนยัน (แสดงป้ายสีเหลือง)
- **COMPLETED**: ยืนยันแล้ว (แสดงป้ายสีเขียว)
- **CANCELLED**: ยกเลิกแล้ว (แสดงป้ายสีแดง)

### 6.4 การรวมเข้างบประมาณ

- เมื่อยืนยันค่าใช้จ่าย แอปจะอัปเดตงบประมาณเดือนปัจจุบันอัตโนมัติ (ถ้ามี)
- ค่าใช้จ่ายจะถูกคำนวณเข้า "ค่าใช้จ่ายประจำ" ในงบประมาณ

### 6.5 การแจ้งเตือน

- แอปส่งการแจ้งเตือนเตือนเมื่อถึงเวลาชำระ
- เวลาแจ้งเตือนสามารถกำหนดได้สำหรับแต่ละรายการ (`notificationTime1`, `notificationTime2`, ค่าเริ่มต้น 16:00 และ 19:00)

## 7. หมายเหตุสำคัญ

- **จำนวนเงินสามารถเว้นว่างได้**: ถ้าคุณไม่ทราบจำนวนเงินที่แน่นอน สามารถเว้นว่างไว้และใส่ตอนยืนยันได้
- **ไม่สามารถลบเมื่อมีการเกิดขึ้น**: ถ้ามีการเกิดขึ้น คุณสามารถปิดการใช้งานเท่านั้น (isActive = false) ไม่สามารถลบได้
- **ยืนยันล่าช้า**: คุณสามารถยืนยันการเกิดขึ้นในอดีตได้ แอปจะคำนวณงบประมาณใหม่อัตโนมัติ
- **เปลี่ยนรอบ**: เมื่อแก้ไขรอบ การเกิดขึ้นในอนาคตจะถูกคำนวณใหม่

