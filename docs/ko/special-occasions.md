# 특별한 날

## 1. 목적

**특별한 날** 모듈은 일년 내내 특별한 날을 관리하고 준비하는 데 도움이 됩니다:
- 특별한 날 관리 (생일, 기념일 등)
- 할 일 목록 생성 (준비 단계)
- 각 준비 단계에 체크리스트 첨부
- 특별한 날 전 알림
- 준비 진행 추적

## 2. 사용 시기

다음과 같은 경우 이 모듈을 사용합니다:
- 일년 내내 특별한 날 관리
- 중요한 날 준비
- 할 일 목록 생성
- 특별한 날 전 알림 수신

## 3. 관련 화면

- 특별한 날 목록
- 새 특별한 날 추가
- 특별한 날 상세 및 준비 단계
- 준비 단계 추가
- 체크리스트 선택
- 새 체크리스트 생성

## 4. 주요 사용 방법

### 4.1 특별한 날 추가

1. **기능** → **특별한 날** 선택
2. **+** (FAB) 버튼 탭
3. 정보 입력:
   - **특별한 날 이름**: (예: "엄마 생일")
   - **날짜**: 일/월 선택 (DatePicker는 일/월만 선택, 연도는 선택 불가)
   - **음력 사용**: (선택 사항) 음력을 사용하는 경우 체크
     - 체크한 경우: 음력 일과 월 입력, 앱이 가장 가까운 양력 날짜를 자동 계산
   - **반복**: 매년 / 올해만
   - **알림 표시**: 시간 선택 (필수, 예: 07:00)
   - **메모**: 추가 정보 (선택 사항)
4. (선택 사항) 준비 단계 추가 (4.2 참조)
5. **저장** 탭

### 4.2 준비 단계 추가

1. 새 특별한 날을 추가할 때: "준비 단계" 섹션에서 **+ 단계 추가** 탭
2. 또는 특별한 날 상세에서: **+ 단계 추가** 탭
3. 정보 입력:
   - **언제?**: "X일 전" 또는 "당일"
   - **일수**: ("X일 전"을 선택한 경우) 특별한 날 전의 일수 입력
   - **알림 표시**: 시간 선택 (필수)
   - **완료할 때까지 매일 반복**: (선택 사항) 매일 알림을 원하는 경우 체크
   - **내용**: 단계명 (필수, 예: "선물 사기")
   - **메모**: (선택 사항)
   - **체크리스트 사용**: (선택 사항) 쇼핑 체크리스트와 연결하려면 체크
4. **추가** (또는 FAB "적용") 탭

### 4.3 체크리스트 생성

1. 준비 단계를 추가할 때, **체크리스트 사용** 체크
2. "쇼핑 체크리스트 선택" 화면이 자동으로 열립니다
3. FAB **+** 탭하여 새 체크리스트 생성
4. 체크리스트명 입력
5. 항목 추가:
   - 항목명 입력
   - **+** 탭하여 새 항목 추가
6. **저장** 탭
7. 새 체크리스트가 자동으로 선택되고, "준비 단계 추가" 화면으로 돌아갑니다

### 4.4 단계를 완료로 표시

1. 특별한 날 상세로 이동
2. 표시할 단계 찾기
3. 체크박스 [ ] 탭하여 [✓]로 변경
4. 체크리스트가 있는 경우, 체크리스트명을 탭하여 항목을 표시하고 체크/체크 해제

### 4.5 진행 표시

1. 특별한 날 상세로 이동
2. "개요" 섹션 확인:
   - 준비 단계: 단계의 총 수
   - 완료: 체크된 단계 수 / 총 단계 수
   - 상태: 미시작 / 진행 중 / 완료

### 4.6 특별한 날 편집

1. 특별한 날 상세로 이동
2. 헤더의 하이퍼링크 **편집 ›** 탭
3. 정보 편집: 이름, 날짜, 반복, 알림 시간, 메모
4. **저장** 탭

### 4.7 준비 단계 편집

1. 특별한 날 상세로 이동
2. 편집할 단계 탭 (삭제 아이콘 제외, 항목 전체 클릭)
3. 정보 편집: 시간, 내용, 체크리스트
4. **적용** (또는 FAB) 탭

## 5. 예시 및 UI 설명

### OCCASION-01: 새 특별한 날 생성 (준비 단계 포함 생일)

**목표**: 준비 단계가 포함된 새 특별한 날 (생일)을 생성하여 앱이 특별한 날 전에 자동으로 알림합니다.

**주요 단계**:
1. 기능 → 특별한 날 → "+" (FAB) 버튼 탭
2. 특별한 날 이름 입력, 날짜 선택 (01/05), 반복 "매년" 선택, 알림 시간 선택 (07:00)
3. 준비 단계 1 추가: "7일 전 – 08:00" - "선물 사기"
4. 준비 단계 2 추가: "1일 전 – 19:00" - "케이크 주문하기"
5. "저장" 탭

**와이어프레임 - 특별한 날 추가 화면**:

```text
┌──────────────────────────────────────────────┐
│ <  특별한 날 추가                             │
└──────────────────────────────────────────────┘

┌──────────────────────────────────────────────┐
│ 📝 특별한 날 정보                             │
│                                               │
│ 특별한 날 이름 *                              │
│ [ 앤의 생일                       ]          │
│                                               │
│ 날짜                                          │
│ [ 01 / 05            ▼ ]                      │
│ (DatePicker는 일/월만 선택)                  │
│                                               │
│ [ ] 음력 사용                                  │
│                                               │
│ 반복                                          │
│ (•) 매년                                      │
│ ( ) 올해만                                    │
│                                               │
│ 알림 표시 *                                   │
│ [ 07:00        ▼ ]                            │
│                                               │
│ 메모 (선택 사항)                               │
│ [                                      ]      │
└──────────────────────────────────────────────┘

┌──────────────────────────────────────────────┐
│ 📋 준비 단계          [ + 단계 추가 ]        │
│ ┌──────────────────────────────────────────┐ │
│ │  1. 선물 사기          [아이콘 삭제]      │ │
│ │     7일 전 – 08:00                       │ │
│ │ ──────────────────────────────────────── │ │
│ │  2. 케이크 주문하기          [아이콘 삭제] │ │
│ │     1일 전 – 19:00                       │ │
│ └──────────────────────────────────────────┘ │
└──────────────────────────────────────────────┘

        [ 취소 ]                        [ 저장 ]
```

---

### OCCASION-02: 음력 사용하여 특별한 날 생성 (쇼핑 체크리스트 포함 기일)

**목표**: 음력을 사용하여 특별한 날 (기일)을 생성하고, 쇼핑 체크리스트에 연결된 준비 단계로 제물 구매를 추적합니다.

**주요 단계**:
1. 기능 → 특별한 날 → "+" (FAB) 버튼 탭
2. 특별한 날 이름 "엄마 기일" 입력, "음력 사용" 체크
3. 음력 날짜 입력: 15/11, 앱이 양력 날짜를 자동 계산: 2025/12/15
4. 3개의 준비 단계 추가, 단계 2에 체크리스트 링크 "제물 사기" 있음
5. "저장" 탭

**와이어프레임 - 음력 날짜 선택**:

```text
│ │ │ 음력 날짜                                   │ │ │
│ │ │ 일 (1-30)    월 (1-12)                      │ │ │
│ │ │ [ 15 ]       [ 11 ]                         │ │ │
│ │ │                                               │ │ │
│ │ │ 양력 날짜 (자동 계산 - 표시만)               │ │ │
│ │ │ [ 텍스트: 2025/12/15                 ]     │ │ │
│ │ │ (이것은 미래의 가장 가까운 양력 날짜입니다)  │ │ │
```

---

### OCCASION-03: 특별한 날 목록 및 상세 표시

**목표**: 특별한 날의 개요를 표시하고, 시간으로 필터링하며, 준비 진행을 포함한 각 특별한 날의 상세를 표시합니다.

**주요 단계**:
1. 기능 → 특별한 날로 이동
2. 필터 "모두", "곧", "이번 달"로 목록 표시
3. 특별한 날 카드를 탭하여 상세 표시
4. 개요 확인: 단계 수, 완료, 상태
5. 체크박스에 체크하여 단계를 완료로 표시

**와이어프레임 - 특별한 날 목록 화면**:

```text
┌────────────────────────────────────────────────────────────┐
│ 📅 특별한 날 목록                                           │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ [ + 특별한 날 추가 ]                                   │ │
│ └────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ 🔍 필터: [ 모두 ]  [ 곧 ]  [ 이번 달 ]                │ │
│ └────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ 📌 엄마 기일    [진행 중] [아이콘 삭제]                │ │
│ │ ┌────────────────────────────────────────────────────┐ │ │
│ │ │ 📅 2025/12/15 • 15/11 (음력) • 남음 10일          │ │ │
│ │ │                                                      │ │ │
│ │ │ ✅ 준비 단계 필요:                                  │ │ │
│ │ │   [✓] 3일 전 – 제물 목록                           │ │ │
│ │ │   [ ] 1일 전 – 제물 사러 가기                      │ │ │
│ │ │   [ ] 당일 – 제단/의식 준비                        │ │ │
│ │ └────────────────────────────────────────────────────┘ │ │
│ └────────────────────────────────────────────────────────┘ │
```

**와이어프레임 - 특별한 날 상세 화면**:

```text
┌─────────────────────────────────────────────────────────┐
│ 📋 특별한 날 상세                                        │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ 📌 엄마 기일                       [편집 ›]            │ │
│ │ ┌────────────────────────────────────────────────────┐ │ │
│ │ │ 2025/12/15 (양력) • 15/11 (음력)                  │ │ │
│ │ │ 남음 10일 • 반복: 매년                              │ │ │
│ │ │                                                      │ │ │
│ │ │ 메모:                                               │ │ │
│ │ │ 작은 식사, 흰 꽃, 손님 제한.                        │ │ │
│ │ └────────────────────────────────────────────────────┘ │ │
│ └────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ 📊 개요                                                │ │
│ │ ┌────────────────────────────────────────────────────┐ │ │
│ │ │ 준비 단계: 3                                        │ │ │
│ │ │ 완료: 1 / 3                                         │ │ │
│ │ │ 상태: [진행 중]                                     │ │ │
│ │ └────────────────────────────────────────────────────┘ │ │
│ └────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ 📝 준비 단계                  [ + 단계 추가 ]          │ │
│ │ ┌────────────────────────────────────────────────────┐ │ │
│ │ │ [✓] 제물 목록                    [아이콘 삭제]      │ │ │
│ │ │     3일 전 – 08:00                                │ │ │
│ │ │     완료 시간 09:15 – 2025/12/12                   │ │ │
│ │ │ ──────────────────────────────────────────────────── │ │ │
│ │ │                                                      │ │ │
│ │ │ [ ] 제물 사러 가기                    [아이콘 삭제] │ │ │
│ │ │     1일 전 – 19:00                                  │ │ │
│ │ │     완료할 때까지 매일 반복                         │ │ │
│ │ │     쇼핑 체크리스트: 제물 사기 ›                    │ │ │
│ │ │     [✓] 완료 3 / 8 항목                             │ │ │
│ │ └────────────────────────────────────────────────────┘ │ │
│ └────────────────────────────────────────────────────────┘ │
```

---

### OCCASION-04: 쇼핑 체크리스트 포함 준비 단계 추가

**목표**: 특별한 날의 새 준비 단계를 추가하고, 쇼핑 체크리스트와 연결하여 쇼핑을 추적합니다.

**주요 단계**:
1. 특별한 날 상세 → "+ 단계 추가" 탭
2. "언제?" 선택: "X일 전", 일수 입력: 1
3. 알림 시간 선택: 19:00
4. "완료할 때까지 매일 반복" 활성화
5. 내용 입력: "제물 사러 가기"
6. "체크리스트 사용" 체크 → 체크리스트 "제물 사기" 선택
7. "추가" 탭

**와이어프레임 - 준비 단계 추가 화면**:

```text
┌────────────────────────────────────────────────────────────┐
│ ➕ 준비 단계 추가                                           │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ ⏰ 준비 시간                                            │ │
│ │ ┌────────────────────────────────────────────────────┐ │ │
│ │ │ 언제? * (필수)                                    │ │ │
│ │ │ [ X일 전         ▼ ]                              │ │ │
│ │ │                                                      │ │ │
│ │ │ 일수 * ("X일 전"을 선택한 경우만 표시)            │ │ │
│ │ │ [  1  ]  일 전                                     │ │ │
│ │ │                                                      │ │ │
│ │ │ 알림 표시 * (필수)                                 │ │ │
│ │ │ [ 19:00        ▼ ]                                 │ │ │
│ │ │                                                      │ │ │
│ │ │ [✓] 완료할 때까지 매일 반복                        │ │ │
│ │ └────────────────────────────────────────────────────┘ │ │
│ └────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ 📝 내용                                                 │ │
│ │ ┌────────────────────────────────────────────────────┐ │ │
│ │ │ 내용 * (필수)                                       │ │ │
│ │ │ [ 제물 사러 가기                       ]            │ │ │
│ │ └────────────────────────────────────────────────────┘ │ │
│ └────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ 🔗 쇼핑 체크리스트와 연결하시겠습니까?                  │ │
│ │ ┌────────────────────────────────────────────────────┐ │ │
│ │ │ ☑ 체크리스트 사용                                   │ │ │
│ │ │ 쇼핑 체크리스트: 제물 사기 ›    [아이콘 교환]       │ │ │
│ │ │ (8항목)                                            │ │ │
│ │ └────────────────────────────────────────────────────┘ │ │
│ └────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ [ 취소 ]                        [ 추가 ]               │ │
│ └────────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────┘
```

---

### OCCASION-05: 준비 단계를 완료로 표시하고 체크리스트 진행 표시

**목표**: 준비 단계를 완료로 표시하고, 쇼핑 체크리스트의 진행을 추적합니다.

**주요 단계**:
1. 특별한 날 상세로 이동
2. 진행 "완료 3 / 8 항목"을 표시하는 체크리스트 포함 단계 확인
3. 체크리스트명을 탭하여 상세를 표시하고 항목을 체크/체크 해제
4. 단계의 체크박스에 체크하여 완료로 표시
5. "개요"가 실시간으로 업데이트되는 것을 확인

---

### OCCASION-06: 특별한 날 및 준비 단계 편집

**목표**: 생성 후 특별한 날의 정보와 준비 단계를 편집합니다.

**주요 단계**:
1. 특별한 날 상세 → "편집 ›" 탭
2. 특별한 날 이름, 메모 편집
3. "저장" 탭
4. 편집할 단계 탭: 시간, 내용 변경
5. 삭제 아이콘을 탭하여 단계 삭제 (확인 대화상자 있음)

## 6. 로직 및 규칙

### 6.1 음력 날짜

- 양력과 음력 모두의 날짜를 입력할 수 있습니다
- 앱이 음력 날짜에 해당하는 양력 날짜를 자동 계산합니다
- 음력에 의한 매년 반복을 지원합니다

### 6.2 반복

- **매년**: 특별한 날은 매년 반복됩니다 (양력 또는 음력)
  - 양력인 경우: 매년, solarDate의 (일/월)을 기반으로 nextOccurDate 계산
  - 음력인 경우: 매년, 음력 날짜에서 해당하는 양력 날짜로 변환하고 nextOccurDate 업데이트
- **올해만**: 특별한 날은 올해만 유효하며, 내년에는 반복되지 않습니다

### 6.3 준비 단계

- **언제?**: 두 가지 옵션이 있습니다:
  - **X일 전**: 특별한 날의 X일 전에 알림 (일수를 입력해야 함)
  - **당일**: 특별한 날의 당일에 알림 (일수를 입력할 필요 없음)
- **알림 표시**: 알림 시간 (필수, 형식 HH:mm)
- **완료할 때까지 매일 반복**: 활성화하면 사용자가 단계를 완료로 표시할 때까지 알림이 매일 반복됩니다
- **체크리스트 연결**: 각 단계는 쇼핑 체크리스트를 첨부하여 쇼핑 진행을 추적할 수 있습니다

### 6.4 체크리스트

- 체크리스트는 여러 단계에서 재사용할 수 있습니다
- 완료한 항목 수 / 총 항목 수 추적 (예: "완료 3 / 8 항목")
- 단계 상세에 "체크리스트명 ›" 링크로 표시되며, 상세를 표시할 수 있습니다
- 체크리스트 내 항목을 체크/체크 해제하여 진행을 업데이트할 수 있습니다
- 체크리스트가 완전히 완료되지 않아도 준비 단계를 완료로 표시할 수 있습니다

### 6.5 알림

- **메인 특별한 날 알림**: `nextOccurDate + reminder_time`으로 생성
  - 매년 특별한 날: 앱 시작 시 알림이 재구성됩니다 (새로 계산된 nextOccurDate 기반)
  - 일회성 특별한 날: 현재 nextOccurDate에 대해 한 번만 알림이 생성됩니다
- **준비 단계 알림**: 다음을 기반으로 알림일 계산:
  - 특별한 날의 `nextOccurDate`
  - `reminderType`과 `daysBefore` (있는 경우)
  - `reminderTime`
- **반복 알림**: `repeatDailyUntilComplete = true`인 경우:
  - 매일 반복 알림 생성
  - `notificationGroupKey`를 사용하여 반복 알림을 그룹화
  - 사용자가 단계를 완료로 표시하면 자동으로 취소

## 7. 중요 참고 사항

- **음력 날짜**: 
  - 앱이 표시를 위해 양력으로 자동 변환합니다
  - 현재 날짜와 비교하여 "미래의 가장 가까운 양력 날짜"를 찾습니다
  - 미래 연도: 시스템은 항상 각 연도의 (음력 일, 음력 월)에서 해당하는 양력 날짜를 재계산합니다
  - 해당 연도에 같은 월의 일반 월과 윤월이 모두 있는 경우: 시스템은 놓침을 방지하기 위해 두 개의 알림을 생성할 수 있습니다
- **매년 반복**: 
  - 특별한 날은 내년 자동으로 nextOccurDate를 재계산합니다
  - 음력인 경우: 매년, 음력 날짜에서 해당하는 양력 날짜로 변환합니다
- **알림 시간**: 
  - 값이 필요합니다 (비워둘 수 없음)
  - 올바른 형식 HH:mm (00:00 - 23:59)이어야 합니다
- **체크리스트**: 
  - 삭제된 체크리스트는 단계에 표시됩니다 (그러나 편집할 수 없음)
  - 체크리스트가 완전히 완료되지 않아도 단계를 완료로 표시할 수 있습니다
- **알림**: 
  - 알림을 수신하려면 설정에서 알림을 활성화해야 합니다
  - 단계를 완료로 표시하면 반복 알림이 자동으로 취소됩니다
- **특별한 날 상태**:
  - **미시작**: 모든 단계가 완료되지 않음 (회색)
  - **진행 중**: 최소한 하나의 단계가 완료되었지만 모두는 아님 (파란색)
  - **완료**: 모든 단계가 완료됨 (진한 녹색)
  - 특별한 날에 준비 단계가 없는 경우: 상태는 날짜로 계산됩니다 (미시작 / 진행 중 / 완료)

