# 备份与还原

## 1. 目的

**备份与还原**模块可帮助您：
- 将所有应用程序数据备份到文件
- 从备份文件还原数据
- 保护数据免于因设备错误或应用程序重新安装而丢失

## 2. 使用时机

当您想：
- 在重新安装应用程序前备份数据时
- 将数据转移到新设备时
- 在数据丢失后还原数据时
- 创建定期备份时

## 3. 相关画面

- 备份画面
- 还原画面

## 4. 主要使用方式

### 4.1 备份数据

1. 前往**设置** → **备份与数据** → **备份**
2. 查看信息：
   - 要备份的记录数
   - 预期文件大小
3. 点击**备份**
4. 选择保存位置（文件系统）
5. 将创建名为 `dla-backup-YYYY-MM-DD-HHmmss.json` 的备份文件
6. 将此文件保存在安全的地方（云端、电脑等）

### 4.2 还原数据

1. 前往**设置** → **备份与数据** → **还原**
2. 从文件系统选择备份文件
3. 查看文件信息：
   - 备份创建日期
   - 记录数
   - 文件大小
4. **警告**：还原将覆盖所有当前数据
5. 点击**还原**
6. 确认还原
7. 等待还原过程完成
8. 应用程序将自动重新加载

## 5. 界面说明（线框图）

### 5.1 备份画面

```text
┌─────────────────────────────────────────┐
│  ← 返回    备份数据                      │
├─────────────────────────────────────────┤
│  备份信息                                │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │ 记录数                              │
│  │ 1,234 条记录                       │
│  │                                    │
│  │ 预期大小                            │
│  │ ~2.5 MB                            │
│  │                                    │
│  │ 要备份的数据：                      │
│  │ • 定期收入                          │
│  │ • 定期支出                          │
│  │ • 日常支出                          │
│  │ • 预算                              │
│  │ • 储蓄                              │
│  │ • 贷款                              │
│  │ • 特殊场合                          │
│  │ • 类别                              │
│  └───────────────────────────────────┘ │
│                                         │
│  [备份]                                 │
└─────────────────────────────────────────┘
```

### 5.2 还原画面

```text
┌─────────────────────────────────────────┐
│  ← 返回    还原数据                      │
├─────────────────────────────────────────┤
│  选择备份文件                            │
│                                         │
│  [选择文件...]                          │
│                                         │
│  文件信息                                │
│  ┌───────────────────────────────────┐ │
│  │ 文件：dla-backup-2024-11-15.json │ │
│  │                                    │
│  │ 创建时间：11/15/2024 10:30        │
│  │                                    │
│  │ 记录数：1,234                     │
│  │                                    │
│  │ 大小：2.5 MB                       │
│  └───────────────────────────────────┘ │
│                                         │
│  ⚠️ 警告                                │
│  还原将覆盖所有当前数据。                │
│  您确定吗？                             │
│                                         │
│  [还原] [取消]                          │
└─────────────────────────────────────────┘
```

## 6. 逻辑与规则

### 6.1 备份文件格式

- 备份文件为 JSON 格式
- 文件名称：`dla-backup-YYYY-MM-DD-HHmmss.json`
- 包含所有数据：用户、类别、交易、预算等

### 6.2 备份的数据

- 数据库中的所有表格
- 包括系统数据和用户数据
- 不包括：应用程序设置、偏好设置（语言、货币）

### 6.3 还原

- 还原将删除所有当前数据
- 然后从备份文件导入数据
- 还原完成后应用程序将自动重新加载

### 6.4 验证

- 应用程序在还原前检查文件格式
- 检查版本兼容性（如有）
- 如果文件无效则显示错误

## 7. 重要注意事项

- **定期备份**：应定期备份（每周或每月）
- **多处保存**：将备份文件保存在多个地方（云端、电脑、USB）
- **还原将丢失当前数据**：在还原前确保您已备份当前数据
- **无法撤销**：还原后无法撤销

