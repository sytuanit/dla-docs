# 预算

## 1. 目的

**预算**模块可帮助您规划和追踪每月支出，确保不超过设定的预算。此模块会根据以下项目自动计算：
- 您的定期收入
- 您的定期支出
- 实际日常支出

## 2. 使用时机

当您想：
- 规划每月支出时
- 控制不超过预算时
- 追踪储蓄率时
- 按类别查看支出分析时
- 比较各月预算时

## 3. 相关画面

- 创建预算（首次或从上月复制）
- 查看预算概览
- 按月查看预算历史
- 从上月复制建议

## 4. 主要使用方式

### 4.1 首次创建预算（情况 A）

1. 前往**功能** → 选择**预算**
2. 如果没有预算，应用程序将自动打开**创建预算**画面
3. 应用程序自动计算并显示：
   - **定期收入**：所有启用定期收入的总计（只读，显示详细明细）
   - **定期支出**：所有启用定期支出的总计（只读，显示详细明细）
   - **总预算（储蓄前）**：自动计算 = 定期收入 - 定期支出
4. 输入**储蓄率**：储蓄百分比（0-100%，必填）
5. 查看自动计算的**储蓄金额**和**支出预算**
6. 点击**保存预算**

### 4.2 从上月复制预算（情况 C）

1. 前往**功能** → 选择**预算**
2. 如果当月没有预算但上月有，应用程序将显示**复制预算建议**画面
3. 选择其中一个选项：
   - **复制整个上月预算**：应用程序自动复制储蓄率，从当前数据重新计算定期收入/支出，并立即创建预算
   - **复制并调整**：应用程序导航到创建预算画面，储蓄率预先填入上月值，您可以在保存前调整
   - **创建新预算**：从头执行创建预算流程（情况 A）
4. 如果选择"复制并调整"，请根据需要调整储蓄率
5. 点击**保存预算**

**注意**：复制时，定期收入和定期支出会从当前定期数据重新计算（不从上月复制），仅复制储蓄率。

### 4.3 查看预算概览（情况 B）

1. 前往**功能** → 选择**预算**
2. 如果当月有预算，应用程序将打开**概览**画面
3. 查看信息：
   - **支出预算**：设定的支出限额
   - **已使用**：已支出金额（包括日常支出和收入/支出差异）
   - **剩余**：预算中的剩余金额
   - **使用率**：已使用的预算百分比（带警告颜色）
   - **收入与支出与计划的差异**：与原始计划的差异
   - **按类别的日常支出**：按类别的详细支出分析

### 4.4 编辑当月预算

1. 在**预算概览**画面上，点击**"编辑预算"**按钮
2. 应用程序显示编辑画面：
   - **定期收入**和**定期支出**：保留旧值（只读）
   - **储蓄率**：从当前预算预先填入（可编辑）
3. 根据需要更改储蓄率
4. 查看储蓄金额和支出预算自动更新
5. 点击**"保存预算"**

**注意**：编辑时，定期收入和定期支出不会重新计算（保留旧快照），仅更新储蓄率和支出预算。

### 4.5 查看预算历史

1. 前往**功能** → 选择**预算**
2. 从菜单中选择**历史**
3. 查看过去各月的预算清单
4. 点击月份查看详细信息

### 4.6 按类别查看支出详细信息

1. 前往**预算概览**画面
2. 向下滚动到**按类别分析**部分
3. 点击类别
4. 查看该类别中的支出清单

## 5. 示例与用户界面图示

### 5.1 BUDGET-01：首次为当月创建预算

**目标**：首次创建预算，让应用程序根据收入和定期支出自动计算和追踪每月支出。

**步骤**：
1. 前往功能画面，选择"预算管理"
2. 应用程序自动检测没有预算并显示"创建预算"画面
3. 查看自动计算的信息：定期收入、定期支出、总预算（储蓄前）
4. 输入储蓄率：20
5. 查看自动计算的储蓄金额和支出预算
6. 点击"保存预算"按钮

**结果**：为当月保存预算，自动导航到"预算概览"画面。

**用户界面图示**：

```text
[ 卡片：创建预算 2025年11月 ]
+------------------------------------------------+
||                                                |
|| 定期收入                8,400 CNY             |
||  • 我的薪水（每月）     8,400 CNY             |
||                                                |
|| 定期支出                6,412 CNY             |
||  • 电费（每月）           238 CNY            |
||  • 水费（每月）           119 CNY            |
||  • BN 学费（每月）       1,904 CNY           |
||  • 早餐和咖啡（每周 x 4）  252 CNY           |
||  • 房屋贷款付款（每月）   2,940 CNY          |
||                                                |
|| （此数据会自动检索）                          |
+------------------------------------------------+

[ 卡片：总预算（储蓄前） ]
 ------------------------------------------------
||   8,400 CNY（定期收入）                      |
|| - 6,412 CNY（定期支出）                      |
||-----------------------------------------------|
|| = 1,988 CNY                                   |
 ------------------------------------------------

[ 卡片：储蓄率 ]
 ------------------------------------------------
|| 您想储蓄多少？                                |
||                                                |
|| 储蓄率（%）                                   |
|| [  输入（必填）：20  ]                        |
||                                                |
|| → 相当于：398 CNY                            |
 ------------------------------------------------

[ 卡片：支出预算 ]
 ------------------------------------------------
||    1,988 CNY（总预算（储蓄前））              |
|| -  398 CNY（储蓄金额）                        |
||-----------------------------------------------|
|| = 1,590 CNY                                   ||
||                                                |
|| （包括饮食、交通、咖啡、小购物...）
 ------------------------------------------------

[ 按钮 ]
 -------------------------------
||      保存预算                |
 -------------------------------
```

---

### 5.2 BUDGET-02：查看当月预算概览

**目标**：查看与设定预算相比的支出情况，包括已使用金额、剩余金额和按类别分析。

**步骤**：
1. 前往功能画面，选择"预算管理"
2. 应用程序自动检测预算存在并显示"预算概览"画面
3. 查看卡片 1 - 每月预算：支出预算、已使用、剩余、使用率
4. 查看卡片 2 - 收入与支出与计划的差异
5. 查看卡片 3 - 按类别的日常支出
6. （可选）点击"支出预算 ›"查看说明预算计算的详细对话框

**结果**：显示当月完整的预算信息，带有进度环/条和适当的颜色。

**用户界面图示**：

```text
[ 卡片 1 – 预算 2025年11月 ]
┌──────────────────────────────────────────────┐
│ 预算 2025年11月                              │
│                                             │
│ 支出预算 ›      1,590 CNY                   │
│ 已使用          245 CNY                     │
│  • 日常支出              336 CNY            │   
│  • 收入差异       -1,120 CNY                │
│  • 支出差异         +56 CNY                 │
│ 剩余            728 CNY                     │
│                                             │
│                    15.4%                    │
│   （您已使用本月支出预算的 15.4%）           │
│   （您即将用完本月支出预算）                 │
│                                             │
│                               [查看历史]     │
└──────────────────────────────────────────────┘

[ 卡片 2 – 收入与支出与计划的差异 ]
┌──────────────────────────────────────────────┐
│ 收入与支出与计划的差异                        │
│                                              │
│ 定期收入                                       │
│  • 我的薪水                 +560 CNY         │
│    （3,360 CNY > 2,800 CNY）                │
│                                              │
│ 定期支出                                       │
│  • BN 学费                  -28 CNY         │
│    （1,988 CNY > 1,960 CNY）                │
│                                              │
│ 总收入差异：        +1,680 CNY              │
│ 总支出差异：        -56 CNY                 │
└──────────────────────────────────────────────┘

[ 卡片 3 – 按类别的日常支出 ]
┌──────────────────────────────────────────────┐
│ 按类别的日常支出                              │
│ （饮食、交通、咖啡、小购物...）
│                                             │
│ 总日常支出：336 CNY                          │
│                                             │
│ 饮食              168 CNY   50% [█████---------]│
│ 交通              84 CNY    25% [███-----------]│
│ 咖啡              56 CNY    17% [██------------]│
│ 小购物            28 CNY    8%  [█-------------]│
└──────────────────────────────────────────────┘
```

---

### 5.3 BUDGET-03：编辑当月预算

**目标**：调整储蓄率以更改当月的支出预算。

**步骤**：
1. 在"预算概览"画面上，点击"编辑预算"按钮
2. 应用程序显示编辑画面（类似创建预算画面）
3. 查看当前信息：定期收入、定期支出（保留旧值）
4. 将储蓄率更改为 25
5. 查看储蓄金额和支出预算自动更新
6. 点击"保存预算"按钮

**结果**：预算已更新，返回"预算概览"画面并显示新值。

**用户界面图示**：类似 BUDGET-01（创建预算画面），但定期收入和定期支出值为只读并保留自旧预算。

---

### 5.4 BUDGET-04：开始新月份时从上月复制预算

**目标**：重复使用上月预算以节省创建新预算的时间，可根据需要调整。

**步骤**：
1. 前往功能画面，选择"预算管理"
2. 应用程序自动检测当月没有预算但上月有，显示"复制预算建议"画面
3. 选择"复制并调整"
4. 应用程序导航到创建预算画面，储蓄率预先填入上月值
5. （可选）根据需要调整储蓄率
6. 点击"保存预算"按钮

**结果**：为当月创建新预算，自动导航到"预算概览"画面。

**用户界面图示**：

```text
[ 画面 ]  预算 2025年12月
┌──────────────────────────────────────────────┐
│ 2025年12月没有预算                           │
│                                              │
│ 您想如何创建新月份的预算？                    │
├──────────────────────────────────────────────┤
│                                              │
│ 📝 复制并调整 ›                              │
│    提示：复制 2025年11月预算并调整            │
│                                              │
├──────────────────────────────────────────────┤
│                                              │
│ ➕ 创建新预算 ›                              │
│   提示：再次执行创建预算流程                 │
│                                              │
└──────────────────────────────────────────────┘
```

选择"复制并调整"后，创建预算画面将显示类似 BUDGET-01，但储蓄率预先填入上月值。

## 6. 逻辑与规则

### 6.1 情况

- **情况 A**：首次创建预算（任何月份都没有预算）
- **情况 B**：当月有预算 → 查看概览
- **情况 C**：当月没有，但上月有 → 复制建议

### 6.2 自动计算

- **定期收入**：所有启用 `recurring_income` 的总计
- **定期支出**：所有启用 `recurring_expense` 的总计
- **日常支出**：当月的 `daily_expense` 总计
- **总预算**：定期收入 + 额外收入
- **储蓄**：总预算 × 储蓄率

### 6.3 与其他模块的整合

- 确认定期收入时 → 自动更新预算
- 确认定期支出时 → 自动更新预算
- 日常支出会自动计算到预算中

### 6.4 预算超支警告

- 支出超过预算时，应用程序将显示警告
- 警告显示在主画面和通知中

### 6.5 快照

- 创建预算时，应用程序会创建收入/支出项目的快照以保存当时的状态
- 快照用于比较和分析

## 7. 重要注意事项

- **每月一个预算**：您需要为每个月创建预算
- **编辑预算**：您可以通过更改储蓄率来编辑当月预算。定期收入和定期支出将保持不变（快照）以确保准确性
- **自动更新**：确认收入/支出时，预算会自动更新
- **从上月复制**：复制功能可帮助您节省创建预算的时间

