# 보고서

## 1. 목적

**보고서** 모듈은 상세한 재무 보고서를 제공하며 다음을 지원합니다:
- 이번 달 재무 개요 표시
- 수입 및 지출 분석
- 저축 진행 추적
- 월말 지출 예측
- 유형별 보고서 표시 (수입, 지출, 저축, 대출)

## 2. 사용 시기

다음과 같은 경우 이 모듈을 사용합니다:
- 재무 개요 표시
- 지출 추세 분석
- 저축 목표 진행 확인
- 예산 초과 위험 예측
- 유형별 상세 보고서 표시

## 3. 관련 화면

- 개요 보고서
- 수입 보고서
- 지출 보고서
- 저축 보고서
- 대출 보고서

## 4. 주요 사용 방법

### 4.1 개요 보고서 표시

1. 하단 네비게이션의 **보고서** 탭으로 이동
2. **재무 건전성** 섹션 확인:
   - 저축 목표 및 실제 저축 (진행 바 및 달성 수준 포함)
   - 상세한 공식을 포함한 순 현금 흐름
   - 예산 잔액 (예산이 생성된 경우)
   - 전월과 비교한 지출 속도 (데이터가 사용 가능한 경우)
   - 이번 달 대출 의무 (있는 경우)
   - 백분율별 상위 5개 지출 카테고리
3. **미래 추세 예측** 섹션 확인 (예산 > 0인 경우):
   - 상세한 공식을 포함한 월말 예상 잔액
   - 저축 목표 달성 확률
   - 향후 대출 상환 (있는 경우)
4. 카드를 탭하여 해당 상세 보고서로 스크롤

### 4.2 수입 보고서 표시

1. 보고서 화면에서 "상세 보고서" 섹션의 메뉴 항목 **💵 수입** 탭
2. 이번 달 실제 수입 합계 확인
3. **정기 수입** 섹션 확인: 합계, 수령 완료, 아직 수령하지 않음, 각 항목의 상세
4. **임시 수입** 섹션 확인 (있는 경우): 합계, 각 항목의 상세, 증감률
5. **3개월 수입 추세** 확인 (충분한 데이터가 사용 가능한 경우)
6. **월별 수입 이력** 확인
7. **수입 분석 (인사이트)** 확인: 백분율, 안정성 수준, 추세

### 4.3 지출 보고서 표시

1. 보고서 화면에서 "상세 보고서" 섹션의 메뉴 항목 **🔥 지출** 탭
2. 이번 달 실제 지출 합계 확인 (전월과 비교한 증감률 포함)
3. **정기 지출** 섹션 확인: 합계, 지불 완료, 아직 지불하지 않음, 각 항목의 상세
4. **카테고리별 일일 지출** 섹션 확인: 금액과 백분율을 포함한 상위 카테고리
5. **지출 급증** 섹션 확인 (전월 데이터가 사용 가능한 경우)
6. **3개월 지출 추세** 확인 (충분한 데이터가 사용 가능한 경우)
7. **월별 지출 이력** 확인

### 4.4 예산 보고서 표시

1. 보고서 화면에서 "상세 보고서" 섹션의 메뉴 항목 **📉 예산** 탭 (예산이 생성된 경우만 표시)
2. **이번 달 예산 개요** 확인: 월별 예산, 지출 (내역 포함), 잔액, 진행 바
3. "월별 예산" 탭하여 계산 방법을 포함한 **예산 상세 대화상자** 표시
4. **계획에서의 차이** 섹션 확인: 차이를 포함한 수입 및 지출 항목, 총 차이
5. **카테고리별 지출** 섹션 확인: 합계, 금액, 백분율, 진행 바를 포함한 각 카테고리
6. 카테고리를 탭하여 해당 카테고리의 지출 목록 표시

### 4.5 저축 보고서 표시

1. 보고서 화면에서 "상세 보고서" 섹션의 메뉴 항목 **💾 저축** 탭 (저축 계좌가 존재하는 경우만 표시)
2. 순 현금 흐름 공식을 포함한 **이번 달 실제 저축** 확인
3. **저축 분석** 섹션 확인: 수입 대비%, 전월과의 비교, 월말 예측
4. **저축 계좌 목록** 섹션 확인: 모든 활성 계좌, 가장 가까운 만기일로 정렬
5. **6개월 저축 성장 차트** 확인 (1개월 이상의 데이터가 사용 가능한 경우)

### 4.6 대출 보고서 표시

1. 보고서 화면에서 "상세 보고서" 섹션의 메뉴 항목 **💸 대출** 탭 (대출이 존재하는 경우만 표시)
2. **대출 개요** 확인: 현재 부채 잔액, 이번 달 대출 비용 (원금 + 이자 내역 포함)
3. **가장 가까운 상환** 섹션 확인: 만기일, 상태, 다음 상환까지의 일수
4. **월별 상환 일정** 섹션 확인: 금액과 상태를 포함한 과거 3개월
5. **대출 분석 (인사이트)** 섹션 확인: 과거 3개월 지불, 부채 잔액 추세, 금리, 연체 위험
6. **6개월 부채 감소 차트** 확인 (1개월 이상의 데이터가 사용 가능한 경우)

## 5. 예시 및 UI 설명

### 5.1 REPORT-01: 재무 건전성 개요 및 추세 예측 표시

**목표**: 저축 진행, 순 현금 흐름, 예산 잔액, 월말 예측을 포함한 이번 달 재무 개요를 표시합니다.

**단계**:
1. 하단 네비게이션의 **보고서** 탭으로 이동
2. **재무 건전성** 섹션 확인:
   - 저축 목표: ₩780,000 (수입의 20%)
   - 실제 저축: ₩546,000
   - 진행 바: 70% - 달성 수준: 중
   - 순 현금 흐름: +₩364,000 [플러스] 상세한 공식 포함
   - 예산 잔액: ₩806,000 [안정] (예산의 62% ≈ 시간의 60%)
   - 지출 속도: 전월보다 12% 높음
   - 대출 의무: ₩546,000 [지불 완료]
   - 상위 5개 카테고리: 식사 (32%), 쇼핑 (25%), 오락 (18%), 교통비 (15%), 기타 (10%)
3. **미래 추세 예측** 섹션 확인:
   - 월말 예상 잔액: +₩299,000 [잉여] 상세한 공식 포함
   - 목표 달성 확률: 82% [거의 달성]
   - 향후 대출 상환: 25일: ₩546,000 [충분한 자금]

**와이어프레임**:
```text
┌──────────────────────┐  ┌──────────────────────┐
│ 🎯 저축 목표          │  │ 💾 실제 저축        │
│ ₩780,000              │  │ ₩546,000             │
│ 수입의 20%            │  │                      │
└──────────────────────┘  └──────────────────────┘

[██████████████----------------------] 70%
달성 수준: 중

┌────────────────────────────────────────────────────────────┐
│ 순 현금 흐름 = 실제 저축                                  │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ +₩364,000                      [플러스]                │ │
│ └────────────────────────────────────────────────────────┘ │
│ 순 현금 흐름 = 수입 (정기 + 임시)                         │
│                – 지출 (정기 + 일일 + 대출)                │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│ 📉 예산 잔액                                              │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ ₩806,000                      [안정]                  │ │
│ └────────────────────────────────────────────────────────┘ │
│ • 예산의 62% ≈ 시간의 60% → 적절한 속도로 지출            │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│ 💹 월말 예상 잔액                                        │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ 예상: +₩299,000             [잉여]                     │ │
│ └────────────────────────────────────────────────────────┘ │
│ • 예상 지출 = (평균 일일 지출 × 남은 일수)                 │
│                + (보류 중인 고정 지출)                     │
└────────────────────────────────────────────────────────────┘
```

### 5.2 REPORT-02: 수입 보고서 표시

**목표**: 정기 수입, 임시 수입, 추세, 인사이트를 포함한 이번 달 수입의 상세 분석을 표시합니다.

**단계**:
1. 보고서 화면에서 "상세 보고서" 섹션의 메뉴 항목 **💵 수입** 탭
2. **이번 달 실제 수입 합계** 확인: ₩2,730,000
3. **정기 수입** 섹션 확인: 합계 ₩1,950,000 (수령 완료: ₩1,690,000, 아직 수령하지 않음: ₩260,000), 각 항목의 상세
4. **임시 수입** 섹션 확인: 합계 ₩780,000 (프리랜스: ₩390,000, 아이템 판매: ₩130,000, 작은 보너스: ₩260,000), 전월에서 5% 증가
5. **3개월 수입 추세** 확인 (스파크라인 차트)
6. **월별 수입 이력** 확인: 이번 달, 전월, 2개월 전
7. **수입 분석 (인사이트)** 확인: 정기 수입의 백분율, 안정성 평가, 증감률

**와이어프레임**: `wf-bao-cao-thu-nhap.md` 참조

### 5.3 REPORT-03: 지출 보고서 표시

**목표**: 정기 지출, 카테고리별 일일 지출, 추세, 지출 급증 카테고리를 포함한 이번 달 지출의 상세 분석을 표시합니다.

**단계**:
1. 보고서 화면에서 "상세 보고서" 섹션의 메뉴 항목 **🔥 지출** 탭
2. **이번 달 실제 지출 합계** 확인: ₩2,366,000 (전월에서 12% 증가)
3. **정기 지출** 섹션 확인: 합계 ₩1,105,000 (지불 완료: ₩975,000, 아직 지불하지 않음: ₩130,000), 각 항목의 상세
4. **카테고리별 일일 지출** 섹션 확인: 식사 ₩845,000 (36%), 쇼핑 ₩390,000 (16%), 교통비 ₩273,000 (12%), 오락 ₩182,000 (8%), 기타 ₩130,000 (5%)
5. **지출 급증** 섹션 확인: 식사 (+₩156,000, +22%), 쇼핑 (+₩104,000, +35%)
6. **3개월 지출 추세** 확인 (스파크라인 차트)
7. **월별 지출 이력** 확인: 이번 달, 전월, 2개월 전

**와이어프레임**: `wf-bao-cao-chi-tieu.md` 참조

### 5.4 REPORT-04: 예산 보고서 표시

**목표**: 예산의 지출, 잔액, 계획에서의 차이, 카테고리별 지출을 포함한 이번 달 예산 개요를 표시합니다.

**단계**:
1. 보고서 화면에서 "상세 보고서" 섹션의 메뉴 항목 **📉 예산** 탭
2. **이번 달 예산 개요** 확인:
   - 월별 예산: ₩1,300,000 (탭하여 계산 상세 표시)
   - 지출: ₩494,000 (일일 지출: ₩325,000, 지출 차이: +₩65,000, 수입 차이: -₩26,000)
   - 잔액: ₩806,000
   - 진행 바: 38.0% 동적 힌트 텍스트 포함
3. "월별 예산" 탭하여 공식을 포함한 **예산 상세 대화상자** 표시: 예산 = 수입 - 지출
4. **계획에서의 차이** 섹션 확인: 차이를 포함한 각 수입/지출 항목, 총 차이
5. **카테고리별 지출** 섹션 확인: 합계, 금액, 백분율, 진행 바를 포함한 각 카테고리
6. 카테고리를 탭하여 해당 카테고리의 지출 목록 표시

**와이어프레임**: `wf-bao-cao-ngan-sach.md` 참조

### 5.5 REPORT-05: 저축 보고서 표시

**목표**: 실제 저축, 저축 분석, 저축 계좌 목록, 추세를 포함한 이번 달 저축의 상세 분석을 표시합니다.

**단계**:
1. 보고서 화면에서 "상세 보고서" 섹션의 메뉴 항목 **💾 저축** 탭
2. 상세한 순 현금 흐름 공식을 포함한 **이번 달 실제 저축** 확인: ₩546,000
3. **저축 분석** 섹션 확인: 수입의 20%를 저축 계좌에, 전월에서 12% 증가, 월말 예측: ₩663,000 (목표의 약 85%)
4. **저축 계좌 목록** 섹션 확인: 3개 계좌 (₩5,200,000, ₩650,000, ₩2,600,000), 가장 가까운 만기일로 정렬
5. **6개월 저축 성장 차트** 확인 (선 그래프)

**와이어프레임**: `wf-bao-cao-tiet-kiem.md` 참조

### 5.6 REPORT-06: 대출 보고서 표시

**목표**: 현재 부채 잔액, 이번 달 대출 비용, 상환 일정, 인사이트, 추세를 포함한 대출의 상세 분석을 표시합니다.

**단계**:
1. 보고서 화면에서 "상세 보고서" 섹션의 메뉴 항목 **💸 대출** 탭
2. **대출 개요** 확인: 현재 부채 잔액 ₩84,500,000, 이번 달 대출 비용 ₩546,000 (원금: ₩455,000 + 이자: ₩91,000)
3. **가장 가까운 상환** 섹션 확인: 25일 → 지불 완료, 다음 상환까지 14일
4. **월별 상환 일정** 섹션 확인: 금액과 상태를 포함한 과거 3개월
5. **대출 분석 (인사이트)** 섹션 확인: 과거 3개월 지불: ₩1,638,000, 부채 잔액 추세는 꾸준히 감소, 이자는 지불의 17%를 차지, 연체 위험: 낮음
6. **6개월 부채 감소 차트** 확인 (선 그래프)

**와이어프레임**: `wf-bao-cao-khoan-vay.md` 참조

### 5.7 REPORT-07: 개요 보고서에서 카테고리별 지출 분석

**목표**: 개요 보고서에서 "카테고리별 지출" 섹션을 탭하여 상세한 지출 보고서와 더 깊은 분석을 표시합니다.

**단계**:
1. 보고서 개요 화면에서 **카테고리별 지출** 섹션까지 스크롤
2. 가장 높은 백분율의 상위 5개 카테고리 확인
3. "카테고리별 지출" 카드 (오른쪽 화살표 아이콘 포함) 탭
4. 앱이 같은 화면의 **지출 보고서** 섹션으로 자동 스크롤
5. 완전한 상세 확인: 총 지출, 정기 지출, 카테고리별 일일 지출 (상위 5개 이상), 지출 급증, 추세 및 이력

**와이어프레임**: `wf-bao-cao.md` - "카테고리별 지출" 섹션 참조

### 5.8 REPORT-08: 데이터가 부족한 경우 보고서 표시 (첫 달)

**목표**: 새로운 앱 사용자가 첫 달에 보고서를 표시하고, 비교 및 추세 분석을 위한 데이터가 부족한 경우.

**단계**:
1. **보고서** 탭으로 이동
2. **재무 건전성** 섹션 확인:
   - 저축 목표 및 실제 저축 (예산이 존재하는 경우)
   - 공식을 포함한 순 현금 흐름
   - 예산 잔액 (존재하는 경우)
   - **표시되지 않음**: "지출 속도" (전월 데이터 없음)
3. **미래 추세 예측** 섹션 확인 (예산 > 0인 경우)
4. **수입 보고서** 탭: 이번 달 총 수입, 정기 및 임시 수입, **표시되지 않음** "3개월 추세", 이력에는 **"이번 달"만** 표시
5. **지출 보고서** 탭: 이번 달 총 지출, 정기 및 일일 지출, **표시되지 않음** "지출 급증", "3개월 추세", 이력에는 **"이번 달"만** 표시

**와이어프레임**: `wf-bao-cao.md` - 조건부 표시 카드 참조

## 6. 로직 및 규칙

### 6.1 순 현금 흐름 계산

**공식**:
```
순 현금 흐름_월 = 
  (월에 실제로 수령한 정기 수입 + 월의 임시 수입)
  - (월에 실제로 지불한 정기 지출 + 월의 일일 지출 + 월의 실제 대출 상환)
```

**상세**:
- **수입**: SUM(recurring_income_occurrence.amount_snapshot) WHERE status = 'COMPLETED' AND due_date in month + SUM(extra_income.amount) WHERE occurred_at in month
- **지출**: SUM(recurring_expense_occurrence.amount_snapshot) WHERE status = 'COMPLETED' AND due_date in month + SUM(daily_expense.amount) WHERE occurred_at in month + SUM(bank_debt_payment.total_amount) WHERE due_date in month AND status != 'CANCELLED'
- **실제 저축**: max(순 현금 흐름_월, 0) - 순 현금 흐름이 플러스인 경우: 저축 = 순 현금 흐름, 순 현금 흐름이 마이너스인 경우: 저축 = 0 (지출 초과)

### 6.2 저축 목표 달성 수준

**공식**:
```
비율 = 저축_월 / budget.savings_amount
진행% = round(비율 × 100)
```

**임계값**:
- **양호**: 진행% ≥ 90
- **중**: 70 ≤ 진행% < 90
- **불량**: 진행% < 70

### 6.3 예산 잔액

**공식**:
- % 예산 잔액 = (예산 잔액 / 총 예산) × 100
- % 시간 잔액 = (남은 일수 / 월의 총 일수) × 100

**결론**:
- % 예산 ≈ % 시간인 경우: 지출 속도는 **적절**
- % 예산 < % 시간인 경우: 속도보다 **빠르게** 지출
- % 예산 > % 시간인 경우: 속도보다 **느리게** 지출

**참고**: 이 카드는 이번 달 예산이 생성된 경우에만 표시됩니다.

### 6.4 월말 예측

**예상 지출**:
```
예상 지출 = 
  (평균 일일 지출 × 월의 남은 일수)
  + 월의 남은 총 정기 지출 보류 중
  + 월의 총 은행 대출 상환 보류 중
```

**상세**:
- 평균 일일 지출 = (월초부터 오늘까지의 총 daily_expense.amount) / 월의 경과 일수
- 총 정기 지출 보류 중 = SUM(recurring_expense_occurrence.amount_snapshot) WHERE status = 'PENDING' AND due_date between 내일 and 월말
- 총 은행 대출 상환 보류 중 = SUM(bank_debt_payment.total_amount) WHERE due_date between 내일 and 월말 AND status = 'PENDING'

**월말 예상 잔액**:
```
월말 예상 잔액 = 순 현금 흐름_월 - 예상 지출
```

**저축 목표 달성 확률**:
```
비율 = 월말 예상 잔액 / budget.savings_amount
진행% = round(비율 × 100)
```

**라벨**:
- ≥ 90% → **달성**
- 70–89% → **거의 달성**
- < 70% → **달성 어려움**

**참고**: 예측은 예산 > 0인 경우에만 표시됩니다.

### 6.5 실제 데이터 vs 계획

- **모든 보고서 데이터는 실제 데이터 사용**:
  - 수입: COMPLETED 발생 + extra_income
  - 지출: COMPLETED 발생 + daily_expense
  - 대출 상환: 월의 due_date를 가진 bank_debt_payment (지불 완료 여부와 관계없이)
- **계획 데이터 사용 안 함** (아직 만기일이 아닌 PENDING 발생)

## 7. 중요 참고 사항

- **이번 달 데이터만**: 보고서는 이번 달 데이터만 표시합니다
- **표시 조건**:
  - "예산 잔액" 카드는 이번 달 예산이 생성된 경우에만 표시됩니다
  - "지출 속도" 카드는 비교를 위한 전월 데이터가 사용 가능한 경우에만 표시됩니다
  - "대출 의무" 카드는 대출이 존재하는 경우에만 표시됩니다
  - "예산" 메뉴 항목은 예산이 생성된 경우에만 표시됩니다
  - "저축" 메뉴 항목은 저축 계좌가 존재하는 경우에만 표시됩니다
  - "대출" 메뉴 항목은 대출이 존재하는 경우에만 표시됩니다
  - "미래 추세 예측" 섹션은 예산 > 0인 경우에만 표시됩니다
- **예측은 참고용**: 현재 추세와 PENDING 항목에 기반합니다
- **첫 달**: 비교 데이터 부족으로 인해 일부 카드/섹션이 표시되지 않습니다 (예: "지출 속도", "3개월 추세", "지출 급증")
- **카드는 탭 가능**: 카드를 탭하면 같은 화면의 해당 상세 보고서로 스크롤합니다

