# 預算

## 1. 目的

**預算**模組可協助您規劃和追蹤每月支出，確保不超過設定的預算。此模組會根據以下項目自動計算：
- 您的定期收入
- 您的定期支出
- 實際日常支出

## 2. 使用時機

當您想：
- 規劃每月支出時
- 控制不超過預算時
- 追蹤儲蓄率時
- 按類別查看支出分析時
- 比較各月預算時

## 3. 相關畫面

- 建立預算（首次或從上月複製）
- 查看預算概覽
- 按月查看預算歷史
- 從上月複製建議

## 4. 主要使用方式

### 4.1 首次建立預算（情況 A）

1. 前往**功能** → 選擇**預算**
2. 如果沒有預算，應用程式將自動開啟**建立預算**畫面
3. 應用程式自動計算並顯示：
   - **定期收入**：所有啟用定期收入的總計（唯讀，顯示詳細明細）
   - **定期支出**：所有啟用定期支出的總計（唯讀，顯示詳細明細）
   - **總預算（儲蓄前）**：自動計算 = 定期收入 - 定期支出
4. 輸入**儲蓄率**：儲蓄百分比（0-100%，必填）
5. 查看自動計算的**儲蓄金額**和**支出預算**
6. 點擊**儲存預算**

### 4.2 從上月複製預算（情況 C）

1. 前往**功能** → 選擇**預算**
2. 如果當月沒有預算但上月有，應用程式將顯示**複製預算建議**畫面
3. 選擇其中一個選項：
   - **複製整個上月預算**：應用程式自動複製儲蓄率，從目前資料重新計算定期收入/支出，並立即建立預算
   - **複製並調整**：應用程式導航到建立預算畫面，儲蓄率預先填入上月值，您可以在儲存前調整
   - **建立新預算**：從頭執行建立預算流程（情況 A）
4. 如果選擇「複製並調整」，請視需要調整儲蓄率
5. 點擊**儲存預算**

**注意**：複製時，定期收入和定期支出會從目前定期資料重新計算（不從上月複製），僅複製儲蓄率。

### 4.3 查看預算概覽（情況 B）

1. 前往**功能** → 選擇**預算**
2. 如果當月有預算，應用程式將開啟**概覽**畫面
3. 查看資訊：
   - **支出預算**：設定的支出限額
   - **已使用**：已支出金額（包括日常支出和收入/支出差異）
   - **剩餘**：預算中的剩餘金額
   - **使用率**：已使用的預算百分比（帶警告顏色）
   - **收入與支出與計劃的差異**：與原始計劃的差異
   - **按類別的日常支出**：按類別的詳細支出分析

### 4.4 編輯當月預算

1. 在**預算概覽**畫面上，點擊**「編輯預算」**按鈕
2. 應用程式顯示編輯畫面：
   - **定期收入**和**定期支出**：保留舊值（唯讀）
   - **儲蓄率**：從目前預算預先填入（可編輯）
3. 視需要變更儲蓄率
4. 查看儲蓄金額和支出預算自動更新
5. 點擊**「儲存預算」**

**注意**：編輯時，定期收入和定期支出不會重新計算（保留舊快照），僅更新儲蓄率和支出預算。

### 4.5 查看預算歷史

1. 前往**功能** → 選擇**預算**
2. 從選單中選擇**歷史**
3. 查看過去各月的預算清單
4. 點擊月份查看詳細資訊

### 4.6 按類別查看支出詳細資訊

1. 前往**預算概覽**畫面
2. 向下捲動到**按類別分析**區段
3. 點擊類別
4. 查看該類別中的支出清單

## 5. 範例與介面說明

### 5.1 BUDGET-01：首次為當月建立預算

**目標**：首次建立預算，讓應用程式根據收入和定期支出自動計算和追蹤每月支出。

**步驟**：
1. 前往功能畫面，選擇「預算管理」
2. 應用程式自動偵測沒有預算並顯示「建立預算」畫面
3. 查看自動計算的資訊：定期收入、定期支出、總預算（儲蓄前）
4. 輸入儲蓄率：20
5. 查看自動計算的儲蓄金額和支出預算
6. 點擊「儲存預算」按鈕

**結果**：為當月儲存預算，自動導航到「預算概覽」畫面。

**介面說明**：

```text
[ 卡片：建立預算 2025年11月 ]
+------------------------------------------------+
||                                                |
|| 定期收入                36,000 TWD            |
||  • 我的薪資（每月）     36,000 TWD            |
||                                                |
|| 定期支出                27,480 TWD            |
||  • 電費（每月）           1,020 TWD          |
||  • 水費（每月）             510 TWD          |
||  • BN 學費（每月）         8,160 TWD         |
||  • 早餐和咖啡（每週 x 4）  1,080 TWD         |
||  • 房屋貸款付款（每月）   12,600 TWD          |
||                                                |
|| （此資料會自動檢索）                          |
+------------------------------------------------+

[ 卡片：總預算（儲蓄前） ]
 ------------------------------------------------
||   36,000 TWD（定期收入）                      |
|| - 27,480 TWD（定期支出）                      |
||-----------------------------------------------|
|| = 8,520 TWD                                   |
 ------------------------------------------------

[ 卡片：儲蓄率 ]
 ------------------------------------------------
|| 您想儲蓄多少？                                |
||                                                |
|| 儲蓄率（%）                                   |
|| [  輸入（必填）：20  ]                        |
||                                                |
|| → 相當於：1,704 TWD                          |
 ------------------------------------------------

[ 卡片：支出預算 ]
 ------------------------------------------------
||    8,520 TWD（總預算（儲蓄前））              |
|| -  1,704 TWD（儲蓄金額）                      |
||-----------------------------------------------|
|| = 6,816 TWD                                   |
||                                                |
|| （包括飲食、交通、咖啡、小購物...）
 ------------------------------------------------

[ 按鈕 ]
 -------------------------------
||      儲存預算                |
 -------------------------------
```

---

### 5.2 BUDGET-02：查看當月預算概覽

**目標**：查看與設定預算相比的支出情況，包括已使用金額、剩餘金額和按類別分析。

**步驟**：
1. 前往功能畫面，選擇「預算管理」
2. 應用程式自動偵測預算存在並顯示「預算概覽」畫面
3. 查看卡片 1 - 每月預算：支出預算、已使用、剩餘、使用率
4. 查看卡片 2 - 收入與支出與計劃的差異
5. 查看卡片 3 - 按類別的日常支出
6. （選填）點擊「支出預算 ›」查看說明預算計算的詳細對話框

**結果**：顯示當月完整的預算資訊，帶有進度環/條和適當的顏色。

**介面說明**：

```text
[ 卡片 1 – 預算 2025年11月 ]
┌──────────────────────────────────────────────┐
│ 預算 2025年11月                              │
│                                             │
│ 支出預算 ›      6,816 TWD                   │
│ 已使用          1,050 TWD                   │
│  • 日常支出              1,440 TWD          │   
│  • 收入差異       -4,800 TWD                │
│  • 支出差異         +240 TWD                │
│ 剩餘            3,120 TWD                   │
│                                             │
│                    15.4%                    │
│   （您已使用本月支出預算的 15.4%）           │
│   （您即將用完本月支出預算）                 │
│                                             │
│                               [查看歷史]     │
└──────────────────────────────────────────────┘

[ 卡片 2 – 收入與支出與計劃的差異 ]
┌──────────────────────────────────────────────┐
│ 收入與支出與計劃的差異                        │
│                                              │
│ 定期收入                                       │
│  • 我的薪資                 +2,400 TWD       │
│    （14,400 TWD > 12,000 TWD）              │
│                                              │
│ 定期支出                                       │
│  • BN 學費                  -120 TWD        │
│    （8,520 TWD > 8,400 TWD）                │
│                                              │
│ 總收入差異：        +7,200 TWD              │
│ 總支出差異：        -240 TWD                │
└──────────────────────────────────────────────┘

[ 卡片 3 – 按類別的日常支出 ]
┌──────────────────────────────────────────────┐
│ 按類別的日常支出                              │
│ （飲食、交通、咖啡、小購物...）
│                                             │
│ 總日常支出：1,440 TWD                        │
│                                             │
│ 飲食              720 TWD   50% [█████---------]│
│ 交通              360 TWD   25% [███-----------]│
│ 咖啡              240 TWD   17% [██------------]│
│ 小購物            120 TWD   8%  [█-------------]│
└──────────────────────────────────────────────┘
```

---

### 5.3 BUDGET-03：編輯當月預算

**目標**：調整儲蓄率以變更當月的支出預算。

**步驟**：
1. 在「預算概覽」畫面上，點擊「編輯預算」按鈕
2. 應用程式顯示編輯畫面（類似建立預算畫面）
3. 查看目前資訊：定期收入、定期支出（保留舊值）
4. 將儲蓄率變更為 25
5. 查看儲蓄金額和支出預算自動更新
6. 點擊「儲存預算」按鈕

**結果**：預算已更新，返回「預算概覽」畫面並顯示新值。

**介面說明**：類似 BUDGET-01（建立預算畫面），但定期收入和定期支出值為唯讀並保留自舊預算。

---

### 5.4 BUDGET-04：開始新月份時從上月複製預算

**目標**：重複使用上月預算以節省建立新預算的時間，可視需要調整。

**步驟**：
1. 前往功能畫面，選擇「預算管理」
2. 應用程式自動偵測當月沒有預算但上月有，顯示「複製預算建議」畫面
3. 選擇「複製並調整」
4. 應用程式導航到建立預算畫面，儲蓄率預先填入上月值
5. （選填）視需要調整儲蓄率
6. 點擊「儲存預算」按鈕

**結果**：為當月建立新預算，自動導航到「預算概覽」畫面。

**介面說明**：

```text
[ 畫面 ]  預算 2025年12月
┌──────────────────────────────────────────────┐
│ 2025年12月沒有預算                           │
│                                              │
│ 您想如何建立新月份的預算？                    │
├──────────────────────────────────────────────┤
│                                              │
│ 📝 複製並調整 ›                              │
│    提示：複製 2025年11月預算並調整            │
│                                              │
├──────────────────────────────────────────────┤
│                                              │
│ ➕ 建立新預算 ›                              │
│   提示：再次執行建立預算流程                 │
│                                              │
└──────────────────────────────────────────────┘
```

選擇「複製並調整」後，建立預算畫面將顯示類似 BUDGET-01，但儲蓄率預先填入上月值。

## 6. 邏輯與規則

### 6.1 情況

- **情況 A**：首次建立預算（任何月份都沒有預算）
- **情況 B**：當月有預算 → 查看概覽
- **情況 C**：當月沒有，但上月有 → 複製建議

### 6.2 自動計算

- **定期收入**：所有啟用 `recurring_income` 的總計
- **定期支出**：所有啟用 `recurring_expense` 的總計
- **日常支出**：當月 `daily_expense` 的總計
- **總預算**：定期收入 + 額外收入
- **儲蓄**：總預算 × 儲蓄率

### 6.3 與其他模組的整合

- 確認定期收入時 → 自動更新預算
- 確認定期支出時 → 自動更新預算
- 日常支出會自動計算到預算中

### 6.4 預算超支警告

- 支出超過預算時，應用程式將顯示警告
- 警告顯示在主畫面和通知中

### 6.5 快照

- 建立預算時，應用程式會建立收入/支出項目的快照以儲存當時的狀態
- 快照用於比較和分析

## 7. 重要注意事項

- **每月一個預算**：您需要為每個月建立預算
- **編輯預算**：您可以透過變更儲蓄率來編輯當月預算。定期收入和定期支出將保持不變（快照）以確保準確性
- **自動更新**：確認收入/支出時，預算會自動更新
- **從上月複製**：複製功能可協助您節省建立預算的時間

