# 財務目標

## 1. 目的

**財務目標**モジュールは、以下を支援します：
- 財務目標を設定（例：家を買う、車を買う）
- 目標達成のための財務計画
- 財務仮定を評価
- ローンシナリオを比較
- 目標の進捗を追跡

## 2. 使用するタイミング

以下の場合にこのモジュールを使用します：
- 主要な財務目標を計画
- 資産購入のための借入能力を評価
- 財務オプションを比較
- 貯蓄の進捗を追跡

## 3. 関連画面

- 財務目標を作成（3ステップ）
- 目標詳細と計画
- ローン計画を表示
- 仮定を評価
- 仮定とローンを評価

## 4. 主な使用方法

### 4.1 財務目標を作成（3ステップ）

#### ステップ1: 財務計画を入力

1. **機能** → **計画と仮定**を選択
2. **➕ 新規追加** (FAB) ボタンをタップ
3. 自動入力された情報を確認：
   - **平均収入**: アクティブな定期収入から自動取得（クリックして内訳を表示可能）
   - **固定支出**: アクティブな定期支出 + ローン返済から自動取得（クリックして内訳を表示可能）
   - **現在の残高**: 現在の残高から自動取得
4. **生活費**を入力: 月次生活費（食事、交通費など）
5. 自動計算された予測を確認：
   - 12ヶ月後
   - 24ヶ月後
   - 36ヶ月後
   （現在の収入と支出レベルを維持する場合）
6. **続ける**をタップ

#### ステップ2: 目標情報を入力

1. **目標名**を入力: （例：「家を買う」）
2. **必要額**を入力: 目標達成に必要な総額
3. **頭金**を確認: 現在の残高から自動入力（編集可能）
4. **続ける**をタップ

#### ステップ3: 目標達成能力を確認

1. 目標情報を確認: 名前、目標値、頭金、残りのギャップ
2. 現在の財務を確認: 平均収入、平均支出、平均貯蓄
3. 結論を確認：
   - 「約X年で目標を達成します」（貯蓄 > 0の場合）
   - 「現在の状況では、借入または財務改善なしでは目標を達成できません」（貯蓄 <= 0の場合）
4. 次のオプションを確認：
   - **ローンオプションを表示**: 借入能力を評価
   - **収入/支出仮定を作成**: 財務改善をシミュレート
   - **仮定 + ローンを組み合わせ**: 最適なシナリオ
5. **目標を保存**をタップ（今すぐ保存するか、後で計画を作成）

### 4.2 目標リストと詳細を表示

1. **機能** → **計画と仮定**を選択
2. 作成された目標のリストを確認：
   - 各目標に表示: 名前、目標値、支払った頭金、残りのギャップ
3. （任意）検索バーを使用して目標名で検索
4. 目標をタップして詳細を表示：
   - **目標情報**: 名前、目標値、頭金、残りのギャップ
   - **財務計画（ベースライン）**: クリックして平均収入、支出、貯蓄を含むダイアログを表示
   - **保存された計画リスト**: 作成されたローン計画、仮定、または組み合わせ

### 4.3 目標のローン計画を作成

1. 目標詳細画面で、**➕ 新規追加**ボタンをタップ
2. アプリが計画タイプを選択するダイアログを表示、**「ローン」**を選択
3. ローン情報を入力: ローン額、金利、ローン期間、計画名
4. 自動計算された結果を確認: 月次返済、支払い総額、目標達成までの時間、支払い能力
5. **計画を保存**をタップ

### 4.4 収入/支出仮定を作成

1. 目標詳細画面で、**➕ 新規追加**ボタンをタップ
2. アプリが計画タイプを選択するダイアログを表示、**「仮定」**を選択
3. 仮定を入力：
   - **収入を増やす**: 追加額（増加がない場合は空白のまま）
   - **支出を減らす**: 削減額（削減がない場合は空白のまま）
   - 仮定名
4. 自動計算された結果を確認: 新しい収入、新しい支出、新しい貯蓄、目標達成までの新しい時間
5. **仮定を保存**をタップ

### 4.5 財務目標を削除

1. 目標詳細画面に移動
2. 目標カードの右上の**削除**ボタン（削除アイコン）をタップ
3. アプリが確認ダイアログを表示
4. **削除**をタップして確認

**注意**: 目標を削除すると、すべての関連計画も削除され、元に戻すことはできません。

## 5. 例とUI図解

### 5.1 PLANNING-01: 新しい財務目標を作成（家を買う）

**目標**: 目標を計画し、その目標を達成する能力をシミュレートするために財務目標を作成します。

**手順**:
1. 機能画面に移動し、「計画と仮定」を選択
2. 「➕ 新規追加」ボタンをタップ
3. **ステップ1**: 財務計画を入力（自動入力された情報を確認、生活費を入力、予測を確認）
4. **ステップ2**: 目標情報を入力（名前、必要額、頭金）
5. **ステップ3**: 目標達成能力を確認（結論とオプションを確認）
6. 「目標を保存」をタップ

**結果**: 目標が保存され、目標リスト画面に戻ります。

**UI図解 - ステップ1: 財務計画を入力**:

```text
┌─────────────────────────────────────────┐
│  ← 戻る    目標を作成 (1/3)              │
├─────────────────────────────────────────┤
│  財務計画                                │
│                                         │
│  平均収入 *                              │
│  [¥120,000]                              │
│  （定期項目からデフォルト）              │
│  [内訳を表示]                            │
│                                         │
│  固定支出 *                              │
│  [¥91,600]                               │
│  （定期項目からデフォルト）              │
│  [内訳を表示]                            │
│                                         │
│  生活費 *                                │
│  [¥20,000]                               │
│  （食事、交通費などが含まれます）        │
│                                         │
│  現在の残高 *                            │
│  [¥200,000]                              │
│  （現在の残高からデフォルト）            │
│                                         │
│  予測                                    │
│  ┌───────────────────────────────────┐ │
│  │ 12ヶ月後: ¥296,000                 │ │
│  │ 24ヶ月後: ¥392,000                 │ │
│  │ 36ヶ月後: ¥488,000                 │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [続ける] [キャンセル]                  │
└─────────────────────────────────────────┘
```

**UI図解 - ステップ2: 目標情報を入力**:

```text
┌─────────────────────────────────────────┐
│  ← 戻る    目標を作成 (2/3)              │
├─────────────────────────────────────────┤
│  目標情報を入力                          │
│                                         │
│  目標名 *                                │
│  [家を買う]                              │
│  （例：家を買う、車を買う...）          │
│                                         │
│  必要額 *                                │
│  [¥8,000,000]                            │
│  （目標達成に必要な総額）                │
│                                         │
│  頭金                                    │
│  [¥200,000]                              │
│  （デフォルト = 現在の残高）              │
│                                         │
│  [続ける] [戻る]                        │
└─────────────────────────────────────────┘
```

**UI図解 - ステップ3: 目標達成能力を確認**:

```text
┌─────────────────────────────────────────┐
│  ← 戻る    目標を作成 (3/3)              │
├─────────────────────────────────────────┤
│  目標達成能力を確認                      │
│                                         │
│  目標情報                                │
│  ┌───────────────────────────────────┐ │
│  │ 目標: 家を買う                      │ │
│  │ 目標値: ¥8,000,000                 │ │
│  │ 頭金: ¥200,000                    │ │
│  │ 残りのギャップ: ¥7,800,000        │ │
│  └───────────────────────────────────┘ │
│                                         │
│  現在の財務                              │
│  ┌───────────────────────────────────┐ │
│  │ 平均収入: ¥120,000                 │ │
│  │ 平均支出: ¥111,600                 │ │
│  │ 平均貯蓄: ¥8,400                  │ │
│  └───────────────────────────────────┘ │
│                                         │
│  現在の状況を維持する場合                │
│  月次貯蓄: ¥8,400                       │
│  約77年必要になります                    │
│                                         │
│  結論                                    │
│  現在の状況では、借入または財務改善なしでは│
│  目標を達成できません                    │
│                                         │
│  次に何をしますか？                     │
│  ┌───────────────────────────────────┐ │
│  │ ローンオプションを表示 ›           │ │
│  │ （ローンが役立つかどうかを確認したい場合...）│ │
│  └───────────────────────────────────┘ │
│  ┌───────────────────────────────────┐ │
│  │ 収入/支出仮定を作成 ›             │ │
│  │ （改善を試したい場合...）          │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [目標を保存] [戻る]                    │
└─────────────────────────────────────────┘
```

---

### 5.2 PLANNING-02: 目標リストと詳細を表示

**目標**: 作成された目標のリストを表示し、保存された計画を含む各目標の詳細を表示します。

**手順**:
1. 機能画面に移動し、「計画と仮定」を選択
2. 作成された目標のリストを確認
3. （任意）検索バーを使用して目標名で検索
4. 目標をタップして詳細を表示
5. 目標情報、財務計画（ベースライン）、保存された計画リストを確認

**結果**: 完全な目標情報と保存された計画を表示します。

**UI図解 - 目標リスト**:

```text
┌─────────────────────────────────────────┐
│  ← 戻る    計画と仮定                    │
├─────────────────────────────────────────┤
│  [🔍 目標名で検索]                       │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │ 家を買う                            │ │
│  │ 🎯 目標値: ¥8,000,000             │ │
│  │ 💰 頭金: ¥200,000                 │ │
│  │ ⚠️ 残りのギャップ: ¥7,800,000     │ │
│  └───────────────────────────────────┘ │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │ 車を買う                            │ │
│  │ 🎯 目標値: ¥2,000,000             │ │
│  │ 💰 頭金: ¥80,000                  │ │
│  │ ⚠️ 残りのギャップ: ¥1,920,000    │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [➕ 新規追加]                           │
└─────────────────────────────────────────┘
```

**UI図解 - 目標詳細**:

```text
┌─────────────────────────────────────────┐
│  ← 戻る    目標: 家を買う                │
├─────────────────────────────────────────┤
│  目標情報                                │
│  ┌───────────────────────────────────┐ │
│  │ 🎯 目標値: ¥8,000,000             │ │
│  │ 💰 頭金: ¥200,000                 │ │
│  │ ⚠️ 残りのギャップ: ¥7,800,000    │ │
│  │                                    │ │
│  │ [🗑️ 削除]                          │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [📊 財務計画を表示（ベースライン）]     │
│                                         │
│  保存された計画リスト                    │
│  ┌───────────────────────────────────┐ │
│  │ 家の価値の80%をローン               │ │
│  │ ローン: ¥6,000,000                 │ │
│  │ 金利: 8%/年                        │ │
│  │ 期間: 20年                         │ │
│  │ [詳細を表示]                       │ │
│  └───────────────────────────────────┘ │
│  ┌───────────────────────────────────┐ │
│  │ 収入を増やす + 支出を減らす        │ │
│  │ 新しい収入: ¥140,000                │ │
│  │ 新しい支出: ¥107,600                │ │
│  │ 新しい貯蓄: ¥32,400                 │ │
│  │ [詳細を表示]                       │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [➕ 新規追加]                           │
└─────────────────────────────────────────┘
```

---

### 5.3 PLANNING-03: 目標のローン計画を作成

**目標**: 借入が目標達成までの時間を短縮し、支払い能力を向上させるかどうかを確認するためにローン計画を作成します。

**手順**:
1. 目標詳細画面で、「➕ 新規追加」ボタンをタップ
2. ダイアログで「ローン」を選択
3. ローン情報を入力: ローン額、金利、ローン期間、計画名
4. 自動計算された結果を確認
5. 「計画を保存」をタップ

**結果**: ローン計画が保存され、計画リストに表示されます。

**UI図解**: ローン計画作成画面（関連画面に詳細があります）。

---

### 5.4 PLANNING-04: 目標達成能力を向上させるために収入/支出仮定を作成

**目標**: 収入を増やすか支出を減らす仮定を作成して、これが目標をより早く達成するのに役立つかどうかを確認します。

**手順**:
1. 目標詳細画面で、「➕ 新規追加」ボタンをタップ
2. ダイアログで「仮定」を選択
3. 仮定を入力: 収入を増やす（ある場合）、支出を減らす（ある場合）、仮定名
4. 自動計算された結果を確認
5. 「仮定を保存」をタップ

**結果**: 仮定が保存され、計画リストに表示されます。

**UI図解**: 仮定作成画面（関連画面に詳細があります）。

---

### 5.5 PLANNING-05: 財務目標を削除

**目標**: 不要になった財務目標を削除します。

**手順**:
1. 目標詳細画面に移動
2. 「削除」ボタン（削除アイコン）をタップ
3. ダイアログで削除を確認

**結果**: 目標とすべての関連計画が削除されました。

**UI図解**: 目標削除確認ダイアログ。

## 6. ロジックとルール

### 6.1 予測計算

- 予測は以下に基づきます：
  - 収入 - 固定支出 - 生活費 = 貯蓄/月
  - 現在の残高 + （貯蓄/月 × 月数）

### 6.2 目標

- 残りのギャップ = 必要額 - 頭金
- 推定時間 = 残りのギャップ / 平均貯蓄（月）
- 平均貯蓄 <= 0の場合: 借入または財務改善なしでは目標を達成できません

### 6.3 ローン計画

- 計算は以下に基づきます：
  - ローン額
  - 金利
  - 期間
  - 返済スケジュールを自動作成

### 6.4 財務仮定

- 以下のような仮定を評価：
  - 収入を増やす/減らす
  - 支出を増やす/減らす
  - 金利を変更
- 目標達成能力への影響を確認

## 7. 重要な注意事項

- **プレミアムモジュール必須**: この機能はプレミアムユーザーのみ利用可能
- **予測は参考のみ**: 安定した収入と支出の仮定に基づきます
- **複数の計画を作成可能**: 複数の計画（ローン、仮定、組み合わせ）を作成して比較できます
- **ベースラインが保存されます**: 初期財務計画（ベースライン）は目標作成時に保存され、後の計画と比較するために使用されます
- **自動計算**: 収入と固定支出は、銀行ローン返済を含むアクティブな定期項目から自動的に取得されます
- **目標の削除**: 目標を削除する際、すべての関連計画も削除され、復元できません

